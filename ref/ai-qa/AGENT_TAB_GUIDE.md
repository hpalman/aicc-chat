# ìƒë‹´ì› ë©€í‹° íƒ­ ì±„íŒ… ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ìƒë‹´ì›ì´ ì—¬ëŸ¬ ê³ ê°ê³¼ ë™ì‹œì— ì±„íŒ…í•  ìˆ˜ ìˆë„ë¡ **íƒ­(Tab) UI**ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ê° íƒ­ì€ ë…ë¦½ì ì¸ ê³ ê° ìƒë‹´ì„ ë‚˜íƒ€ë‚´ë©°, íƒ­ ë‹«ê¸° ë²„íŠ¼ìœ¼ë¡œ ìƒë‹´ì„ ì¢…ë£Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. ë©€í‹° íƒ­ ì±„íŒ…
- âœ… ì—¬ëŸ¬ ê³ ê°ê³¼ **ë™ì‹œì—** ì±„íŒ… ê°€ëŠ¥
- âœ… íƒ­ í´ë¦­ìœ¼ë¡œ ê³ ê° ê°„ **ë¹ ë¥¸ ì „í™˜**
- âœ… ê° íƒ­ì— ê³ ê° ì´ë¦„ í‘œì‹œ
- âœ… í˜„ì¬ í™œì„± íƒ­ í•˜ì´ë¼ì´íŠ¸

### 2. íƒ­ ë‹«ê¸° = ìƒë‹´ ì¢…ë£Œ
- âœ… íƒ­ ë‹«ê¸° ë²„íŠ¼(Ã—) í´ë¦­ ì‹œ **ìƒë‹´ ì¢…ë£Œ**
- âœ… ìƒë‹´ ì¢…ë£Œ í™•ì¸ ëŒ€í™”ìƒì
- âœ… ê³ ê°ì—ê²Œ BOT ëª¨ë“œë¡œ ë³µê·€ ì•Œë¦¼

### 3. ìƒë‹´ì› ê°œì… ê¸°ëŠ¥
- âœ… ë‹¤ë¥¸ ìƒë‹´ì›ì´ ìƒë‹´ ì¤‘ì¸ ë°©ì— **ê°•ì œ ê°œì…** ê°€ëŠ¥
- âœ… ê°œì… ì‹œ ê³ ê°ì—ê²Œ ì•Œë¦¼ ë©”ì‹œì§€ ì „ì†¡
- âœ… ì´ì „ ìƒë‹´ì›ê³¼ êµì²´

---

## ğŸ¨ UI ë³€ê²½ ì‚¬í•­

### Before (ë‹¨ì¼ ì±„íŒ…ì°½)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë°© ëª©ë¡]    [ì±„íŒ… í—¤ë”: í™ê¸¸ë™ (ìƒë‹´ì¤‘)]  â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚               â”‚  ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­       â”‚   â”‚
â”‚               â”‚                        â”‚   â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               [ë©”ì‹œì§€ ì…ë ¥ì°½]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¬¸ì œì :**
- í•œ ë²ˆì— í•œ ëª…ì˜ ê³ ê°ë§Œ ìƒë‹´ ê°€ëŠ¥
- ë‹¤ë¥¸ ê³ ê°ì—ê²Œ ì‘ë‹µí•˜ë ¤ë©´ ë°© ëª©ë¡ì—ì„œ ë‹¤ì‹œ ì„ íƒ
- ì±„íŒ… ë‚´ìš©ì´ ì´ˆê¸°í™”ë¨

---

### After (ë©€í‹° íƒ­)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë°© ëª©ë¡]    â”Œâ”€ í™ê¸¸ë™ Ã— â”¬â”€ ê¹€ì² ìˆ˜ Ã— â”€â”  â”‚
â”‚               â”‚  (í™œì„±)  â”‚  (ë¹„í™œì„±)  â”‚  â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚               â”‚  ì±„íŒ… í—¤ë”: í™ê¸¸ë™      â”‚  â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚               â”‚  ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­       â”‚  â”‚
â”‚               â”‚                        â”‚  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               [ë©”ì‹œì§€ ì…ë ¥ì°½]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì :**
- âœ… ì—¬ëŸ¬ ê³ ê°ê³¼ ë™ì‹œ ìƒë‹´ ê°€ëŠ¥
- âœ… íƒ­ í´ë¦­ìœ¼ë¡œ ë¹ ë¥¸ ì „í™˜
- âœ… ê° íƒ­ì˜ ì±„íŒ… ë‚´ìš© ìœ ì§€
- âœ… íƒ­ ë‹«ê¸°(Ã—)ë¡œ ìƒë‹´ ì¢…ë£Œ

---

## ğŸ”§ êµ¬í˜„ ìƒì„¸

### 1. í”„ë¡ íŠ¸ì—”ë“œ (chat-agent.html)

#### íƒ­ ì˜ì—­ ì¶”ê°€

```html
<!-- íƒ­ ì˜ì—­ -->
<div class="chat-tabs" id="chat-tabs">
    <!-- Tabs will be dynamically added here -->
</div>

<!-- í™œì„± ì±„íŒ… ì˜ì—­ -->
<div class="chat-header" id="chat-header">
    <span class="fw-bold fs-5">ìƒë‹´ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>
</div>
<div class="chat-box" id="chat-box">
    <!-- Messages -->
</div>
```

---

#### íƒ­ CSS ìŠ¤íƒ€ì¼

```css
.chat-tabs {
    border-bottom: 1px solid #ddd;
    background: #fff;
    padding: 10px 10px 0 10px;
    display: flex;
    overflow-x: auto;
}

.chat-tab {
    position: relative;
    padding: 10px 40px 10px 15px;
    border: 1px solid #ddd;
    border-bottom: none;
    background: #f8f9fa;
    cursor: pointer;
    margin-right: 5px;
    border-radius: 5px 5px 0 0;
    white-space: nowrap;
    transition: 0.2s;
}

.chat-tab:hover {
    background: #e9ecef;
}

.chat-tab.active {
    background: #fff;
    font-weight: bold;
    border-bottom: 2px solid #fff;
    margin-bottom: -1px;
}

.chat-tab .close-tab {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
    font-size: 18px;
    cursor: pointer;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.chat-tab .close-tab:hover {
    color: #dc3545;
}
```

---

#### JavaScript ì£¼ìš” ë³€ìˆ˜

```javascript
let openTabs = {}; // roomId -> room object (ì—´ë ¤ìˆëŠ” íƒ­ ê´€ë¦¬)
let tabOrder = []; // roomId ë°°ì—´ (íƒ­ ìˆœì„œ ê´€ë¦¬)
```

---

#### íƒ­ ê´€ë¦¬ í•¨ìˆ˜

##### 1. íƒ­ UI ì—…ë°ì´íŠ¸

```javascript
function updateTabsUI() {
    const tabsContainer = document.getElementById("chat-tabs");
    tabsContainer.innerHTML = "";
    
    if (tabOrder.length === 0) {
        tabsContainer.innerHTML = '<div class="text-muted" style="padding: 10px;">ì—´ë¦° ìƒë‹´ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }
    
    tabOrder.forEach(roomId => {
        const room = openTabs[roomId];
        if (!room) return;
        
        const tabDiv = document.createElement("div");
        tabDiv.className = `chat-tab ${currentRoomId === roomId ? 'active' : ''}`;
        tabDiv.innerHTML = `
            <span>${room.roomName || 'ì•Œ ìˆ˜ ì—†ìŒ'}</span>
            <span class="close-tab" onclick="event.stopPropagation(); closeTab('${roomId}')" title="ìƒë‹´ ì¢…ë£Œ">Ã—</span>
        `;
        tabDiv.onclick = () => switchTab(roomId);
        tabsContainer.appendChild(tabDiv);
    });
}
```

---

##### 2. íƒ­ ì—´ê¸° (ìƒˆë¡œìš´ ìƒë‹´ ì‹œì‘)

```javascript
function openTab(room) {
    if (!openTabs[room.roomId]) {
        openTabs[room.roomId] = room;
        tabOrder.push(room.roomId);
        
        // êµ¬ë… ì‹œì‘
        subscribeToRoom(room.roomId);
    }
    
    switchTab(room.roomId);
    updateTabsUI();
}
```

---

##### 3. íƒ­ ì „í™˜

```javascript
function switchTab(roomId) {
    if (!openTabs[roomId]) return;
    
    currentRoomId = roomId;
    const room = openTabs[roomId];
    
    unreadRooms[roomId] = false;
    updateHeader(room);
    updateInputState(room);
    
    const chatBox = document.getElementById("chat-box");
    chatBox.innerHTML = "";
    
    if (roomMessages[roomId]) {
        roomMessages[roomId].forEach(msg => showMessage(msg));
    }
    
    updateTabsUI();
    updateRoomListUI(roomsData);
}
```

---

##### 4. íƒ­ ë‹«ê¸° (ìƒë‹´ ì¢…ë£Œ)

```javascript
function closeTab(roomId) {
    if (!openTabs[roomId]) return;
    
    const room = openTabs[roomId];
    const isMyRoom = room.status === 'AGENT' && room.assignedAgent === nickname;
    
    // ë‚´ ìƒë‹´ë°©ì´ë©´ ì¢…ë£Œ í™•ì¸ ë° API í˜¸ì¶œ
    if (isMyRoom && room.status !== 'CLOSED') {
        closeConsultation(roomId, room.status);
        return;
    }
    
    // íƒ­ë§Œ ë‹«ê¸°
    delete openTabs[roomId];
    tabOrder = tabOrder.filter(id => id !== roomId);
    
    // êµ¬ë… í•´ì œ
    if (subscriptions[roomId]) {
        subscriptions[roomId].unsubscribe();
        delete subscriptions[roomId];
    }
    
    // í˜„ì¬ íƒ­ì´ì—ˆë‹¤ë©´ ë‹¤ë¥¸ íƒ­ìœ¼ë¡œ ì „í™˜
    if (currentRoomId === roomId) {
        if (tabOrder.length > 0) {
            switchTab(tabOrder[tabOrder.length - 1]);
        } else {
            currentRoomId = null;
            document.getElementById("chat-box").innerHTML = "";
            document.getElementById("chat-header").innerHTML = '<span class="fw-bold fs-5">ìƒë‹´ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>';
            document.getElementById("message").disabled = true;
            document.getElementById("sendBtn").disabled = true;
        }
    }
    
    updateTabsUI();
    updateRoomListUI(roomsData);
}
```

---

##### 5. ìƒë‹´ ì¢…ë£Œ API í˜¸ì¶œ

```javascript
function closeConsultation(roomId, status) {
    const msg = status === 'CLOSED' ? "ë°©ì„ ëª©ë¡ì—ì„œ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" : "ìƒë‹´ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
    if (!confirm(msg)) return;

    fetch(`/api/agent/rooms/${roomId}`, {
        method: 'DELETE',
        headers: { 'Authorization': 'Bearer ' + authToken }
    })
    .then(res => {
        if (res.ok) {
            alert("ìƒë‹´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            // íƒ­ ë‹«ê¸°
            closeTab(roomId);
            loadRooms();
        } else {
            alert("ìƒë‹´ ì¢…ë£Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    })
    .catch(err => console.error(err));
}
```

---

### 2. ë°±ì—”ë“œ (AgentChatController.java)

#### ê°•ì œ ê°œì… ê¸°ëŠ¥ ì¶”ê°€

```java
@PostMapping("/rooms/{roomId}/assign")
public ResponseEntity<?> assignAgent(
        @PathVariable String roomId,
        @RequestHeader(value = "Authorization", required = false) String token,
        @RequestParam(value = "force", required = false, defaultValue = "false") boolean force) {
    
    // ... ì¸ì¦ ë° ë°© ìƒíƒœ í™•ì¸ ...
    
    String currentAgent = roomRepository.getAssignedAgent(roomId);
    if (currentAgent != null && !currentAgent.equals(userInfo.getUserName())) {
        if (userInfo.getUserName().equals(currentAgent)) {
            return ResponseEntity.ok().build(); // ì´ë¯¸ ë³¸ì¸ì—ê²Œ ë°°ì •ëœ ê²½ìš° ì„±ê³µ ì²˜ë¦¬
        }
        
        if (force) {
            log.info("Force assigning agent {} to room {} (current: {})", 
                     userInfo.getUserName(), roomId, currentAgent);
            
            // ê°•ì œ ë°°ì •: ê¸°ì¡´ ë°°ì • ìƒë‹´ì› êµì²´
            roomRepository.setAssignedAgent(roomId, userInfo.getUserName());
            roomRepository.setRoutingMode(roomId, "AGENT");
            roomRepository.updateLastActivity(roomId);

            LocalDateTime now = LocalDateTime.now();
            ChatMessage notice = ChatMessage.builder()
                    .roomId(roomId)
                    .sender("System")
                    .senderRole(UserRole.SYSTEM)
                    .message(userInfo.getUserName() + " ìƒë‹´ì›ì´ ìƒë‹´ì— ê°œì…í–ˆìŠµë‹ˆë‹¤.")
                    .type(aicc.chat.domain.MessageType.INTERVENE)
                    .timestamp(now)
                    .build();

            try {
                messageBroker.publish(notice);
                roomUpdateBroadcaster.broadcastRoomList();

                chatSessionService.updateSessionStatus(roomId, "AGENT");
                chatSessionService.assignAgent(roomId, userInfo.getUserName());

                ChatHistory chatHistory = ChatHistory.builder()
                        .roomId(roomId)
                        .senderId("SYSTEM")
                        .senderName("System")
                        .senderRole("SYSTEM")
                        .message(notice.getMessage())
                        .messageType("INTERVENE")
                        .createdAt(now)
                        .build();
                chatHistoryService.saveChatHistory(chatHistory);
            } catch (Exception e) {
                log.error("Failed to post-force-assign actions", e);
            }

            return ResponseEntity.ok().build();
        }
        
        return ResponseEntity.status(409).body("ì´ë¯¸ ë‹¤ë¥¸ ìƒë‹´ì›(" + currentAgent + ")ì´ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
    
    // ... ì •ìƒ ë°°ì • ë¡œì§ ...
}
```

---

#### ìƒë‹´ ì¢…ë£Œ ì‹œ ìƒë‹´ì› ë©¤ë²„ ì œê±°

```java
@DeleteMapping("/rooms/{roomId}")
public ResponseEntity<?> deleteRoom(@PathVariable String roomId, ...) {
    // ...
    
    String currentMode = roomRepository.getRoutingMode(roomId);
    
    if ("CLOSED".equals(currentMode)) {
        log.info("Permanently deleting closed room: {}", roomId);
        roomRepository.deleteRoom(roomId);
    } else {
        log.info("Agent ending consultation, switching room {} back to BOT mode", roomId);
        
        // ë°© ìƒíƒœë¥¼ BOTìœ¼ë¡œ ë³€ê²½
        roomRepository.setRoutingMode(roomId, "BOT");
        
        // ìƒë‹´ì› ë°°ì • í•´ì œ
        roomRepository.setAssignedAgent(roomId, null);
        
        // ìƒë‹´ì› ë©¤ë²„ ì •ë³´ ì œê±° (Redis ë©¤ë²„ ëª©ë¡ ì •ë¦¬) âœ…
        roomRepository.removeMember(roomId, userInfo.getUserId());
        
        // PostgreSQLì— ìƒíƒœ ì—…ë°ì´íŠ¸
        chatSessionService.updateSessionStatus(roomId, "BOT");
        
        // ... ë©”ì‹œì§€ ë°œì†¡ ë° ì´ë ¥ ì €ì¥ ...
    }
    
    // ...
}
```

---

## ğŸ“Š ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë©€í‹° íƒ­ìœ¼ë¡œ ë™ì‹œ ìƒë‹´

```
1. ìƒë‹´ì› ë¡œê·¸ì¸
   - http://localhost:28070/chat-agent.html
   - ì•„ì´ë””: agent01, ë¹„ë°€ë²ˆí˜¸: 1234

2. ì²« ë²ˆì§¸ ê³ ê° ìƒë‹´ ì‹œì‘
   - ë°© ëª©ë¡ì—ì„œ "í™ê¸¸ë™" í´ë¦­
   - "ìƒë‹´ì„ ìˆ˜ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" â†’ í™•ì¸
   - íƒ­ ìƒì„±: [í™ê¸¸ë™ Ã—]
   - í™ê¸¸ë™ê³¼ ì±„íŒ… ì‹œì‘ âœ…

3. ë‘ ë²ˆì§¸ ê³ ê° ìƒë‹´ ì‹œì‘
   - ë°© ëª©ë¡ì—ì„œ "ê¹€ì² ìˆ˜" í´ë¦­
   - "ìƒë‹´ì„ ìˆ˜ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" â†’ í™•ì¸
   - íƒ­ ìƒì„±: [í™ê¸¸ë™ Ã—] [ê¹€ì² ìˆ˜ Ã—]
   - ê¹€ì² ìˆ˜ì™€ ì±„íŒ… ì‹œì‘ âœ…

4. ì„¸ ë²ˆì§¸ ê³ ê° ìƒë‹´ ì‹œì‘
   - ë°© ëª©ë¡ì—ì„œ "ì´ì˜í¬" í´ë¦­
   - íƒ­ ìƒì„±: [í™ê¸¸ë™ Ã—] [ê¹€ì² ìˆ˜ Ã—] [ì´ì˜í¬ Ã—]
   - ì´ì˜í¬ì™€ ì±„íŒ… ì‹œì‘ âœ…

5. íƒ­ ì „í™˜ìœ¼ë¡œ ê³ ê° ì‘ë‹µ
   - [í™ê¸¸ë™ Ã—] íƒ­ í´ë¦­ â†’ í™ê¸¸ë™ ì±„íŒ…ì°½ í‘œì‹œ
   - ë©”ì‹œì§€ ì…ë ¥ ë° ì „ì†¡
   - [ê¹€ì² ìˆ˜ Ã—] íƒ­ í´ë¦­ â†’ ê¹€ì² ìˆ˜ ì±„íŒ…ì°½ í‘œì‹œ
   - ë©”ì‹œì§€ ì…ë ¥ ë° ì „ì†¡
   - [ì´ì˜í¬ Ã—] íƒ­ í´ë¦­ â†’ ì´ì˜í¬ ì±„íŒ…ì°½ í‘œì‹œ
   - ë©”ì‹œì§€ ì…ë ¥ ë° ì „ì†¡ âœ…

6. ìƒë‹´ ì¢…ë£Œ (íƒ­ ë‹«ê¸°)
   - [í™ê¸¸ë™ Ã—]ì˜ Ã— ë²„íŠ¼ í´ë¦­
   - "ìƒë‹´ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" â†’ í™•ì¸
   - í™ê¸¸ë™ íƒ­ ë‹«í˜
   - í™ê¸¸ë™ ê³ ê° í™”ë©´: "ìƒë‹´ì›ê³¼ì˜ ìƒë‹´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì±—ë´‡ê³¼ ëŒ€í™”í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
   - ë°© ìƒíƒœ: AGENT â†’ BOT âœ…
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ìƒë‹´ì› ê°•ì œ ê°œì…

```
1. ìƒë‹´ì› Aê°€ ê³ ê°ê³¼ ìƒë‹´ ì¤‘
   - agent01ì´ "í™ê¸¸ë™"ê³¼ ìƒë‹´ ì¤‘
   - ë°© ìƒíƒœ: AGENT (assignedAgent: agent01)

2. ìƒë‹´ì› Bê°€ ê°™ì€ ê³ ê° ì„ íƒ
   - agent02ê°€ ë¡œê·¸ì¸
   - ë°© ëª©ë¡ì—ì„œ "í™ê¸¸ë™" í´ë¦­
   - í™•ì¸ ëŒ€í™”ìƒì: "agent01 ìƒë‹´ì›ì´ ì´ë¯¸ ìƒë‹´ ì¤‘ì…ë‹ˆë‹¤.\nì§€ê¸ˆ ì´ ìƒë‹´ì— ê°œì…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"

3. ê°œì… ì„ íƒ
   - "í™•ì¸" í´ë¦­
   - API í˜¸ì¶œ: POST /api/agent/rooms/{roomId}/assign?force=true

4. ê°œì… ì„±ê³µ
   - ë°© ìƒíƒœ: AGENT (assignedAgent: agent02) âœ…
   - ê³ ê° í™”ë©´: "agent02 ìƒë‹´ì›ì´ ìƒë‹´ì— ê°œì…í–ˆìŠµë‹ˆë‹¤." (INTERVENE íƒ€ì…)
   - agent02 íƒ­ ìƒì„±: [í™ê¸¸ë™ Ã—]
   - agent01 í™”ë©´: ë°© ëª©ë¡ì—ì„œ "í™ê¸¸ë™" ìƒíƒœ ë³€ê²½ (ìƒë‹´ì¤‘(agent02))

5. agent02ê°€ ìƒë‹´ ì§„í–‰
   - agent02ê°€ í™ê¸¸ë™ê³¼ ì±„íŒ… ê³„ì†
   - agent01ì€ ë” ì´ìƒ ë©”ì‹œì§€ ì…ë ¥ ë¶ˆê°€ âœ…
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: íƒ­ ë‹«ê¸°ë¡œ ìƒë‹´ ì¢…ë£Œ

```
1. ì—¬ëŸ¬ ê³ ê°ê³¼ ë™ì‹œ ìƒë‹´ ì¤‘
   - íƒ­: [í™ê¸¸ë™ Ã—] [ê¹€ì² ìˆ˜ Ã—] [ì´ì˜í¬ Ã—]
   - í˜„ì¬ í™œì„± íƒ­: ê¹€ì² ìˆ˜

2. ê¹€ì² ìˆ˜ ìƒë‹´ ì¢…ë£Œ
   - [ê¹€ì² ìˆ˜ Ã—]ì˜ Ã— ë²„íŠ¼ í´ë¦­
   - í™•ì¸ ëŒ€í™”ìƒì: "ìƒë‹´ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" â†’ í™•ì¸
   - API í˜¸ì¶œ: DELETE /api/agent/rooms/{roomId}

3. ì„œë²„ ì²˜ë¦¬
   - ë°© ìƒíƒœ: AGENT â†’ BOT
   - ìƒë‹´ì› ë°°ì • í•´ì œ: assignedAgent = null
   - ìƒë‹´ì› ë©¤ë²„ ì œê±°: removeMember(roomId, agentId)
   - ê³ ê°ì—ê²Œ ë©”ì‹œì§€: "ìƒë‹´ì›ê³¼ì˜ ìƒë‹´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì±—ë´‡ê³¼ ëŒ€í™”í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
   - PostgreSQL ì—…ë°ì´íŠ¸: status = "BOT"

4. ìƒë‹´ì› í™”ë©´
   - [ê¹€ì² ìˆ˜ Ã—] íƒ­ ë‹«í˜
   - ë‚¨ì€ íƒ­: [í™ê¸¸ë™ Ã—] [ì´ì˜í¬ Ã—]
   - ìë™ìœ¼ë¡œ [ì´ì˜í¬ Ã—] íƒ­ìœ¼ë¡œ ì „í™˜ (ë§ˆì§€ë§‰ íƒ­)
   - Alert: "ìƒë‹´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."

5. ê³ ê° í™”ë©´ (ê¹€ì² ìˆ˜)
   - ì‹œìŠ¤í…œ ë©”ì‹œì§€: "ìƒë‹´ì›ê³¼ì˜ ìƒë‹´ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì±—ë´‡ê³¼ ëŒ€í™”í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
   - "ìƒë‹´ì› ì—°ê²°" ë²„íŠ¼ í™œì„±í™” âœ…
   - ì±—ë´‡ê³¼ ëŒ€í™” ì¬ê°œ ê°€ëŠ¥ âœ…
```

---

## ğŸ’¡ ì£¼ìš” ë³€ê²½ ì‚¬í•­ ìš”ì•½

### í”„ë¡ íŠ¸ì—”ë“œ (chat-agent.html)

| ë³€ê²½ ì‚¬í•­ | Before | After |
|-----------|--------|-------|
| ì±„íŒ… UI | ë‹¨ì¼ ì±„íŒ…ì°½ | ë©€í‹° íƒ­ |
| ë°© ì„ íƒ | ê¸°ì¡´ ì±„íŒ… ë‚´ìš© ì´ˆê¸°í™” | íƒ­ì— ë‚´ìš© ìœ ì§€ |
| ìƒë‹´ ì¢…ë£Œ | í—¤ë”ì˜ "ìƒë‹´ì¢…ë£Œ" ë²„íŠ¼ | íƒ­ì˜ Ã— ë²„íŠ¼ |
| ë™ì‹œ ìƒë‹´ | ë¶ˆê°€ëŠ¥ | ì—¬ëŸ¬ ê³ ê° ë™ì‹œ ê°€ëŠ¥ |
| ìƒë‹´ì› ê°œì… | ë¶ˆê°€ëŠ¥ | ê°•ì œ ê°œì… ê°€ëŠ¥ |

---

### ë°±ì—”ë“œ (AgentChatController.java)

| ë³€ê²½ ì‚¬í•­ | ì„¤ëª… |
|-----------|------|
| **ê°•ì œ ê°œì… íŒŒë¼ë¯¸í„°** | `?force=true` ì¶”ê°€ |
| **ê°œì… ë©”ì‹œì§€ íƒ€ì…** | `MessageType.INTERVENE` ì¶”ê°€ |
| **ìƒë‹´ì› ë©¤ë²„ ì œê±°** | `removeMember(roomId, agentId)` í˜¸ì¶œ |
| **ê°œì… ì•Œë¦¼** | "{ìƒë‹´ì›ëª…} ìƒë‹´ì›ì´ ìƒë‹´ì— ê°œì…í–ˆìŠµë‹ˆë‹¤." |

---

## ğŸ¨ UI ìŠ¤í¬ë¦°ìƒ· ì„¤ëª…

### 1. íƒ­ ì—†ìŒ (ì´ˆê¸° ìƒíƒœ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì—´ë¦° ìƒë‹´ì´ ì—†ìŠµë‹ˆë‹¤.                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ìƒë‹´ì„ ì„ íƒí•´ì£¼ì„¸ìš”                          â”‚
â”‚                                               â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. íƒ­ 1ê°œ (í™ê¸¸ë™)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€ í™ê¸¸ë™ Ã— â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   (í™œì„±)          â”‚                       â”‚
â”œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì±„íŒ… í—¤ë”: í™ê¸¸ë™ [ìƒë‹´ì¤‘(ë‚˜)]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  í™ê¸¸ë™: ì•ˆë…•í•˜ì„¸ìš”                           â”‚
â”‚  ìƒë‹´ì›: ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?                 â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. íƒ­ 3ê°œ (í™ê¸¸ë™, ê¹€ì² ìˆ˜, ì´ì˜í¬)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€ í™ê¸¸ë™ Ã— â”€â”¬â”€ ê¹€ì² ìˆ˜ Ã— â”€â”¬â”€ ì´ì˜í¬ Ã— â”€â”  â”‚
â”‚  â”‚  (ë¹„í™œì„±)  â”‚  (í™œì„±)    â”‚  (ë¹„í™œì„±)  â”‚  â”‚
â”œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì±„íŒ… í—¤ë”: ê¹€ì² ìˆ˜ [ìƒë‹´ì¤‘(ë‚˜)]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ê¹€ì² ìˆ˜: ë°°ì†¡ ë¬¸ì˜ ë“œë¦½ë‹ˆë‹¤                   â”‚
â”‚  ìƒë‹´ì›: ì£¼ë¬¸ë²ˆí˜¸ ì•Œë ¤ì£¼ì„¸ìš”                  â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ê¸°ìˆ  êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­

### 1. íƒ­ ìˆœì„œ ê´€ë¦¬

```javascript
let tabOrder = []; // ["room-abc123", "room-def456", "room-ghi789"]

// íƒ­ ì¶”ê°€
tabOrder.push(roomId);

// íƒ­ ì œê±°
tabOrder = tabOrder.filter(id => id !== roomId);

// ë§ˆì§€ë§‰ íƒ­ ì„ íƒ
if (tabOrder.length > 0) {
    switchTab(tabOrder[tabOrder.length - 1]);
}
```

---

### 2. ì—´ë¦° íƒ­ ê´€ë¦¬

```javascript
let openTabs = {
    "room-abc123": { roomId: "room-abc123", roomName: "í™ê¸¸ë™", status: "AGENT", ... },
    "room-def456": { roomId: "room-def456", roomName: "ê¹€ì² ìˆ˜", status: "AGENT", ... },
    "room-ghi789": { roomId: "room-ghi789", roomName: "ì´ì˜í¬", status: "AGENT", ... }
};

// íƒ­ ì¶”ê°€
openTabs[roomId] = room;

// íƒ­ ì œê±°
delete openTabs[roomId];

// íƒ­ ì¡´ì¬ í™•ì¸
if (openTabs[roomId]) { ... }
```

---

### 3. êµ¬ë… ê´€ë¦¬

```javascript
// ì—´ë¦° íƒ­ë§Œ êµ¬ë… ìœ ì§€
rooms.forEach(room => {
    if (openTabs[room.roomId]) {
        // ì—´ë¦° íƒ­ì€ í•­ìƒ êµ¬ë… ìœ ì§€
        if (!subscriptions[room.roomId]) {
            subscribeToRoom(room.roomId);
        }
    } else {
        // ì—´ë¦° íƒ­ì´ ì•„ë‹ˆë©´ êµ¬ë… í•´ì œ
        if (subscriptions[room.roomId]) {
            subscriptions[room.roomId].unsubscribe();
            delete subscriptions[room.roomId];
        }
    }
});
```

---

### 4. ë©”ì‹œì§€ ì´ë ¥ ìœ ì§€

```javascript
let roomMessages = {
    "room-abc123": [ /* í™ê¸¸ë™ ë©”ì‹œì§€ ë°°ì—´ */ ],
    "room-def456": [ /* ê¹€ì² ìˆ˜ ë©”ì‹œì§€ ë°°ì—´ */ ],
    "room-ghi789": [ /* ì´ì˜í¬ ë©”ì‹œì§€ ë°°ì—´ */ ]
};

// íƒ­ ì „í™˜ ì‹œ ë©”ì‹œì§€ ë³µì›
if (roomMessages[roomId]) {
    roomMessages[roomId].forEach(msg => showMessage(msg));
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. íƒ­ ë‹«ê¸° = ìƒë‹´ ì¢…ë£Œ

íƒ­ì˜ Ã— ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ **ì‹¤ì œë¡œ ìƒë‹´ì´ ì¢…ë£Œ**ë©ë‹ˆë‹¤.
- ê³ ê°ì€ BOT ëª¨ë“œë¡œ ë³µê·€
- ë°© ìƒíƒœê°€ AGENT â†’ BOTë¡œ ë³€ê²½
- ìƒë‹´ì› ë°°ì • í•´ì œ

**ì‹¤ìˆ˜ë¡œ ë‹«ì§€ ì•Šë„ë¡ ì£¼ì˜!**

---

### 2. ê°•ì œ ê°œì… ì‹ ì¤‘íˆ ì‚¬ìš©

ë‹¤ë¥¸ ìƒë‹´ì›ì´ ìƒë‹´ ì¤‘ì¸ ë°©ì— ê°œì…í•˜ë©´:
- ê¸°ì¡´ ìƒë‹´ì›ì´ ë” ì´ìƒ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ì—†ìŒ
- ê³ ê°ì—ê²Œ ê°œì… ì•Œë¦¼ì´ í‘œì‹œë¨
- ìƒë‹´ ì—°ì†ì„±ì´ ëŠê¸¸ ìˆ˜ ìˆìŒ

**ê¸´ê¸‰í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ì„¸ìš”!**

---

### 3. íƒ­ ê°œìˆ˜ ì œí•œ ì—†ìŒ

í˜„ì¬ íƒ­ ê°œìˆ˜ì— ì œí•œì´ ì—†ìœ¼ë¯€ë¡œ:
- ë„ˆë¬´ ë§ì€ íƒ­ì„ ì—´ë©´ UIê°€ í˜¼ì¡í•  ìˆ˜ ìˆìŒ
- ìƒë‹´ì›ì´ ê´€ë¦¬í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ
- í•„ìš”ì— ë”°ë¼ ì œí•œ ê¸°ëŠ¥ ì¶”ê°€ ê³ ë ¤

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
âœ… ì—¬ëŸ¬ ê³ ê°ê³¼ ë™ì‹œ ìƒë‹´ ê°€ëŠ¥
âœ… íƒ­ í´ë¦­ìœ¼ë¡œ ì±„íŒ… ì „í™˜
âœ… ê° íƒ­ì˜ ë©”ì‹œì§€ ì´ë ¥ ìœ ì§€
âœ… íƒ­ ë‹«ê¸°ë¡œ ìƒë‹´ ì¢…ë£Œ
âœ… ê³ ê°ì—ê²Œ BOT ë³µê·€ ì•Œë¦¼
âœ… ìƒë‹´ì› ê°•ì œ ê°œì… ê¸°ëŠ¥
âœ… ê°œì… ì‹œ ê³ ê°ì—ê²Œ ì•Œë¦¼
âœ… ë°© ëª©ë¡ì—ì„œ ì—´ë¦° íƒ­ í‘œì‹œ (ì—´ë¦¼ ë°°ì§€)
âœ… ë°±ê·¸ë¼ìš´ë“œ ë©”ì‹œì§€ ì•Œë¦¼ (NEW ë°°ì§€)
âœ… ë§ˆì§€ë§‰ íƒ­ ë‹«ì„ ë•Œ ì´ˆê¸° ìƒíƒœë¡œ ë³µê·€
```

---

## ğŸ‰ ì™„ë£Œ!

ìƒë‹´ì›ì´ **ë©€í‹° íƒ­**ìœ¼ë¡œ ì—¬ëŸ¬ ê³ ê°ê³¼ ë™ì‹œì— ì±„íŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

**ì£¼ìš” ê¸°ëŠ¥:**
- âœ… ë©€í‹° íƒ­ UIë¡œ ì—¬ëŸ¬ ê³ ê° ë™ì‹œ ìƒë‹´
- âœ… íƒ­ í´ë¦­ìœ¼ë¡œ ë¹ ë¥¸ ì „í™˜
- âœ… íƒ­ ë‹«ê¸°(Ã—) ë²„íŠ¼ìœ¼ë¡œ ìƒë‹´ ì¢…ë£Œ
- âœ… ìƒë‹´ ì¢…ë£Œ ì‹œ ê³ ê° BOT ëª¨ë“œ ë³µê·€
- âœ… ê°•ì œ ê°œì… ê¸°ëŠ¥ìœ¼ë¡œ ë‹¤ë¥¸ ìƒë‹´ì› ë°© ì ‘ê·¼

**ì‚¬ìš© ë°©ë²•:**
1. ë°© ëª©ë¡ì—ì„œ ê³ ê° ì„ íƒ â†’ íƒ­ ìƒì„±
2. íƒ­ í´ë¦­ìœ¼ë¡œ ê³ ê° ê°„ ì „í™˜
3. íƒ­ Ã— ë²„íŠ¼ìœ¼ë¡œ ìƒë‹´ ì¢…ë£Œ

**í…ŒìŠ¤íŠ¸:**
```
http://localhost:28070/chat-agent.html
ì•„ì´ë””: agent01, ë¹„ë°€ë²ˆí˜¸: 1234
```
