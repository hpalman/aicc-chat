ë„¤, ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì ìš© ê°€ëŠ¥í•˜ë„ë¡ **Spring Boot** ê¸°ë°˜ì˜ **ì™„ì „í•œ í”„ë¡œì íŠ¸ êµ¬ì¡°**ë¡œ ì‘ì„±í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì´ ì½”ë“œëŠ” \*\*WebSocket (STOMP)\*\*ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, `application.yml` ì„¤ì • í•˜ë‚˜ë¡œ **In-Memory**, **Redis**, **RabbitMQ** ëª¨ë“œë¥¼ ììœ ë¡­ê²Œ ì „í™˜í•  ìˆ˜ ìˆëŠ” **ì „ëµ íŒ¨í„´(Strategy Pattern)** êµ¬ì¡°ì…ë‹ˆë‹¤.

-----

### ğŸ“¦ 1. í”„ë¡œì íŠ¸ ì˜ì¡´ì„± (`pom.xml`)

ê°€ì¥ ë¨¼ì € í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-websocket</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-amqp</artifactId>
    </dependency>

    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
    </dependency>
</dependencies>
```

-----

### âš™ï¸ 2. í™˜ê²½ ì„¤ì • (`application.yml`)

ì—¬ê¸°ì„œ `system-mode`ë¥¼ ë³€ê²½í•˜ì—¬ ì•„í‚¤í…ì²˜ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

```yaml
app:
  # ì„ íƒ ê°€ëŠ¥ ê°’: IN_MEMORY, REDIS_ONLY, REDIS_RABBIT
  system-mode: REDIS_ONLY 

spring:
  application:
    name: chat-system
  data:
    redis:
      host: localhost
      port: 6379
  rabbitmq:
    host: localhost
    port: 5672
    # RabbitMQìš© ì„¤ì •
    exchange: chat.topic.exchange
    queue: chat.queue
```

-----

### ğŸ§¬ 3. í•µì‹¬ ë„ë©”ì¸ ë° ì¸í„°í˜ì´ìŠ¤ (Common)

êµ¬í˜„ì²´ì™€ ìƒê´€ì—†ì´ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ê³¼ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.

**3-1. DTO (Data Transfer Object)**

```java
package com.example.chat.domain;

import lombok.*;
import java.io.Serializable;
import java.util.Set;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class ChatMessage implements Serializable {
    private String roomId;    // ë°© ID
    private String sender;    // ë³´ë‚¸ ì‚¬ëŒ (Customer/Agent/Bot)
    private String message;   // ë‚´ìš©
    private MessageType type; // TALK, JOIN, LEAVE
}

enum MessageType { TALK, JOIN, LEAVE }

@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ChatRoom implements Serializable {
    private String roomId;
    private String roomName;
    // ì´ ë°©ì— ëˆ„ê°€ ìˆëŠ”ì§€ ê´€ë¦¬ (Session ID or User ID)
    private Set<String> members;
}
```

**3-2. ì¶”ìƒí™” ì¸í„°í˜ì´ìŠ¤ (Interfaces)**

```java
package com.example.chat.service;

import com.example.chat.domain.ChatMessage;
import com.example.chat.domain.ChatRoom;

// 1. ë°© ìƒíƒœ ê´€ë¦¬ (ìƒì„±, ì¡°íšŒ, ë©¤ë²„ ì¶”ê°€/ì‚­ì œ)
public interface RoomRepository {
    ChatRoom createRoom(String name);
    ChatRoom findRoomById(String roomId);
    void addMember(String roomId, String memberId);
    void removeMember(String roomId, String memberId);
}

// 2. ë©”ì‹œì§€ ë°œí–‰/ì „ì†¡ (êµ¬í˜„ ê¸°ìˆ ì— ë”°ë¼ ë‹¬ë¼ì§)
public interface MessageBroker {
    void sendMessage(ChatMessage message);
}
```

-----

### ğŸ® 4. ì›¹ì†Œì¼“ ì»¨íŠ¸ë¡¤ëŸ¬ (Controller)

í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìœ¼ë¡œ ë„˜ê¸°ëŠ” ì§„ì…ì ì…ë‹ˆë‹¤. ì´ ì½”ë“œëŠ” **ì–´ë–¤ ëª¨ë“œë¥¼ ì“°ë“  ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

```java
package com.example.chat.controller;

import com.example.chat.domain.ChatMessage;
import com.example.chat.service.MessageBroker;
import com.example.chat.service.RoomRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.messaging.handler.annotation.DestinationVariable;
import org.springframework.messaging.handler.annotation.MessageMapping;
import org.springframework.stereotype.Controller;

@Controller
@RequiredArgsConstructor
public class ChatController {

    private final MessageBroker messageBroker;
    private final RoomRepository roomRepository;

    /**
     * í´ë¼ì´ì–¸íŠ¸ê°€ /app/chat/{roomId} ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ í˜¸ì¶œë¨
     * [íë¦„]: í´ë¼ì´ì–¸íŠ¸ -> Controller -> Broker(êµ¬í˜„ì²´) -> (Redis/Rabbit) -> Subscribers
     */
    @MessageMapping("/chat/{roomId}")
    public void sendMessage(@DestinationVariable String roomId, ChatMessage message) {
        // 1. ë©”ì‹œì§€ì— ë°© ID ê°•ì œ ì£¼ì…
        message.setRoomId(roomId);
        
        // 2. ë©¤ë²„ ê´€ë¦¬ (ì…ì¥ ì‹œ) - ì˜ˆì‹œ ë¡œì§
        if ("JOIN".equals(message.getType().name())) {
            roomRepository.addMember(roomId, message.getSender());
        }

        // 3. ë¸Œë¡œì»¤ì—ê²Œ ìœ„ì„ (ì—¬ê¸°ì„œ ëª¨ë“œì— ë”°ë¼ ë™ì‘ì´ ê°ˆë¦¼)
        messageBroker.sendMessage(message);
    }
}
```

-----

### ğŸ› ï¸ 5. ëª¨ë“œë³„ êµ¬í˜„ì²´ (Strategies)

#### âœ… Type 1. In-Memory êµ¬í˜„ (ë‹¨ì¼ ì„œë²„ìš©)

```java
package com.example.chat.config.mode;

import com.example.chat.domain.ChatMessage;
import com.example.chat.domain.ChatRoom;
import com.example.chat.service.MessageBroker;
import com.example.chat.service.RoomRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.SimpMessagingTemplate;

import java.util.Map;
import java.util.Set;
import java.util.UUID;
import java.util.concurrent.ConcurrentHashMap;

@Configuration
@ConditionalOnProperty(name = "app.system-mode", havingValue = "IN_MEMORY")
@RequiredArgsConstructor
public class InMemoryConfig {

    private final SimpMessagingTemplate messagingTemplate; // WebSocket ì „ì†¡ ë„êµ¬

    @Bean
    public RoomRepository roomRepository() {
        return new RoomRepository() {
            private final Map<String, ChatRoom> rooms = new ConcurrentHashMap<>();

            @Override
            public ChatRoom createRoom(String name) {
                String id = UUID.randomUUID().toString();
                ChatRoom room = ChatRoom.builder().roomId(id).roomName(name).members(ConcurrentHashMap.newKeySet()).build();
                rooms.put(id, room);
                return room;
            }
            @Override
            public ChatRoom findRoomById(String roomId) { return rooms.get(roomId); }
            @Override
            public void addMember(String roomId, String memberId) {
                if(rooms.containsKey(roomId)) rooms.get(roomId).getMembers().add(memberId);
            }
            @Override
            public void removeMember(String roomId, String memberId) {
                if(rooms.containsKey(roomId)) rooms.get(roomId).getMembers().remove(memberId);
            }
        };
    }

    @Bean
    public MessageBroker messageBroker() {
        // ì¸ë©”ëª¨ë¦¬ëŠ” ë°”ë¡œ WebSocket êµ¬ë…ìì—ê²Œ ì˜ë©´ ë©ë‹ˆë‹¤.
        return message -> messagingTemplate.convertAndSend("/topic/room/" + message.getRoomId(), message);
    }
}
```

#### âœ… Type 2. Redis Only êµ¬í˜„ (ë¶„ì‚° í™˜ê²½ ì§€ì›)

Redis Pub/Subì„ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŒ…í•©ë‹ˆë‹¤.

```java
package com.example.chat.config.mode;

import com.example.chat.domain.ChatMessage;
import com.example.chat.service.MessageBroker;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.MessageListener;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.listener.ChannelTopic;
import org.springframework.data.redis.listener.RedisMessageListenerContainer;
import org.springframework.data.redis.listener.adapter.MessageListenerAdapter;
import org.springframework.messaging.simp.SimpMessagingTemplate;

@Slf4j
@Configuration
@ConditionalOnProperty(name = "app.system-mode", havingValue = "REDIS_ONLY")
@RequiredArgsConstructor
public class RedisOnlyConfig {

    private final StringRedisTemplate redisTemplate;
    private final SimpMessagingTemplate messagingTemplate;
    private final ObjectMapper objectMapper;

    // 1. ë¸Œë¡œì»¤ êµ¬í˜„: Redis Topicìœ¼ë¡œ ë°œí–‰
    @Bean
    public MessageBroker messageBroker() {
        return message -> {
            try {
                String json = objectMapper.writeValueAsString(message);
                redisTemplate.convertAndSend("chat.topic", json);
            } catch (Exception e) {
                log.error("Redis Publish Error", e);
            }
        };
    }

    // 2. ë¦¬ìŠ¤ë„ˆ: Redisì—ì„œ ë©”ì‹œì§€ê°€ ì˜¤ë©´ -> WebSocket í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡
    @Bean
    public RedisMessageListenerContainer redisContainer(MessageListenerAdapter listenerAdapter) {
        RedisMessageListenerContainer container = new RedisMessageListenerContainer();
        container.setConnectionFactory(redisTemplate.getConnectionFactory());
        container.addMessageListener(listenerAdapter, new ChannelTopic("chat.topic"));
        return container;
    }

    @Bean
    public MessageListenerAdapter listenerAdapter() {
        return new MessageListenerAdapter((MessageListener) (message, pattern) -> {
            try {
                String body = new String(message.getBody());
                ChatMessage chatMessage = objectMapper.readValue(body, ChatMessage.class);
                // ì‹¤ì œ ì‚¬ìš©ìì—ê²Œ ì „ì†¡
                messagingTemplate.convertAndSend("/topic/room/" + chatMessage.getRoomId(), chatMessage);
            } catch (Exception e) {
                log.error("Redis Subscribe Error", e);
            }
        });
    }
    
    // RoomRepository êµ¬í˜„ì€ ìƒëµ (Redis Hash ì‚¬ìš© - Type 3ì™€ ë™ì¼)
}
```

#### âœ… Type 3. Redis + RabbitMQ êµ¬í˜„ (ê³ ê°€ìš©ì„±/ëŒ€ìš©ëŸ‰)

ìƒíƒœ ê´€ë¦¬ëŠ” Redis, ë©”ì‹œì§•ì€ RabbitMQ Topic Exchangeë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
package com.example.chat.config.mode;

import com.example.chat.domain.ChatMessage;
import com.example.chat.service.MessageBroker;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.amqp.core.*;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.SimpMessagingTemplate;

@Configuration
@ConditionalOnProperty(name = "app.system-mode", havingValue = "REDIS_RABBIT")
@RequiredArgsConstructor
public class RabbitConfig {

    private final RabbitTemplate rabbitTemplate;
    private final SimpMessagingTemplate messagingTemplate;

    @Value("${spring.rabbitmq.exchange}")
    private String exchangeName;

    // 1. RabbitMQ ì„¤ì • (Exchange ì •ì˜)
    @Bean
    public TopicExchange exchange() { return new TopicExchange(exchangeName); }

    // ëª¨ë“  ì±„íŒ… ë©”ì‹œì§€ë¥¼ ë°›ëŠ” ì„ì‹œ í (ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ë§ˆë‹¤ í•˜ë‚˜ì”© ìƒì„±)
    @Bean
    public Queue queue() { return new AnonymousQueue(); }

    @Bean
    public Binding binding(Queue queue, TopicExchange exchange) {
        // ëª¨ë“  ë°©(room.*)ì˜ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ 
        return BindingBuilder.bind(queue).to(exchange).with("room.*");
    }

    // 2. ë¸Œë¡œì»¤ êµ¬í˜„: RabbitMQë¡œ ë°œí–‰
    @Bean
    public MessageBroker messageBroker() {
        return message -> {
            // Routing Key: room.{roomId}
            rabbitTemplate.convertAndSend(exchangeName, "room." + message.getRoomId(), message);
        };
    }

    // 3. ë¦¬ìŠ¤ë„ˆ: RabbitMQì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹  -> WebSocket ì „ì†¡
    @RabbitListener(queues = "#{queue.name}")
    public void receive(ChatMessage message) {
        messagingTemplate.convertAndSend("/topic/room/" + message.getRoomId(), message);
    }
}
```

-----

### ğŸ”Œ 6. WebSocket ì„¤ì • (STOMP)

ë§ˆì§€ë§‰ìœ¼ë¡œ WebSocket ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì—½ë‹ˆë‹¤.

```java
package com.example.chat.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.config.MessageBrokerRegistry;
import org.springframework.web.socket.config.annotation.*;

@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        // í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ì—”ë“œí¬ì¸íŠ¸: ws://localhost:8080/ws-chat
        registry.addEndpoint("/ws-chat").setAllowedOriginPatterns("*").withSockJS();
    }

    @Override
    public void configureMessageBroker(MessageBrokerRegistry registry) {
        // êµ¬ë… ê²½ë¡œ: /topic/room/{roomId}
        registry.enableSimpleBroker("/topic");
        // ë°œí–‰ ê²½ë¡œ: /app/chat/{roomId}
        registry.setApplicationDestinationPrefixes("/app");
    }
}
```

-----

### ğŸš€ ì‚¬ìš© ê°€ì´ë“œ (ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ ëŒ€ì‘)

ì´ ì½”ë“œëŠ” `ChatRoom` ê°œë…ì„ ë„ì…í•˜ì—¬ ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

1.  **ë°© ìƒì„±:** `RoomRepository.createRoom()`ì„ í˜¸ì¶œí•˜ì—¬ ê³ ìœ  `roomId`ë¥¼ ì–»ìŠµë‹ˆë‹¤.
2.  **ì´ˆëŒ€/ì…ì¥:**
      * **ê³ ê°-ê³ ê°:** roomId í•˜ë‚˜ì— ê³ ê° A, Bê°€ ì…ì¥(Subscribe).
      * **ìƒë‹´ì›-ë´‡:** ìƒˆë¡œìš´ roomIdë¥¼ ë§Œë“¤ê³  ìƒë‹´ì›ê³¼ ë´‡ë§Œ ì…ì¥.
      * **ë‹¤ì¤‘ìƒë‹´:** roomIdì— ê³ ê° 1ëª…, ìƒë‹´ì› A, B, C ì…ì¥.
3.  **ë©”ì‹œì§€ ì „ì†¡:** í´ë¼ì´ì–¸íŠ¸ëŠ” `/app/chat/{roomId}`ë¡œ ë³´ë‚´ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
4.  **ë°°í¬ í™˜ê²½ ë³€ê²½:** `application.yml`ë§Œ ìˆ˜ì •í•˜ë©´ \*\*ë¡œì»¬ ê°œë°œ(IN\_MEMORY)\*\*ì—ì„œ \*\*ëŒ€ê·œëª¨ ìš´ì˜(REDIS\_RABBIT)\*\*ìœ¼ë¡œ ì½”ë“œ ìˆ˜ì • ì—†ì´ ì „í™˜ë©ë‹ˆë‹¤.


---

# AI ìš”ì²­ ìš”ì²­ í”„ë¡¬í”„íŠ¸
ì±„íŒ… ì‹œìŠ¤í…œì„ ê°œë°œí•˜ê³  ìˆë‹¤.
ì±„íŒ…ì‹œìŠ¤í…œì„ SpringBootë¡œ ë³„ë„ë¡œ êµ¬ì„±í•˜ê³  `1.ê³ ê°ì˜ì—­`, `2.ìƒë‹´ì›ì˜ì—­`, `3. AIë´‡ ì˜ì—­`ì„ ì¸í„°í˜ì´ìŠ¤ë§Œìœ¼ë¡œ ì—°ê²°í•˜ë ¤ í•œë‹¤.
ì‹œìŠ¤í…œ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ë‹¤.
---
	0. ì±„íŒ…ì‹œìŠ¤í…œ
	- Backend
	- Websocket ì„¸ì…˜ê´€ë¦¬
	- Redis, RabbitMQë¥¼ ì´ìš©í•œ ì±„íŒ… íë¦„
	- 1:1, 1:n ì±„íŒ… ë¼ìš°íŒ…
	- ì±„íŒ…ë°© ê´€ë¦¬
	- ê°ì¢… API (ëª¨ë‹ˆí„°ë§, ì„¸ë¶€ì„¤ì • ì¡°ì •)
	- ë…ë¦½ ë°ì´í„°ë² ì´ìŠ¤
	- Elastic Search

	1. ê³ ê°ì˜ì—­
	- Frontend, Backend 
	- ê³ ê°ë¡œê·¸ì¸ 
	- ê³ ê°ì„¸ì…˜ê´€ë¦¬
	- ê³ ê°ì±„íŒ…í™”ë©´
	- ì±„íŒ…ì‹œìŠ¤í…œ ì¸í„°í˜ì´ìŠ¤


	2. ìƒë‹´ì›ì˜ì—­ (aicc)
	- Frontend, Backend
	- ìƒë‹´ì› ì±„íŒ… ë¡œê·¸ì¸
	- ì±„íŒ…ìƒë‹´ ì‹¤í–‰
	- ìƒë‹´ì´ë ¥
	- ì±„íŒ… ì‹œìŠ¤í…œ APIë¥¼ ì´ìš©í•œ ê´€ë¦¬ í™”ë©´ 

	3. AIë´‡ ì˜ì—­
	- ì±„íŒ… API
--- 

ì²¨ë¶€íŒŒì¼ì€ `0. ì±„íŒ…ì‹œìŠ¤í…œ`ì— ëŒ€í•œ ê¸°ì´ˆì½”ë“œì´ë‹¤.
ë‚´ìš©ì„ ê²€í† í•˜ê³  ì‹¤ì œë¡œ ë°œì†¡ì— ëŒ€í•œ ì†ŒìŠ¤ë§Œ ì¡´ì¬í•˜ê³  ìˆ˜ì‹ ì— ëŒ€í•œ ì†ŒìŠ¤ê°€ í™•ì¸ë˜ì§€ ì•ŠëŠ”ë‹¤
ì²¨ë¶€íŒŒì¼ì˜ ë‚´ìš©ì„ ë³´ì™„í•˜ë¼ 