2026-01-26 10:41:49.057 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 14176 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 10:41:49.064 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 10:41:52.123 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 10:41:52.130 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 10:41:52.212 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 34 ms. Found 0 Redis repository interfaces.
2026-01-26 10:41:53.375 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 10:41:53.415 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 10:41:53.417 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 10:41:53.418 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 10:41:53.562 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 10:41:53.563 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4357 ms
2026-01-26 10:41:57.245 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 10:41:57.381 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 10:41:57.382 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@530e08a7]]
2026-01-26 10:41:57.384 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 10:41:57.447 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 10:41:57.489 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 10:41:58.902 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 11.223 seconds (process running for 13.123)
2026-01-26 10:41:59.926 [RMI TCP Connection(4)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 10:41:59.927 [RMI TCP Connection(4)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 10:41:59.930 [RMI TCP Connection(4)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 10:42:57.339 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 1, completed tasks = 1]
2026-01-26 10:43:05.851 [http-nio-28070-exec-5] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 10:43:13.766 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 10:43:13.764 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 1553ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'hong' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 10:43:13.777 [http-nio-28070-exec-5] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.mybatis.spring.MyBatisSystemException] with root cause
org.postgresql.util.PSQLException: ġ��������: ����� "postgres"�� password ������ �����߽��ϴ�
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:444)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:137)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:360)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:202)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:461)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:550)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:98)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:111)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:80)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:67)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at aicc.chat.config.MyBatisSqlLogger.intercept(MyBatisSqlLogger.java:45)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:59)
	at jdk.proxy2/jdk.proxy2.$Proxy141.query(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultSqlSession.java:75)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	at jdk.proxy2/jdk.proxy2.$Proxy96.selectOne(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectOne(SqlSessionTemplate.java:160)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:87)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy99.selectCustomerByLogin(Unknown Source)
	at aicc.chat.service.CustomerAuthService.login(CustomerAuthService.java:27)
	at aicc.chat.controller.CustomerLoginController.login(CustomerLoginController.java:22)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:257)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:190)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1088)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:978)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:114)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:397)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:833)
2026-01-26 10:45:49.494 [http-nio-28070-exec-10] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 10:45:50.581 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 10:45:50.581 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 1086ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'hong' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 10:45:50.583 [http-nio-28070-exec-10] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.mybatis.spring.MyBatisSystemException] with root cause
org.postgresql.util.PSQLException: ġ��������: ����� "postgres"�� password ������ �����߽��ϴ�
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:444)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:137)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:360)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:202)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:461)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:550)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:98)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:111)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:80)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:67)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at aicc.chat.config.MyBatisSqlLogger.intercept(MyBatisSqlLogger.java:45)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:59)
	at jdk.proxy2/jdk.proxy2.$Proxy141.query(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultSqlSession.java:75)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	at jdk.proxy2/jdk.proxy2.$Proxy96.selectOne(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectOne(SqlSessionTemplate.java:160)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:87)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy99.selectCustomerByLogin(Unknown Source)
	at aicc.chat.service.CustomerAuthService.login(CustomerAuthService.java:27)
	at aicc.chat.controller.CustomerLoginController.login(CustomerLoginController.java:22)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:257)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:190)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1088)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:978)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:114)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:397)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:833)
2026-01-26 10:46:12.153 [http-nio-28070-exec-8] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 10:46:13.229 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 10:46:13.229 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 1075ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 10:46:13.230 [http-nio-28070-exec-8] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.mybatis.spring.MyBatisSystemException] with root cause
org.postgresql.util.PSQLException: ġ��������: ����� "postgres"�� password ������ �����߽��ϴ�
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:444)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:137)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:360)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:202)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:461)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:550)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:98)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:111)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:80)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:67)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at aicc.chat.config.MyBatisSqlLogger.intercept(MyBatisSqlLogger.java:45)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:59)
	at jdk.proxy2/jdk.proxy2.$Proxy141.query(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultSqlSession.java:75)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	at jdk.proxy2/jdk.proxy2.$Proxy96.selectOne(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectOne(SqlSessionTemplate.java:160)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:87)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy99.selectCustomerByLogin(Unknown Source)
	at aicc.chat.service.CustomerAuthService.login(CustomerAuthService.java:27)
	at aicc.chat.controller.CustomerLoginController.login(CustomerLoginController.java:22)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:257)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:190)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1088)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:978)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:114)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:397)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:833)
2026-01-26 10:48:49.957 [RMI TCP Connection(13)-127.0.0.1] INFO  o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application shutdown requested.
2026-01-26 10:48:49.974 [RMI TCP Connection(13)-127.0.0.1] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-26 10:48:49.977 [tomcat-shutdown] INFO  o.a.coyote.http11.Http11NioProtocol - Pausing ProtocolHandler ["http-nio-28070"]
2026-01-26 10:48:50.629 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-26 10:48:50.630 [RMI TCP Connection(13)-127.0.0.1] INFO  o.a.coyote.http11.Http11NioProtocol - Stopping ProtocolHandler ["http-nio-28070"]
2026-01-26 10:48:50.632 [RMI TCP Connection(13)-127.0.0.1] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2026-01-26 10:48:50.633 [RMI TCP Connection(13)-127.0.0.1] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@530e08a7]]
2026-01-26 10:48:50.633 [RMI TCP Connection(13)-127.0.0.1] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2026-01-26 10:51:46.884 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 28124 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 10:51:46.889 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 10:51:48.959 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 10:51:48.967 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 10:51:49.054 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 47 ms. Found 0 Redis repository interfaces.
2026-01-26 10:51:50.254 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 10:51:50.276 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 10:51:50.279 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 10:51:50.281 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 10:51:50.431 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 10:51:50.431 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3440 ms
2026-01-26 10:51:53.200 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 10:51:53.287 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 10:51:53.288 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1977b0df]]
2026-01-26 10:51:53.290 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 10:51:53.336 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 10:51:53.362 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 10:51:54.297 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 8.744 seconds (process running for 10.652)
2026-01-26 10:51:56.099 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 10:51:56.099 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 10:51:56.102 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2026-01-26 10:52:08.208 [http-nio-28070-exec-8] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 10:52:53.247 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 1, completed tasks = 1]
2026-01-26 10:53:12.618 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 10:53:12.617 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 64377ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'hong' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 10:53:12.626 [http-nio-28070-exec-8] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.mybatis.spring.MyBatisSystemException] with root cause
org.postgresql.util.PSQLException: ġ��������: ����� "postgres"�� password ������ �����߽��ϴ�
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:444)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:137)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:360)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:202)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:461)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:550)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:98)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:111)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	at org.mybatis.spring.transaction.SpringManagedTransaction.openConnection(SpringManagedTransaction.java:80)
	at org.mybatis.spring.transaction.SpringManagedTransaction.getConnection(SpringManagedTransaction.java:67)
	at org.apache.ibatis.executor.BaseExecutor.getConnection(BaseExecutor.java:348)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:89)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at aicc.chat.config.MyBatisSqlLogger.intercept(MyBatisSqlLogger.java:45)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:59)
	at jdk.proxy2/jdk.proxy2.$Proxy141.query(Unknown Source)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultSqlSession.java:75)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	at jdk.proxy2/jdk.proxy2.$Proxy96.selectOne(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectOne(SqlSessionTemplate.java:160)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:87)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy99.selectCustomerByLogin(Unknown Source)
	at aicc.chat.service.CustomerAuthService.login(CustomerAuthService.java:27)
	at aicc.chat.controller.CustomerLoginController.login(CustomerLoginController.java:22)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:257)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:190)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1088)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:978)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:114)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:397)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:833)
2026-01-26 10:58:08.799 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 49900 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 10:58:08.804 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 10:58:10.607 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 10:58:10.614 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 10:58:10.669 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 28 ms. Found 0 Redis repository interfaces.
2026-01-26 10:58:11.668 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 10:58:11.689 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 10:58:11.693 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 10:58:11.694 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 10:58:11.835 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 10:58:11.836 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2957 ms
2026-01-26 10:58:14.640 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 10:58:14.763 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 10:58:14.764 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@14980819]]
2026-01-26 10:58:14.766 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 10:58:14.804 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 10:58:14.831 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 10:58:15.774 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 7.983 seconds (process running for 9.361)
2026-01-26 10:58:15.850 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 10:58:15.850 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 10:58:15.854 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 10:59:14.727 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 1, completed tasks = 1]
2026-01-26 11:29:14.784 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 32]
2026-01-26 11:59:14.841 [MessageBroker-6] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 63]
2026-01-26 12:29:14.855 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 94]
2026-01-26 12:44:48.420 [http-nio-28070-exec-3] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:44:49.153 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:44:49.152 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 651ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'hong' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:45:15.280 [http-nio-28070-exec-6] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:45:15.286 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:45:15.286 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'customer01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:45:34.778 [http-nio-28070-exec-9] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:45:34.791 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:45:34.791 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 11ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:46:00.445 [http-nio-28070-exec-8] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:46:00.450 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:46:00.450 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 3ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:46:11.922 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:46:11.930 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:46:11.929 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 5ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:46:57.188 [http-nio-28070-exec-3] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:46:57.204 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:46:57.204 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 13ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:49:08.464 [http-nio-28070-exec-8] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:49:08.470 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:49:08.470 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:50:20.751 [http-nio-28070-exec-3] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:50:20.755 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:50:20.755 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 3ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:50:28.890 [http-nio-28070-exec-4] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:50:28.897 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:50:28.897 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:53:40.528 [http-nio-28070-exec-10] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:53:40.537 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:53:40.537 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:53:40.585 [http-nio-28070-exec-10] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpMediaTypeNotAcceptableException: No acceptable representation]
2026-01-26 12:56:43.500 [http-nio-28070-exec-7] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:56:43.509 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:56:43.509 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 5ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:58:34.403 [http-nio-28070-exec-6] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:58:34.410 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:58:34.410 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 12:59:14.892 [MessageBroker-5] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 125]
2026-01-26 12:59:59.670 [http-nio-28070-exec-8] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 12:59:59.677 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 12:59:59.677 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:02:20.220 [http-nio-28070-exec-6] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:02:20.226 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:02:20.225 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 5ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:02:36.520 [http-nio-28070-exec-7] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:02:36.533 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:02:36.533 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 11ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:04:49.359 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:04:49.386 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:04:49.386 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 21ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:05:39.291 [http-nio-28070-exec-5] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:05:39.305 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:05:39.305 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 11ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:06:18.576 [http-nio-28070-exec-7] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:06:18.596 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:06:18.596 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 18ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:09:43.803 [http-nio-28070-exec-3] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:09:43.816 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:09:43.816 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:12:41.466 [http-nio-28070-exec-7] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:12:41.472 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:12:41.472 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:13:23.670 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:13:23.676 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:13:23.676 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 3ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:14:21.948 [http-nio-28070-exec-7] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:14:21.954 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:14:21.954 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:14:33.683 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:14:37.200 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:14:38.584 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:14:39.784 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:14:41.058 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:14:45.137 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:14:46.241 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:14:49.396 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:16:47.847 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:16:47.874 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:16:47.874 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 25ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:26:40.349 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:28:55.934 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:28:55.937 [http-nio-28070-exec-7] WARN  aicc.chat.service.TokenService - Invalid token provided: eyJ1c2VySWQiOiJjdXN0MDEiLCJ1c2VyTmFtZSI6Iu2Zjeq4uOyyoCIsInJvbGUiOiJDVVNUT01FUiIsImVtYWlsIjoiY3VzdDAxQGV4YW1wbGUuY29tIiwidG9rZW4iOm51bGwsInJvb21JZCI6bnVsbCwiY29tcGFueUlkIjoiYXMDAxIn0=
2026-01-26 13:29:14.920 [MessageBroker-6] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 156]
2026-01-26 13:29:21.869 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:29:34.799 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:29:34.800 [http-nio-28070-exec-1] WARN  aicc.chat.service.TokenService - Invalid token provided: ey1c2VySWQiOiJjdXN0MDEiLCJ1c2VyTmFtZSI6Iu2Zjeq4uOyyoCIsInJvbGUiOiJDVVNUT01FUiIsImVtYWlsIjoiY3VzdDAxQGV4YW1wbGUuY29tIiwidG9rZW4iOm51bGwsInJvb21JZCI6bnVsbCwiY29tcGFueUlkIjoiYXB0MDAxIn0=
2026-01-26 13:30:51.114 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:31:01.128 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:31:22.786 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:35:25.398 [http-nio-28070-exec-10] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:35:25.427 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:35:25.427 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 20ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:35:55.991 [http-nio-28070-exec-1] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:35:55.996 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:35:55.996 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:36:41.572 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:36:41.577 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:36:41.577 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 3ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:38:34.061 [http-nio-28070-exec-5] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:38:34.069 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:38:34.069 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 5ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:39:54.140 [http-nio-28070-exec-6] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:39:54.154 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:39:54.154 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 7ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:40:33.382 [http-nio-28070-exec-9] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 13:40:33.388 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:40:33.387 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 4ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '12334' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:43:00.890 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:57:15.872 [http-nio-28070-exec-2] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 13:57:15.896 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 13:57:15.896 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 19ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 13:57:15.912 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:57:16.020 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 13:57:16.030 [http-nio-28070-exec-5] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 13:57:16.394 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=ilbaxmdg
2026-01-26 13:57:16.395 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@7afdc07e, simpSessionId=ilbaxmdg}], simpSessionId=ilbaxmdg}
2026-01-26 13:57:16.407 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=ilbaxmdg
2026-01-26 13:57:16.417 [http-nio-28070-exec-4] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 13:59:14.947 [MessageBroker-7] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 6], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 1], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 3, completed tasks = 215]
2026-01-26 14:02:23.717 [http-nio-28070-exec-9] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 14:02:23.731 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:02:23.731 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 9ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 14:05:14.873 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=ilbaxmdg, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 14:05:14.984 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:05:15.278 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:05:15.278 [http-nio-28070-exec-6] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 14:05:15.305 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=0cctumae
2026-01-26 14:05:15.305 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@52e3688e, simpSessionId=0cctumae}], simpSessionId=0cctumae}
2026-01-26 14:05:15.311 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=0cctumae
2026-01-26 14:05:15.312 [http-nio-28070-exec-9] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 14:06:10.636 [http-nio-28070-exec-10] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'POST' is not supported]
2026-01-26 14:06:53.241 [http-nio-28070-exec-3] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'POST' is not supported]
2026-01-26 14:07:29.066 [http-nio-28070-exec-6] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'POST' is not supported]
2026-01-26 14:08:00.563 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:08:44.407 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:09:05.304 [http-nio-28070-exec-2] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'POST' is not supported]
2026-01-26 14:10:17.806 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:10:43.085 [http-nio-28070-exec-6] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'GET' is not supported]
2026-01-26 14:11:01.255 [http-nio-28070-exec-9] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 14:11:01.262 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:11:01.262 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 14:13:40.819 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:15:52.425 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:15:52.426 [http-nio-28070-exec-2] WARN  aicc.chat.service.TokenService - Invalid token provided: eyJ1c2VySWQiOiJhZ2VudDAxIiwidXNlck5hbWUiOiLsg4Hri7Tsm5AtMDEiLCJyb2xlIjoiQUdFTlQiLCJlbWFpbCI6ImFnZW50MDFAYWljYy5jb20iLCJ0b2tlbiI6bnVsbCwicm9vbUlkIjpudWxsLCJjb21wYW55SWQiOiJhcHQwMEifQ==
2026-01-26 14:15:59.032 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:15:59.033 [http-nio-28070-exec-3] WARN  aicc.chat.service.TokenService - Invalid token provided: eyJ1c2VySWQiOiJhZ2VudDAxIiwidXNlck5hbWUiOiLsg4Hri7Tsm5AtMDEiLCJyb2xlIjoiQUdFTlQiLCJlbWFpbCI6ImFnZW50MDFAYWljYy5jb20iLCJ0b2tlbiI6bnVsbCwicm9vbUlkIjpudWxsLCJjb21wYW55SWQiOiJhcHQwMEifQ==
2026-01-26 14:20:34.761 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=0cctumae, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 14:20:49.393 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:21:26.950 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:21:26.950 [http-nio-28070-exec-8] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 14:21:26.960 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=c5cgagxc
2026-01-26 14:21:26.961 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@51f8e2ca, simpSessionId=c5cgagxc}], simpSessionId=c5cgagxc}
2026-01-26 14:23:31.373 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=c5cgagxc
2026-01-26 14:23:34.476 [http-nio-28070-exec-6] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 14:23:50.740 [http-nio-28070-exec-4] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:23:50.740 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:23:51.095 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:23:51.095 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 63ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-9560637d', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T14:23:50.891301900', NOW()), NULL, COALESCE('2026-01-26T14:23:50.892298300', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:23:51.097 [http-nio-28070-exec-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-9560637d, customerId=cust01
2026-01-26 14:23:51.108 [http-nio-28070-exec-4] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-9560637d
2026-01-26 14:23:51.109 [http-nio-28070-exec-4] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-9560637d
2026-01-26 14:23:51.193 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:23:51.193 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 19ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-9560637d', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T14:23:51.171604200', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 14:23:51.194 [http-nio-28070-exec-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-9560637d, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 14:23:51.286 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:23:51.287 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-9560637d, Company: apt001
2026-01-26 14:23:51.305 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=5nkl2wcw
2026-01-26 14:23:51.305 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-9560637d, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@12a0db38, simpSessionId=5nkl2wcw}], simpSessionId=5nkl2wcw}
2026-01-26 14:23:51.314 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-9560637d, sessionId=5nkl2wcw
2026-01-26 14:23:51.440 [clientInboundChannel-31] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-9560637d
2026-01-26 14:23:51.449 [clientInboundChannel-31] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:23:51.449 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-9560637d', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T14:23:51.440465500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:23:51.449 [clientInboundChannel-31] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-9560637d, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 14:23:51.465 [clientInboundChannel-31] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:23:51.465 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 12ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:23:51.451436', updated_at = NOW() 
WHERE room_id = 'room-9560637d'
===========================================================================================================
2026-01-26 14:23:51.474 [clientInboundChannel-31] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-9560637d, current mode: BOT
2026-01-26 14:23:51.477 [clientInboundChannel-31] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 14:25:15.874 [MessageBroker-3] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-9560637d (Idle for 84406 ms)
2026-01-26 14:29:14.974 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 33], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 9], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 4, completed tasks = 686]
2026-01-26 14:31:56.243 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=5nkl2wcw, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 14:31:56.603 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:32:07.165 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:32:07.165 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:32:07.189 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:32:07.189 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T14:32:07.174486900', NOW()), NULL, COALESCE('2026-01-26T14:32:07.174486900', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:32:07.189 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-885162ab, customerId=cust01
2026-01-26 14:32:07.191 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-885162ab
2026-01-26 14:32:07.192 [http-nio-28070-exec-10] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-885162ab
2026-01-26 14:32:07.200 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:32:07.200 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T14:32:07.194221400', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 14:32:07.200 [http-nio-28070-exec-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 14:32:07.232 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:32:07.233 [http-nio-28070-exec-2] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-885162ab, Company: apt001
2026-01-26 14:32:07.260 [clientOutboundChannel-12] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=lzplgyti
2026-01-26 14:32:07.260 [clientOutboundChannel-12] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-885162ab, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@570926c2, simpSessionId=lzplgyti}], simpSessionId=lzplgyti}
2026-01-26 14:32:07.281 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-885162ab, sessionId=lzplgyti
2026-01-26 14:32:07.301 [clientInboundChannel-43] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:32:07.310 [clientInboundChannel-43] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:32:07.310 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T14:32:07.301470100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:32:07.311 [clientInboundChannel-43] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 14:32:07.316 [clientInboundChannel-43] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:32:07.316 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:32:07.312439200', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:32:07.326 [clientInboundChannel-43] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: BOT
2026-01-26 14:32:07.327 [clientInboundChannel-43] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 14:33:15.877 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-885162ab (Idle for 68554 ms)
2026-01-26 14:33:59.508 [http-nio-28070-exec-6] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:33:59.508 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:33:59.532 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:33:59.532 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-ea233eac', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T14:33:59.512378300', NOW()), NULL, COALESCE('2026-01-26T14:33:59.512378300', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:33:59.533 [http-nio-28070-exec-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-ea233eac, customerId=cust01
2026-01-26 14:33:59.534 [http-nio-28070-exec-6] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-ea233eac
2026-01-26 14:33:59.535 [http-nio-28070-exec-6] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-ea233eac
2026-01-26 14:33:59.553 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:33:59.553 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 14ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-ea233eac', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T14:33:59.536242900', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 14:33:59.553 [http-nio-28070-exec-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-ea233eac, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 14:35:15.878 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-ea233eac (Idle for 76367 ms)
2026-01-26 14:35:34.773 [http-nio-28070-exec-7] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:35:34.773 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:35:34.773 [http-nio-28070-exec-7] WARN  aicc.chat.service.TokenService - Invalid token provided: eyJ1c2VySWQiOiJjdXN0MDEiLCJ1c2VyTmFtZSI6Iu2Zjeq4uOyyoCIsInJvbGUiOiJDVVNUT01FUiIsImVtYWlsIjoiY3VzdDAxQGV4YW1wbGUuY29tIiwidG9rZW4iOm51bGwsInJvb21JZCI6bnVsbCwiY29tcGFueUlkIjoiYXB0MDAIn0=
2026-01-26 14:35:41.195 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:35:41.196 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:35:41.197 [http-nio-28070-exec-10] WARN  aicc.chat.service.TokenService - Invalid token provided: eyJ1c2VySWQiOiJjdXN0MDEiLCJ1c2VyTmFtZSI6Iu2Zjeq4uOyyoCIsInJvbGUiOiJDVVNUT01FUiIsImVtYWlsIjoiY3VzdDAxQGV4YW1wbGUuY29tIiwidG9rZW4iOm51bGwsInJvb21JZCI6bnVsbCwiY29tcGFueUlkIjoiYXB0MDAIn0=
2026-01-26 14:43:48.481 [clientInboundChannel-46] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:43:48.503 [clientInboundChannel-46] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:43:48.503 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 14ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', 'A', 'TALK', 'apt001', COALESCE('2026-01-26T14:43:48.481627900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:43:48.503 [clientInboundChannel-46] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=A
2026-01-26 14:43:48.521 [clientInboundChannel-46] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:43:48.521 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 13ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:43:48.506560400', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:43:48.525 [clientInboundChannel-46] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: BOT
2026-01-26 14:43:48.527 [clientInboundChannel-46] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-885162ab
2026-01-26 14:43:48.715 [clientInboundChannel-46] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-885162ab, CompanyId: apt001
2026-01-26 14:43:49.285 [reactor-http-nio-3] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 14:43:49.294 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:43:49.294 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T14:43:49.288555600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:43:49.295 [reactor-http-nio-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 14:43:49.300 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:43:49.300 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:43:49.296534700', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:46:29.580 [http-nio-28070-exec-1] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:46:29.580 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:46:29.597 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:46:29.597 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-bfdad172', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T14:46:29.585038800', NOW()), NULL, COALESCE('2026-01-26T14:46:29.585038800', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:46:29.597 [http-nio-28070-exec-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-bfdad172, customerId=cust01
2026-01-26 14:46:29.599 [http-nio-28070-exec-1] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-bfdad172
2026-01-26 14:46:29.600 [http-nio-28070-exec-1] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-bfdad172
2026-01-26 14:46:29.612 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:46:29.612 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-bfdad172', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T14:46:29.601013700', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 14:46:29.612 [http-nio-28070-exec-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-bfdad172, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 14:46:56.926 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:46:56.926 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:46:56.939 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:46:56.939 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-b2f53213', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T14:46:56.931668900', NOW()), NULL, COALESCE('2026-01-26T14:46:56.931668900', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:46:56.940 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-b2f53213, customerId=cust01
2026-01-26 14:46:56.940 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-b2f53213
2026-01-26 14:46:56.942 [http-nio-28070-exec-5] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-b2f53213
2026-01-26 14:46:56.947 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:46:56.947 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b2f53213', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T14:46:56.943636700', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 14:46:56.948 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b2f53213, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 14:48:15.893 [MessageBroker-8] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-bfdad172 (Idle for 106310 ms)
2026-01-26 14:48:15.898 [MessageBroker-8] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-b2f53213 (Idle for 78964 ms)
2026-01-26 14:49:38.587 [clientInboundChannel-49] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:49:38.594 [clientInboundChannel-49] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:38.594 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', 'A', 'TALK', 'apt001', COALESCE('2026-01-26T14:49:38.587017600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:38.594 [clientInboundChannel-49] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=A
2026-01-26 14:49:38.619 [clientInboundChannel-49] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:38.619 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 22ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:49:38.595994400', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:38.625 [clientInboundChannel-49] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: BOT
2026-01-26 14:49:38.626 [clientInboundChannel-49] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-885162ab
2026-01-26 14:49:38.626 [clientInboundChannel-49] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-885162ab, CompanyId: apt001
2026-01-26 14:49:38.637 [reactor-http-nio-4] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 14:49:38.650 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:38.650 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T14:49:38.639407600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:38.650 [reactor-http-nio-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 14:49:38.657 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:38.656 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:49:38.652375700', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:49.698 [clientInboundChannel-52] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:49:49.705 [clientInboundChannel-52] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:49.705 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', 'A', 'TALK', 'apt001', COALESCE('2026-01-26T14:49:49.698938200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:49.705 [clientInboundChannel-52] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=A
2026-01-26 14:49:49.711 [clientInboundChannel-52] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:49.711 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:49:49.707913200', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:49.718 [clientInboundChannel-52] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: BOT
2026-01-26 14:49:49.722 [clientInboundChannel-52] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-885162ab
2026-01-26 14:49:49.722 [clientInboundChannel-52] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-885162ab, CompanyId: apt001
2026-01-26 14:49:49.730 [reactor-http-nio-5] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 14:49:49.737 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:49.737 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T14:49:49.731857300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:49.738 [reactor-http-nio-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 14:49:49.744 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:49.744 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:49:49.739836', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:53.861 [clientInboundChannel-55] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:49:53.867 [clientInboundChannel-55] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:53.867 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', 'A', 'TALK', 'apt001', COALESCE('2026-01-26T14:49:53.861796300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:53.867 [clientInboundChannel-55] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=A
2026-01-26 14:49:53.871 [clientInboundChannel-55] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:53.871 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:49:53.868777700', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:53.875 [clientInboundChannel-55] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: BOT
2026-01-26 14:49:53.876 [clientInboundChannel-55] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-885162ab
2026-01-26 14:49:53.877 [clientInboundChannel-55] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-885162ab, CompanyId: apt001
2026-01-26 14:49:53.884 [reactor-http-nio-6] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 14:49:53.893 [reactor-http-nio-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:53.893 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T14:49:53.888726100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:53.894 [reactor-http-nio-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 14:49:53.898 [reactor-http-nio-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:53.897 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:49:53.895707400', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:59.852 [clientInboundChannel-58] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:49:59.860 [clientInboundChannel-58] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:59.860 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T14:49:59.852712900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:59.861 [clientInboundChannel-58] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 14:49:59.865 [clientInboundChannel-58] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:59.865 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:49:59.861690400', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:59.883 [clientInboundChannel-58] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: BOT
2026-01-26 14:49:59.886 [clientInboundChannel-58] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-885162ab to WAITING mode
2026-01-26 14:49:59.901 [clientInboundChannel-58] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:59.901 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:49:59.902 [clientInboundChannel-58] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-885162ab, status=WAITING
2026-01-26 14:49:59.911 [clientInboundChannel-58] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:49:59.911 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T14:49:59.905095600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:49:59.911 [clientInboundChannel-58] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 14:50:43.764 [clientInboundChannel-61] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:50:43.772 [clientInboundChannel-61] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:50:43.772 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T14:50:43.764552500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:50:43.772 [clientInboundChannel-61] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 14:50:43.778 [clientInboundChannel-61] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:50:43.778 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:50:43.773529700', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:50:43.783 [clientInboundChannel-61] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: WAITING
2026-01-26 14:50:43.783 [clientInboundChannel-61] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-885162ab
2026-01-26 14:50:45.025 [clientInboundChannel-64] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-885162ab
2026-01-26 14:50:45.028 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=lzplgyti, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 14:50:45.032 [clientInboundChannel-64] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:50:45.032 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-885162ab', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T14:50:45.025704100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:50:45.032 [clientInboundChannel-64] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-885162ab, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 14:50:45.037 [clientInboundChannel-64] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:50:45.037 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:50:45.033682200', updated_at = NOW() 
WHERE room_id = 'room-885162ab'
===========================================================================================================
2026-01-26 14:50:45.042 [clientInboundChannel-64] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-885162ab is being closed due to LEAVE message
2026-01-26 14:50:45.049 [clientInboundChannel-64] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-885162ab, current mode: CLOSED
2026-01-26 14:50:45.050 [clientInboundChannel-64] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 14:51:10.979 [http-nio-28070-exec-1] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:51:10.980 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:51:10.993 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:51:10.993 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-e3fa6f2a', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T14:51:10.986092800', NOW()), NULL, COALESCE('2026-01-26T14:51:10.986092800', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:51:10.993 [http-nio-28070-exec-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-e3fa6f2a, customerId=cust01
2026-01-26 14:51:10.994 [http-nio-28070-exec-1] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-e3fa6f2a
2026-01-26 14:51:10.995 [http-nio-28070-exec-1] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-e3fa6f2a
2026-01-26 14:51:11.002 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:51:11.002 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e3fa6f2a', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T14:51:10.996060600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 14:51:11.002 [http-nio-28070-exec-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e3fa6f2a, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 14:51:11.053 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:51:11.053 [http-nio-28070-exec-5] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-e3fa6f2a, Company: apt001
2026-01-26 14:51:11.070 [clientOutboundChannel-36] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=hs20spci
2026-01-26 14:51:11.070 [clientOutboundChannel-36] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-e3fa6f2a, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@69ac4a12, simpSessionId=hs20spci}], simpSessionId=hs20spci}
2026-01-26 14:51:11.077 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e3fa6f2a, sessionId=hs20spci
2026-01-26 14:51:11.090 [clientInboundChannel-61] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-e3fa6f2a
2026-01-26 14:51:11.095 [clientInboundChannel-61] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:51:11.095 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e3fa6f2a', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T14:51:11.090454300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:51:11.095 [clientInboundChannel-61] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e3fa6f2a, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 14:51:11.103 [clientInboundChannel-61] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:51:11.103 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:51:11.099428', updated_at = NOW() 
WHERE room_id = 'room-e3fa6f2a'
===========================================================================================================
2026-01-26 14:51:11.109 [clientInboundChannel-61] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-e3fa6f2a, current mode: BOT
2026-01-26 14:51:11.110 [clientInboundChannel-61] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 14:51:17.134 [clientInboundChannel-66] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-e3fa6f2a
2026-01-26 14:51:17.134 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=hs20spci, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 14:51:17.139 [clientInboundChannel-66] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:51:17.139 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e3fa6f2a', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T14:51:17.134248600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:51:17.139 [clientInboundChannel-66] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e3fa6f2a, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 14:51:17.143 [clientInboundChannel-66] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:51:17.143 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 1ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:51:17.140233400', updated_at = NOW() 
WHERE room_id = 'room-e3fa6f2a'
===========================================================================================================
2026-01-26 14:51:17.149 [clientInboundChannel-66] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-e3fa6f2a is being closed due to LEAVE message
2026-01-26 14:51:17.159 [clientInboundChannel-66] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-e3fa6f2a, current mode: CLOSED
2026-01-26 14:51:17.162 [clientInboundChannel-66] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 14:52:17.479 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 14:52:17.479 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:52:17.490 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:52:17.490 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-1761b5eb', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T14:52:17.485824100', NOW()), NULL, COALESCE('2026-01-26T14:52:17.485824100', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:52:17.491 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-1761b5eb, customerId=cust01
2026-01-26 14:52:17.491 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-1761b5eb
2026-01-26 14:52:17.492 [http-nio-28070-exec-10] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-1761b5eb
2026-01-26 14:52:17.498 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:52:17.498 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-1761b5eb', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T14:52:17.494797', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 14:52:17.498 [http-nio-28070-exec-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-1761b5eb, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 14:52:17.553 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 14:52:17.554 [http-nio-28070-exec-2] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-1761b5eb, Company: apt001
2026-01-26 14:52:17.616 [clientOutboundChannel-42] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=tqdeq00h
2026-01-26 14:52:17.616 [clientOutboundChannel-42] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-1761b5eb, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@6a5d958e, simpSessionId=tqdeq00h}], simpSessionId=tqdeq00h}
2026-01-26 14:52:17.627 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-1761b5eb, sessionId=tqdeq00h
2026-01-26 14:52:17.645 [clientInboundChannel-78] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-1761b5eb
2026-01-26 14:52:17.651 [clientInboundChannel-78] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:52:17.651 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-1761b5eb', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T14:52:17.645088800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:52:17.652 [clientInboundChannel-78] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-1761b5eb, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 14:52:17.657 [clientInboundChannel-78] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:52:17.657 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:52:17.653072800', updated_at = NOW() 
WHERE room_id = 'room-1761b5eb'
===========================================================================================================
2026-01-26 14:52:17.661 [clientInboundChannel-78] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-1761b5eb, current mode: BOT
2026-01-26 14:52:17.662 [clientInboundChannel-78] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 14:52:30.406 [clientInboundChannel-81] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-1761b5eb
2026-01-26 14:52:30.407 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=tqdeq00h, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 14:52:30.417 [clientInboundChannel-81] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:52:30.417 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-1761b5eb', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T14:52:30.406661700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 14:52:30.417 [clientInboundChannel-81] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-1761b5eb, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 14:52:30.421 [clientInboundChannel-81] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 14:52:30.421 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T14:52:30.418016900', updated_at = NOW() 
WHERE room_id = 'room-1761b5eb'
===========================================================================================================
2026-01-26 14:52:30.426 [clientInboundChannel-81] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-1761b5eb is being closed due to LEAVE message
2026-01-26 14:52:30.437 [clientInboundChannel-81] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-1761b5eb, current mode: CLOSED
2026-01-26 14:52:30.439 [clientInboundChannel-81] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 14:53:15.887 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-e3fa6f2a (Idle for 118740 ms)
2026-01-26 14:54:15.884 [MessageBroker-3] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-1761b5eb (Idle for 105459 ms)
2026-01-26 14:59:15.000 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 7 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(7)-CONNECTED(7)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 108], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 48], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 3, completed tasks = 1191]
2026-01-26 15:12:23.024 [http-nio-28070-exec-4] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 15:12:23.025 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:12:23.105 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:12:23.105 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 13ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-3088d5dd', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T15:12:23.037500100', NOW()), NULL, COALESCE('2026-01-26T15:12:23.037500100', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:12:23.106 [http-nio-28070-exec-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-3088d5dd, customerId=cust01
2026-01-26 15:12:23.108 [http-nio-28070-exec-4] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-3088d5dd
2026-01-26 15:12:23.109 [http-nio-28070-exec-4] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-3088d5dd
2026-01-26 15:12:23.121 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:12:23.121 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-3088d5dd', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T15:12:23.113168800', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 15:12:23.122 [http-nio-28070-exec-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-3088d5dd, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 15:12:23.175 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:12:23.176 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-3088d5dd, Company: apt001
2026-01-26 15:12:23.202 [clientOutboundChannel-50] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=shdexffh
2026-01-26 15:12:23.202 [clientOutboundChannel-50] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-3088d5dd, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@15e2e705, simpSessionId=shdexffh}], simpSessionId=shdexffh}
2026-01-26 15:12:23.212 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-3088d5dd, sessionId=shdexffh
2026-01-26 15:12:23.234 [clientInboundChannel-94] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-3088d5dd
2026-01-26 15:12:23.240 [clientInboundChannel-94] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:12:23.240 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-3088d5dd', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T15:12:23.234377700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:12:23.241 [clientInboundChannel-94] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-3088d5dd, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 15:12:23.258 [clientInboundChannel-94] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:12:23.258 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 14ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:12:23.242354900', updated_at = NOW() 
WHERE room_id = 'room-3088d5dd'
===========================================================================================================
2026-01-26 15:12:23.266 [clientInboundChannel-94] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-3088d5dd, current mode: BOT
2026-01-26 15:12:23.269 [clientInboundChannel-94] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 15:14:15.896 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-3088d5dd (Idle for 112635 ms)
2026-01-26 15:15:11.694 [clientInboundChannel-97] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-3088d5dd
2026-01-26 15:15:11.700 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=shdexffh, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 15:15:11.710 [clientInboundChannel-97] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:15:11.710 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 11ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-3088d5dd', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T15:15:11.695801700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:15:11.711 [clientInboundChannel-97] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-3088d5dd, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 15:15:11.728 [clientInboundChannel-97] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:15:11.727 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 12ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:15:11.714751700', updated_at = NOW() 
WHERE room_id = 'room-3088d5dd'
===========================================================================================================
2026-01-26 15:15:11.731 [clientInboundChannel-97] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-3088d5dd is being closed due to LEAVE message
2026-01-26 15:15:11.735 [clientInboundChannel-97] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-3088d5dd, current mode: CLOSED
2026-01-26 15:15:11.736 [clientInboundChannel-97] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 15:16:41.337 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 15:16:41.338 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:16:41.358 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:16:41.358 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-08efd106', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T15:16:41.345556500', NOW()), NULL, COALESCE('2026-01-26T15:16:41.345556500', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:16:41.359 [http-nio-28070-exec-3] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-08efd106, customerId=cust01
2026-01-26 15:16:41.361 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-08efd106
2026-01-26 15:16:41.363 [http-nio-28070-exec-3] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-08efd106
2026-01-26 15:16:41.371 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:16:41.371 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-08efd106', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T15:16:41.366508700', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 15:16:41.372 [http-nio-28070-exec-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-08efd106, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 15:16:41.409 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:16:41.410 [http-nio-28070-exec-6] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-08efd106, Company: apt001
2026-01-26 15:16:41.432 [clientOutboundChannel-57] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=2z4unlxs
2026-01-26 15:16:41.432 [clientOutboundChannel-57] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-08efd106, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@51a18c86, simpSessionId=2z4unlxs}], simpSessionId=2z4unlxs}
2026-01-26 15:16:41.440 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-08efd106, sessionId=2z4unlxs
2026-01-26 15:16:41.465 [clientInboundChannel-112] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-08efd106
2026-01-26 15:16:41.473 [clientInboundChannel-112] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:16:41.473 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-08efd106', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T15:16:41.466703100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:16:41.474 [clientInboundChannel-112] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-08efd106, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 15:16:41.479 [clientInboundChannel-112] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:16:41.479 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:16:41.476190200', updated_at = NOW() 
WHERE room_id = 'room-08efd106'
===========================================================================================================
2026-01-26 15:16:41.487 [clientInboundChannel-112] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-08efd106, current mode: BOT
2026-01-26 15:16:41.489 [clientInboundChannel-112] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 15:16:54.814 [clientInboundChannel-115] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-08efd106
2026-01-26 15:16:54.815 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=2z4unlxs, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 15:16:54.824 [clientInboundChannel-115] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:16:54.823 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-08efd106', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T15:16:54.814793900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:16:54.825 [clientInboundChannel-115] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-08efd106, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 15:16:54.830 [clientInboundChannel-115] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:16:54.829 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:16:54.826760', updated_at = NOW() 
WHERE room_id = 'room-08efd106'
===========================================================================================================
2026-01-26 15:16:54.834 [clientInboundChannel-115] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-08efd106 is being closed due to LEAVE message
2026-01-26 15:16:54.847 [clientInboundChannel-115] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-08efd106, current mode: CLOSED
2026-01-26 15:16:54.848 [clientInboundChannel-115] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 15:18:15.893 [MessageBroker-7] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-08efd106 (Idle for 81060 ms)
2026-01-26 15:21:21.845 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 14472 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 15:21:21.852 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 15:21:24.393 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 15:21:24.399 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 15:21:24.465 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 33 ms. Found 0 Redis repository interfaces.
2026-01-26 15:21:25.573 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 15:21:25.593 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 15:21:25.596 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 15:21:25.597 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 15:21:25.734 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 15:21:25.735 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3772 ms
2026-01-26 15:21:28.834 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 15:21:28.946 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 15:21:28.947 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@367fbb28]]
2026-01-26 15:21:28.949 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 15:21:29.001 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 15:21:29.027 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 15:21:29.989 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 9.191 seconds (process running for 11.134)
2026-01-26 15:21:31.252 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 15:21:31.252 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 15:21:31.254 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2026-01-26 15:21:46.767 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:21:53.408 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 15:21:53.409 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:21:53.904 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:21:53.904 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 84ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-dba1f913', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T15:21:53.432267400', NOW()), NULL, COALESCE('2026-01-26T15:21:53.433265100', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:21:53.906 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-dba1f913, customerId=cust01
2026-01-26 15:21:53.918 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-dba1f913
2026-01-26 15:21:53.920 [http-nio-28070-exec-5] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-dba1f913
2026-01-26 15:21:53.940 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:21:53.939 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-dba1f913', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T15:21:53.928038700', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 15:21:53.942 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-dba1f913, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 15:21:54.001 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:21:54.002 [http-nio-28070-exec-6] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-dba1f913, Company: apt001
2026-01-26 15:21:54.161 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=y5dhv5o3
2026-01-26 15:21:54.162 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-dba1f913, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@7df580ee, simpSessionId=y5dhv5o3}], simpSessionId=y5dhv5o3}
2026-01-26 15:21:54.171 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-dba1f913, sessionId=y5dhv5o3
2026-01-26 15:21:54.215 [clientInboundChannel-7] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-dba1f913
2026-01-26 15:21:54.227 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:21:54.227 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-dba1f913', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T15:21:54.216574600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:21:54.229 [clientInboundChannel-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-dba1f913, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 15:21:54.282 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:21:54.282 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 34ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:21:54.244030500', updated_at = NOW() 
WHERE room_id = 'room-dba1f913'
===========================================================================================================
2026-01-26 15:21:54.292 [clientInboundChannel-7] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-dba1f913, current mode: BOT
2026-01-26 15:21:54.295 [clientInboundChannel-7] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 15:22:15.996 [clientInboundChannel-10] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-dba1f913
2026-01-26 15:22:15.999 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=y5dhv5o3, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 15:22:16.009 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:22:16.009 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-dba1f913', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T15:22:15.996598300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:22:16.010 [clientInboundChannel-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-dba1f913, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 15:22:16.020 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:22:16.020 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:22:16.013552400', updated_at = NOW() 
WHERE room_id = 'room-dba1f913'
===========================================================================================================
2026-01-26 15:22:16.025 [clientInboundChannel-10] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-dba1f913 is being closed due to LEAVE message
2026-01-26 15:22:16.039 [clientInboundChannel-10] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-dba1f913, current mode: CLOSED
2026-01-26 15:22:16.041 [clientInboundChannel-10] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 15:22:28.895 [MessageBroker-5] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 16, active threads = 0, queued tasks = 0, completed tasks = 18], outboundChannel[pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 4], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 8]
2026-01-26 15:23:29.993 [MessageBroker-3] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-dba1f913 (Idle for 73969 ms)
2026-01-26 15:25:26.987 [http-nio-28070-exec-1] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 15:25:26.988 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:25:27.024 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:25:27.024 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 16ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-6c736bd7', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T15:25:26.999273200', NOW()), NULL, COALESCE('2026-01-26T15:25:26.999273200', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:25:27.026 [http-nio-28070-exec-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-6c736bd7, customerId=cust01
2026-01-26 15:25:27.030 [http-nio-28070-exec-1] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-6c736bd7
2026-01-26 15:25:27.032 [http-nio-28070-exec-1] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-6c736bd7
2026-01-26 15:25:27.052 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:25:27.052 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 11ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-6c736bd7', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T15:25:27.035708900', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 15:25:27.054 [http-nio-28070-exec-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-6c736bd7, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 15:25:27.111 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:25:27.112 [http-nio-28070-exec-3] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-6c736bd7, Company: apt001
2026-01-26 15:25:27.137 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=mlgk5gek
2026-01-26 15:25:27.144 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-6c736bd7, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@53c3c1ef, simpSessionId=mlgk5gek}], simpSessionId=mlgk5gek}
2026-01-26 15:25:27.159 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-6c736bd7, sessionId=mlgk5gek
2026-01-26 15:25:33.810 [clientInboundChannel-23] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-6c736bd7
2026-01-26 15:25:33.817 [clientInboundChannel-23] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:25:33.817 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-6c736bd7', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T15:25:33.810992500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:25:33.818 [clientInboundChannel-23] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-6c736bd7, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 15:25:33.825 [clientInboundChannel-23] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:25:33.825 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:25:33.821962800', updated_at = NOW() 
WHERE room_id = 'room-6c736bd7'
===========================================================================================================
2026-01-26 15:25:33.831 [clientInboundChannel-23] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-6c736bd7, current mode: BOT
2026-01-26 15:25:33.832 [clientInboundChannel-23] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 15:25:44.269 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=mlgk5gek, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 15:27:30.001 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-6c736bd7 (Idle for 116172 ms)
2026-01-26 15:36:05.094 [clientInboundChannel-26] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-6c736bd7
2026-01-26 15:36:05.133 [clientInboundChannel-26] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:36:05.132 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 29ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-6c736bd7', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T15:36:05.095551100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:36:05.134 [clientInboundChannel-26] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-6c736bd7, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 15:36:05.143 [clientInboundChannel-26] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:36:05.143 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:36:05.137954700', updated_at = NOW() 
WHERE room_id = 'room-6c736bd7'
===========================================================================================================
2026-01-26 15:36:05.151 [clientInboundChannel-26] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-6c736bd7 is being closed due to LEAVE message
2026-01-26 15:36:05.157 [clientInboundChannel-26] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-6c736bd7, current mode: CLOSED
2026-01-26 15:36:05.161 [clientInboundChannel-26] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 15:39:43.856 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 11012 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 15:39:43.862 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 15:39:46.168 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 15:39:46.174 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 15:39:46.247 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 38 ms. Found 0 Redis repository interfaces.
2026-01-26 15:39:47.462 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 15:39:47.484 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 15:39:47.488 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 15:39:47.489 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 15:39:47.633 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 15:39:47.634 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3674 ms
2026-01-26 15:39:50.577 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 15:39:50.673 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 15:39:50.674 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6b286640]]
2026-01-26 15:39:50.677 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 15:39:50.728 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 15:39:50.755 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 15:39:51.672 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 9.077 seconds (process running for 11.013)
2026-01-26 15:39:53.058 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 15:39:53.058 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 15:39:53.061 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2026-01-26 15:40:08.229 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:40:50.640 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 1, completed tasks = 1]
2026-01-26 15:43:44.138 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 28352 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 15:43:44.143 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 15:43:46.139 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 15:43:46.144 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 15:43:46.209 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 Redis repository interfaces.
2026-01-26 15:43:47.284 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 15:43:47.304 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 15:43:47.307 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 15:43:47.308 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 15:43:47.444 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 15:43:47.445 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3225 ms
2026-01-26 15:43:50.303 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 15:43:50.401 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 15:43:50.402 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@14980819]]
2026-01-26 15:43:50.404 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 15:43:50.452 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 15:43:50.479 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 15:43:51.000 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 15:43:51.000 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 15:43:51.003 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 15:43:51.573 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 8.483 seconds (process running for 10.018)
2026-01-26 15:44:50.367 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 1, completed tasks = 1]
2026-01-26 15:45:24.614 [main] ERROR o.s.boot.SpringApplication - Application run failed
java.lang.IllegalStateException: java.lang.IllegalStateException: Logback configuration error detected: 
ERROR in ch.qos.logback.classic.pattern.ClassOfCallerConverter@677dbd89 - failed to parse integer string [48.48] java.lang.NumberFormatException: For input string: "48.48"
	at org.springframework.boot.context.logging.LoggingApplicationListener.initializeSystem(LoggingApplicationListener.java:347)
	at org.springframework.boot.context.logging.LoggingApplicationListener.initialize(LoggingApplicationListener.java:298)
	at org.springframework.boot.context.logging.LoggingApplicationListener.onApplicationEnvironmentPreparedEvent(LoggingApplicationListener.java:246)
	at org.springframework.boot.context.logging.LoggingApplicationListener.onApplicationEvent(LoggingApplicationListener.java:223)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:185)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:178)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:156)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:138)
	at org.springframework.boot.context.event.EventPublishingRunListener.multicastInitialEvent(EventPublishingRunListener.java:136)
	at org.springframework.boot.context.event.EventPublishingRunListener.environmentPrepared(EventPublishingRunListener.java:81)
	at org.springframework.boot.SpringApplicationRunListeners.lambda$environmentPrepared$2(SpringApplicationRunListeners.java:64)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:118)
	at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:112)
	at org.springframework.boot.SpringApplicationRunListeners.environmentPrepared(SpringApplicationRunListeners.java:63)
	at org.springframework.boot.SpringApplication.prepareEnvironment(SpringApplication.java:353)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:313)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350)
	at aicc.AiccChatApplication.main(AiccChatApplication.java:14)
Caused by: java.lang.IllegalStateException: Logback configuration error detected: 
ERROR in ch.qos.logback.classic.pattern.ClassOfCallerConverter@677dbd89 - failed to parse integer string [48.48] java.lang.NumberFormatException: For input string: "48.48"
	at org.springframework.boot.logging.logback.LogbackLoggingSystem.reportConfigurationErrorsIfNecessary(LogbackLoggingSystem.java:291)
	at org.springframework.boot.logging.logback.LogbackLoggingSystem.loadConfiguration(LogbackLoggingSystem.java:269)
	at org.springframework.boot.logging.AbstractLoggingSystem.initializeWithConventions(AbstractLoggingSystem.java:81)
	at org.springframework.boot.logging.AbstractLoggingSystem.initialize(AbstractLoggingSystem.java:61)
	at org.springframework.boot.logging.logback.LogbackLoggingSystem.initialize(LogbackLoggingSystem.java:197)
	at org.springframework.boot.context.logging.LoggingApplicationListener.initializeSystem(LoggingApplicationListener.java:332)
	... 19 common frames omitted
	Suppressed: java.lang.NumberFormatException: For input string: "48.48"
		at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:67)
		at java.base/java.lang.Integer.parseInt(Integer.java:668)
		at java.base/java.lang.Integer.parseInt(Integer.java:786)
		at ch.qos.logback.classic.pattern.NamedConverter.start(NamedConverter.java:92)
		at ch.qos.logback.core.pattern.ConverterUtil.startConverters(ConverterUtil.java:37)
		at ch.qos.logback.core.pattern.PatternLayoutBase.start(PatternLayoutBase.java:90)
		at ch.qos.logback.classic.encoder.PatternLayoutEncoder.start(PatternLayoutEncoder.java:28)
		at ch.qos.logback.core.model.processor.ImplicitModelHandler.postHandleComplex(ImplicitModelHandler.java:207)
		at ch.qos.logback.core.model.processor.ImplicitModelHandler.postHandle(ImplicitModelHandler.java:186)
		at ch.qos.logback.core.model.processor.DefaultProcessor.secondPhaseTraverse(DefaultProcessor.java:257)
		at ch.qos.logback.core.model.processor.DefaultProcessor.secondPhaseTraverse(DefaultProcessor.java:253)
		at ch.qos.logback.core.model.processor.DefaultProcessor.secondPhaseTraverse(DefaultProcessor.java:253)
		at ch.qos.logback.core.model.processor.DefaultProcessor.traversalLoop(DefaultProcessor.java:90)
		at ch.qos.logback.core.model.processor.DefaultProcessor.process(DefaultProcessor.java:106)
		at ch.qos.logback.core.joran.GenericXMLConfigurator.processModel(GenericXMLConfigurator.java:222)
		at org.springframework.boot.logging.logback.SpringBootJoranConfigurator.processModel(SpringBootJoranConfigurator.java:136)
		at ch.qos.logback.core.joran.GenericXMLConfigurator.doConfigure(GenericXMLConfigurator.java:178)
		at ch.qos.logback.core.joran.GenericXMLConfigurator.doConfigure(GenericXMLConfigurator.java:123)
		at ch.qos.logback.core.joran.GenericXMLConfigurator.doConfigure(GenericXMLConfigurator.java:66)
		at org.springframework.boot.logging.logback.LogbackLoggingSystem.configureByResourceUrl(LogbackLoggingSystem.java:300)
		at org.springframework.boot.logging.logback.LogbackLoggingSystem.lambda$loadConfiguration$2(LogbackLoggingSystem.java:262)
		at org.springframework.boot.logging.logback.LogbackLoggingSystem.withLoggingSuppressed(LogbackLoggingSystem.java:483)
		at org.springframework.boot.logging.logback.LogbackLoggingSystem.loadConfiguration(LogbackLoggingSystem.java:255)
		... 23 common frames omitted
2026-01-26 15:46:35.217 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 29248 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 15:46:35.221 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 15:46:37.073 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 15:46:37.081 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 15:46:37.144 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 35 ms. Found 0 Redis repository interfaces.
2026-01-26 15:46:38.258 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 15:46:38.276 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 15:46:38.278 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 15:46:38.279 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 15:46:38.414 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 15:46:38.415 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3121 ms
2026-01-26 15:46:41.002 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 15:46:41.103 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 15:46:41.105 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@294a12b5]]
2026-01-26 15:46:41.106 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 15:46:41.144 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 15:46:41.170 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 15:46:42.116 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 7.857 seconds (process running for 9.295)
2026-01-26 15:46:42.192 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 15:46:42.193 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 15:46:42.198 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 4 ms
2026-01-26 15:46:49.625 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:46:54.241 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 15:46:54.241 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:46:54.718 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:46:54.718 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 107ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-07f96ead', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T15:46:54.263123200', NOW()), NULL, COALESCE('2026-01-26T15:46:54.263123200', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:46:54.721 [http-nio-28070-exec-3] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-07f96ead, customerId=cust01
2026-01-26 15:46:54.731 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-07f96ead
2026-01-26 15:46:54.734 [http-nio-28070-exec-3] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-07f96ead
2026-01-26 15:46:54.757 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:46:54.756 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-07f96ead', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T15:46:54.743402400', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 15:46:54.758 [http-nio-28070-exec-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-07f96ead, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 15:46:54.820 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:46:54.821 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-07f96ead, Company: apt001
2026-01-26 15:46:55.021 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=xvowhw0u
2026-01-26 15:46:55.024 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-07f96ead, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@1a811bb2, simpSessionId=xvowhw0u}], simpSessionId=xvowhw0u}
2026-01-26 15:46:55.032 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-07f96ead, sessionId=xvowhw0u
2026-01-26 15:47:03.779 [clientInboundChannel-7] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-07f96ead
2026-01-26 15:47:03.791 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:47:03.791 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-07f96ead', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T15:47:03.779568900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:47:03.793 [clientInboundChannel-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-07f96ead, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 15:47:03.817 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:47:03.817 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 16ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:47:03.797046100', updated_at = NOW() 
WHERE room_id = 'room-07f96ead'
===========================================================================================================
2026-01-26 15:47:03.823 [clientInboundChannel-7] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-07f96ead, current mode: BOT
2026-01-26 15:47:03.826 [clientInboundChannel-7] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 15:47:41.065 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 9, active threads = 0, queued tasks = 0, completed tasks = 9], outboundChannel[pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 2], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 3, completed tasks = 12]
2026-01-26 15:48:34.292 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 32244 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 15:48:34.297 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 15:48:36.037 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 15:48:36.041 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 15:48:36.101 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 30 ms. Found 0 Redis repository interfaces.
2026-01-26 15:48:37.220 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 15:48:37.242 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 15:48:37.246 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 15:48:37.247 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 15:48:37.386 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 15:48:37.387 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3018 ms
2026-01-26 15:48:40.030 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 15:48:40.136 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 15:48:40.137 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@48301bfe]]
2026-01-26 15:48:40.139 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 15:48:40.181 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 15:48:40.207 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 15:48:41.248 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 7.9 seconds (process running for 9.432)
2026-01-26 15:48:41.270 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 15:48:41.271 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 15:48:41.275 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 15:48:41.315 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-07f96ead (Idle for 97495 ms)
2026-01-26 15:48:47.376 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:48:50.783 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 15:48:50.788 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:48:51.419 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:48:51.419 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 120ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-23a70999', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T15:48:50.810190700', NOW()), NULL, COALESCE('2026-01-26T15:48:50.811188500', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:48:51.422 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-23a70999, customerId=cust01
2026-01-26 15:48:51.433 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-23a70999
2026-01-26 15:48:51.436 [http-nio-28070-exec-5] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-23a70999
2026-01-26 15:48:51.462 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:48:51.462 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-23a70999', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T15:48:51.448144', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 15:48:51.464 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-23a70999, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 15:48:51.556 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:48:51.557 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-23a70999, Company: apt001
2026-01-26 15:48:52.029 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=jts1sjjf
2026-01-26 15:48:52.030 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-23a70999, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@161bd303, simpSessionId=jts1sjjf}], simpSessionId=jts1sjjf}
2026-01-26 15:48:52.042 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-23a70999, sessionId=jts1sjjf
2026-01-26 15:48:52.104 [clientInboundChannel-7] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-23a70999
2026-01-26 15:48:52.129 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:48:52.129 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 12ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-23a70999', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T15:48:52.104935400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:48:52.133 [clientInboundChannel-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-23a70999, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 15:48:52.164 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:48:52.163 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 20ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:48:52.137390', updated_at = NOW() 
WHERE room_id = 'room-23a70999'
===========================================================================================================
2026-01-26 15:48:52.179 [clientInboundChannel-7] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-23a70999, current mode: BOT
2026-01-26 15:48:52.182 [clientInboundChannel-7] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 15:49:36.411 [clientInboundChannel-10] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-23a70999
2026-01-26 15:49:36.412 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=jts1sjjf, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 15:49:36.421 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:49:36.420 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-23a70999', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T15:49:36.412941600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:49:36.422 [clientInboundChannel-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-23a70999, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 15:49:36.430 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:49:36.430 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:49:36.425908', updated_at = NOW() 
WHERE room_id = 'room-23a70999'
===========================================================================================================
2026-01-26 15:49:36.436 [clientInboundChannel-10] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-23a70999 is being closed due to LEAVE message
2026-01-26 15:49:36.449 [clientInboundChannel-10] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-23a70999, current mode: CLOSED
2026-01-26 15:49:36.453 [clientInboundChannel-10] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 15:49:40.091 [MessageBroker-6] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 16, active threads = 0, queued tasks = 0, completed tasks = 18], outboundChannel[pool size = 4, active threads = 0, queued tasks = 0, completed tasks = 4], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 2, completed tasks = 12]
2026-01-26 15:50:41.259 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-23a70999 (Idle for 64825 ms)
2026-01-26 15:52:41.570 [http-nio-28070-exec-5] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 15:52:41.657 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:52:41.657 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 80ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 15:52:48.513 [http-nio-28070-exec-7] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 15:52:48.513 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:52:48.531 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:52:48.531 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-27600998', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T15:52:48.522641400', NOW()), NULL, COALESCE('2026-01-26T15:52:48.522641400', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:52:48.533 [http-nio-28070-exec-7] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-27600998, customerId=cust01
2026-01-26 15:52:48.535 [http-nio-28070-exec-7] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-27600998
2026-01-26 15:52:48.537 [http-nio-28070-exec-7] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-27600998
2026-01-26 15:52:48.548 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:52:48.548 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-27600998', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T15:52:48.539598', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 15:52:48.549 [http-nio-28070-exec-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-27600998, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 15:52:48.579 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 15:52:48.580 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-27600998, Company: apt001
2026-01-26 15:52:48.587 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=lbmxsvia
2026-01-26 15:52:48.591 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-27600998, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@16b90167, simpSessionId=lbmxsvia}], simpSessionId=lbmxsvia}
2026-01-26 15:52:48.598 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-27600998, sessionId=lbmxsvia
2026-01-26 15:52:48.611 [clientInboundChannel-23] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-27600998
2026-01-26 15:52:48.629 [clientInboundChannel-23] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:52:48.629 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-27600998', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T15:52:48.612930600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 15:52:48.630 [clientInboundChannel-23] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-27600998, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 15:52:48.637 [clientInboundChannel-23] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 15:52:48.636 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T15:52:48.632876500', updated_at = NOW() 
WHERE room_id = 'room-27600998'
===========================================================================================================
2026-01-26 15:52:48.644 [clientInboundChannel-23] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-27600998, current mode: BOT
2026-01-26 15:52:48.646 [clientInboundChannel-23] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 15:54:41.255 [MessageBroker-3] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-27600998 (Idle for 112614 ms)
2026-01-26 16:06:14.371 [http-nio-28070-exec-6] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 16:06:14.383 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:06:14.383 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 9ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 16:06:18.578 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:06:30.997 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:06:30.997 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:06:31.005 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=o110paxb
2026-01-26 16:06:31.006 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@54016255, simpSessionId=o110paxb}], simpSessionId=o110paxb}
2026-01-26 16:06:34.930 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=o110paxb
2026-01-26 16:06:40.243 [http-nio-28070-exec-3] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:07:22.284 [clientInboundChannel-32] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-27600998
2026-01-26 16:07:22.300 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:22.300 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 11ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-27600998', 'cust01', '홍길철', 'CUSTOMER', 'ㅁ', 'TALK', 'apt001', COALESCE('2026-01-26T16:07:22.286224100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:22.302 [clientInboundChannel-32] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-27600998, sender=홍길철, message=ㅁ
2026-01-26 16:07:22.311 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:22.310 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:07:22.305174', updated_at = NOW() 
WHERE room_id = 'room-27600998'
===========================================================================================================
2026-01-26 16:07:22.316 [clientInboundChannel-32] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-27600998, current mode: BOT
2026-01-26 16:07:22.318 [clientInboundChannel-32] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-27600998
2026-01-26 16:07:22.344 [clientInboundChannel-32] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-27600998, CompanyId: apt001
2026-01-26 16:07:22.668 [reactor-http-nio-3] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 16:07:22.680 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:22.680 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-27600998', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T16:07:22.670080600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:22.682 [reactor-http-nio-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-27600998, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 16:07:22.694 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:22.694 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 7ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:07:22.684043300', updated_at = NOW() 
WHERE room_id = 'room-27600998'
===========================================================================================================
2026-01-26 16:07:38.385 [clientInboundChannel-35] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-27600998
2026-01-26 16:07:38.387 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=lbmxsvia, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:07:38.406 [clientInboundChannel-35] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:38.405 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-27600998', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T16:07:38.386865400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:38.408 [clientInboundChannel-35] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-27600998, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 16:07:38.416 [clientInboundChannel-35] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:38.416 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:07:38.411802900', updated_at = NOW() 
WHERE room_id = 'room-27600998'
===========================================================================================================
2026-01-26 16:07:38.419 [clientInboundChannel-35] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-27600998 is being closed due to LEAVE message
2026-01-26 16:07:38.423 [clientInboundChannel-35] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-27600998, current mode: CLOSED
2026-01-26 16:07:38.425 [clientInboundChannel-35] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 16:07:42.645 [http-nio-28070-exec-7] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 16:07:42.645 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:07:42.659 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:42.659 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T16:07:42.652703100', NOW()), NULL, COALESCE('2026-01-26T16:07:42.652703100', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:42.660 [http-nio-28070-exec-7] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-b9d542e3, customerId=cust01
2026-01-26 16:07:42.663 [http-nio-28070-exec-7] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-b9d542e3
2026-01-26 16:07:42.664 [http-nio-28070-exec-7] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-b9d542e3
2026-01-26 16:07:42.673 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:42.673 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T16:07:42.666666400', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 16:07:42.674 [http-nio-28070-exec-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 16:07:42.707 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:07:42.708 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-b9d542e3, Company: apt001
2026-01-26 16:07:42.717 [clientOutboundChannel-14] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=jkq35d1x
2026-01-26 16:07:42.717 [clientOutboundChannel-14] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-b9d542e3, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@54a267b5, simpSessionId=jkq35d1x}], simpSessionId=jkq35d1x}
2026-01-26 16:07:42.722 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-b9d542e3, sessionId=jkq35d1x
2026-01-26 16:07:42.730 [clientInboundChannel-32] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-b9d542e3
2026-01-26 16:07:42.737 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:42.737 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T16:07:42.730005400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:42.738 [clientInboundChannel-32] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 16:07:42.745 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:42.745 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:07:42.739997200', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:07:42.753 [clientInboundChannel-32] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b9d542e3, current mode: BOT
2026-01-26 16:07:42.755 [clientInboundChannel-32] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 16:07:44.449 [clientInboundChannel-40] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-b9d542e3
2026-01-26 16:07:44.456 [clientInboundChannel-40] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:44.456 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'cust01', '홍길철', 'CUSTOMER', 'ㅁㅁ', 'TALK', 'apt001', COALESCE('2026-01-26T16:07:44.449633400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:44.457 [clientInboundChannel-40] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=홍길철, message=ㅁㅁ
2026-01-26 16:07:44.464 [clientInboundChannel-40] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:44.464 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:07:44.458612400', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:07:44.471 [clientInboundChannel-40] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b9d542e3, current mode: BOT
2026-01-26 16:07:44.472 [clientInboundChannel-40] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-b9d542e3
2026-01-26 16:07:44.472 [clientInboundChannel-40] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-b9d542e3, CompanyId: apt001
2026-01-26 16:07:44.479 [reactor-http-nio-4] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 16:07:44.489 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:44.489 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T16:07:44.481549700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:44.490 [reactor-http-nio-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 16:07:44.499 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:44.499 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:07:44.493517500', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:07:57.693 [clientInboundChannel-41] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-b9d542e3
2026-01-26 16:07:57.699 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:57.699 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T16:07:57.693006700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:57.699 [clientInboundChannel-41] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 16:07:57.706 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:57.706 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:07:57.702980', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:07:57.712 [clientInboundChannel-41] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b9d542e3, current mode: BOT
2026-01-26 16:07:57.713 [clientInboundChannel-41] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-b9d542e3 to WAITING mode
2026-01-26 16:07:57.734 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:57.733 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:07:57.735 [clientInboundChannel-41] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-b9d542e3, status=WAITING
2026-01-26 16:07:57.746 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:07:57.745 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T16:07:57.737886800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:07:57.749 [clientInboundChannel-41] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 16:08:01.769 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-b9d542e3, sessionId=o110paxb
2026-01-26 16:08:09.128 [http-nio-28070-exec-5] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-b9d542e3
2026-01-26 16:08:09.128 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:08:09.188 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:08:09.188 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 17ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:08:09.190 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-b9d542e3, status=AGENT
2026-01-26 16:08:09.205 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:08:09.204 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:08:09.206 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-b9d542e3, agent=상담원-01
2026-01-26 16:08:09.224 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:08:09.224 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T16:08:09.213806800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:08:09.225 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 16:08:09.234 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=o110paxb
2026-01-26 16:08:09.235 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-b9d542e3, sessionId=o110paxb
2026-01-26 16:09:41.262 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-b9d542e3 (Idle for 92108 ms)
2026-01-26 16:10:28.522 [clientInboundChannel-48] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-b9d542e3
2026-01-26 16:10:28.530 [clientInboundChannel-48] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:10:28.529 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'agent01', '상담원-01', 'AGENT', '안녕하세요', 'TALK', 'apt001', COALESCE('2026-01-26T16:10:28.523704500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:10:28.530 [clientInboundChannel-48] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=상담원-01, message=안녕하세요
2026-01-26 16:10:28.535 [clientInboundChannel-48] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:10:28.535 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:10:28.531924600', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:10:28.541 [clientInboundChannel-48] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b9d542e3, current mode: BOT
2026-01-26 16:10:28.542 [clientInboundChannel-48] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-b9d542e3
2026-01-26 16:10:44.241 [clientInboundChannel-51] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-b9d542e3
2026-01-26 16:10:44.247 [clientInboundChannel-51] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:10:44.247 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'agent01', '상담원-01', 'AGENT', '챗봇입니다', 'TALK', 'apt001', COALESCE('2026-01-26T16:10:44.242939700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:10:44.249 [clientInboundChannel-51] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=상담원-01, message=챗봇입니다
2026-01-26 16:10:44.253 [clientInboundChannel-51] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:10:44.253 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:10:44.251920100', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:10:44.258 [clientInboundChannel-51] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b9d542e3, current mode: BOT
2026-01-26 16:10:44.258 [clientInboundChannel-51] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-b9d542e3
2026-01-26 16:19:40.112 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(2)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 75], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 28], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 4, completed tasks = 490]
2026-01-26 16:24:08.392 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=jkq35d1x, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:24:08.392 [clientInboundChannel-54] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-b9d542e3
2026-01-26 16:24:08.406 [clientInboundChannel-54] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:24:08.406 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b9d542e3', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T16:24:08.393434900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:24:08.407 [clientInboundChannel-54] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b9d542e3, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 16:24:08.425 [clientInboundChannel-54] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:24:08.425 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 13ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:24:08.411243900', updated_at = NOW() 
WHERE room_id = 'room-b9d542e3'
===========================================================================================================
2026-01-26 16:24:08.429 [clientInboundChannel-54] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-b9d542e3 is being closed due to LEAVE message
2026-01-26 16:24:08.433 [clientInboundChannel-54] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b9d542e3, current mode: CLOSED
2026-01-26 16:24:08.434 [clientInboundChannel-54] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 16:26:49.427 [http-nio-28070-exec-6] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 16:26:49.449 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:26:49.449 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 19ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 16:30:05.368 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 16:30:05.369 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:30:05.383 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:05.383 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-87e539b0', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T16:30:05.376103200', NOW()), NULL, COALESCE('2026-01-26T16:30:05.376103200', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:30:05.385 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-87e539b0, customerId=cust01
2026-01-26 16:30:05.389 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-87e539b0
2026-01-26 16:30:05.390 [http-nio-28070-exec-8] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-87e539b0
2026-01-26 16:30:05.399 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:05.399 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-87e539b0', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T16:30:05.392103600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 16:30:05.400 [http-nio-28070-exec-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-87e539b0, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 16:30:05.432 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:30:05.433 [http-nio-28070-exec-10] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-87e539b0, Company: apt001
2026-01-26 16:30:05.441 [clientOutboundChannel-34] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=xxvk3xrn
2026-01-26 16:30:05.441 [clientOutboundChannel-34] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-87e539b0, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@72304433, simpSessionId=xxvk3xrn}], simpSessionId=xxvk3xrn}
2026-01-26 16:30:05.448 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-87e539b0, sessionId=xxvk3xrn
2026-01-26 16:30:05.460 [clientInboundChannel-69] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-87e539b0
2026-01-26 16:30:05.469 [clientInboundChannel-69] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:05.469 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-87e539b0', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T16:30:05.461468200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:30:05.471 [clientInboundChannel-69] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-87e539b0, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 16:30:05.477 [clientInboundChannel-69] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:05.477 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:30:05.473435400', updated_at = NOW() 
WHERE room_id = 'room-87e539b0'
===========================================================================================================
2026-01-26 16:30:05.482 [clientInboundChannel-69] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-87e539b0, current mode: BOT
2026-01-26 16:30:05.485 [clientInboundChannel-69] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 16:30:19.151 [clientInboundChannel-72] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-87e539b0
2026-01-26 16:30:19.151 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=xxvk3xrn, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:30:19.162 [clientInboundChannel-72] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:19.162 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-87e539b0', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T16:30:19.151379300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:30:19.164 [clientInboundChannel-72] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-87e539b0, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 16:30:19.169 [clientInboundChannel-72] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:19.169 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:30:19.165342300', updated_at = NOW() 
WHERE room_id = 'room-87e539b0'
===========================================================================================================
2026-01-26 16:30:19.175 [clientInboundChannel-72] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-87e539b0 is being closed due to LEAVE message
2026-01-26 16:30:19.183 [clientInboundChannel-72] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-87e539b0, current mode: CLOSED
2026-01-26 16:30:19.184 [clientInboundChannel-72] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 16:30:34.110 [http-nio-28070-exec-7] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 16:30:34.118 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:34.118 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 16:30:36.866 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 16:30:36.866 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:30:36.879 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:36.879 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T16:30:36.873022500', NOW()), NULL, COALESCE('2026-01-26T16:30:36.873022500', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:30:36.880 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-8518da91, customerId=cust01
2026-01-26 16:30:36.882 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-8518da91
2026-01-26 16:30:36.884 [http-nio-28070-exec-8] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-8518da91
2026-01-26 16:30:36.892 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:36.892 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T16:30:36.885985400', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 16:30:36.893 [http-nio-28070-exec-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 16:30:36.934 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:30:36.935 [http-nio-28070-exec-10] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-8518da91, Company: apt001
2026-01-26 16:30:36.942 [clientOutboundChannel-40] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=rqbwasxl
2026-01-26 16:30:36.943 [clientOutboundChannel-40] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-8518da91, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@712cab8a, simpSessionId=rqbwasxl}], simpSessionId=rqbwasxl}
2026-01-26 16:30:36.947 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-8518da91, sessionId=rqbwasxl
2026-01-26 16:30:36.952 [clientInboundChannel-69] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8518da91
2026-01-26 16:30:36.961 [clientInboundChannel-69] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:36.961 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T16:30:36.953954200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:30:36.962 [clientInboundChannel-69] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 16:30:36.971 [clientInboundChannel-69] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:30:36.971 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:30:36.964925900', updated_at = NOW() 
WHERE room_id = 'room-8518da91'
===========================================================================================================
2026-01-26 16:30:36.976 [clientInboundChannel-69] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8518da91, current mode: BOT
2026-01-26 16:30:36.978 [clientInboundChannel-69] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 16:31:41.275 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-87e539b0 (Idle for 82101 ms)
2026-01-26 16:31:41.280 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-8518da91 (Idle for 64300 ms)
2026-01-26 16:34:34.259 [clientInboundChannel-79] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8518da91
2026-01-26 16:34:34.266 [clientInboundChannel-79] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:34:34.266 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T16:34:34.260872600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:34:34.267 [clientInboundChannel-79] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 16:34:34.273 [clientInboundChannel-79] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:34:34.273 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:34:34.269848', updated_at = NOW() 
WHERE room_id = 'room-8518da91'
===========================================================================================================
2026-01-26 16:34:34.282 [clientInboundChannel-79] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8518da91, current mode: BOT
2026-01-26 16:34:34.283 [clientInboundChannel-79] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-8518da91 to WAITING mode
2026-01-26 16:34:34.303 [clientInboundChannel-79] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:34:34.303 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-8518da91'
===========================================================================================================
2026-01-26 16:34:34.303 [clientInboundChannel-79] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-8518da91, status=WAITING
2026-01-26 16:34:34.312 [clientInboundChannel-79] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:34:34.312 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T16:34:34.305834900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:34:34.313 [clientInboundChannel-79] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 16:37:55.577 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=o110paxb, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:37:55.730 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:37:59.859 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:37:59.866 [http-nio-28070-exec-1] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:37:59.874 [clientOutboundChannel-47] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=zyj4dvx5
2026-01-26 16:37:59.874 [clientOutboundChannel-47] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@74ceb748, simpSessionId=zyj4dvx5}], simpSessionId=zyj4dvx5}
2026-01-26 16:37:59.879 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=zyj4dvx5
2026-01-26 16:37:59.881 [http-nio-28070-exec-4] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:38:05.345 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=zyj4dvx5, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:38:06.486 [http-nio-28070-exec-8] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 16:38:06.498 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:06.498 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 9ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 16:38:06.511 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:38:06.537 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:38:06.538 [http-nio-28070-exec-1] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:38:06.547 [clientOutboundChannel-49] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=stbix0ha
2026-01-26 16:38:06.547 [clientOutboundChannel-49] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@684c8c9b, simpSessionId=stbix0ha}], simpSessionId=stbix0ha}
2026-01-26 16:38:06.552 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=stbix0ha
2026-01-26 16:38:06.556 [http-nio-28070-exec-4] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:38:09.052 [clientInboundChannel-83] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8518da91
2026-01-26 16:38:09.059 [clientInboundChannel-83] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:09.059 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T16:38:09.052138700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:38:09.060 [clientInboundChannel-83] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 16:38:09.066 [clientInboundChannel-83] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:09.065 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:38:09.062111400', updated_at = NOW() 
WHERE room_id = 'room-8518da91'
===========================================================================================================
2026-01-26 16:38:09.072 [clientInboundChannel-83] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8518da91, current mode: WAITING
2026-01-26 16:38:09.072 [clientInboundChannel-83] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8518da91
2026-01-26 16:38:10.364 [clientInboundChannel-86] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8518da91
2026-01-26 16:38:10.368 [clientInboundChannel-86] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:10.368 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T16:38:10.364396600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:38:10.369 [clientInboundChannel-86] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 16:38:10.383 [clientInboundChannel-86] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:10.383 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:38:10.379261300', updated_at = NOW() 
WHERE room_id = 'room-8518da91'
===========================================================================================================
2026-01-26 16:38:10.394 [clientInboundChannel-86] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8518da91, current mode: WAITING
2026-01-26 16:38:10.394 [clientInboundChannel-86] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8518da91
2026-01-26 16:38:50.237 [clientInboundChannel-90] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8518da91
2026-01-26 16:38:50.252 [clientInboundChannel-90] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:50.252 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T16:38:50.237529800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:38:50.254 [clientInboundChannel-90] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 16:38:50.268 [clientInboundChannel-90] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:50.268 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:38:50.261257600', updated_at = NOW() 
WHERE room_id = 'room-8518da91'
===========================================================================================================
2026-01-26 16:38:50.276 [clientInboundChannel-90] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8518da91, current mode: WAITING
2026-01-26 16:38:50.276 [clientInboundChannel-90] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8518da91
2026-01-26 16:38:53.744 [clientInboundChannel-91] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8518da91
2026-01-26 16:38:53.750 [clientInboundChannel-91] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:53.750 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8518da91', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T16:38:53.744294600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:38:53.751 [clientInboundChannel-91] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8518da91, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 16:38:53.764 [clientInboundChannel-91] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:38:53.764 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:38:53.760467800', updated_at = NOW() 
WHERE room_id = 'room-8518da91'
===========================================================================================================
2026-01-26 16:38:53.772 [clientInboundChannel-91] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8518da91, current mode: WAITING
2026-01-26 16:38:53.772 [clientInboundChannel-91] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8518da91
2026-01-26 16:41:52.381 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 34636 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 16:41:52.387 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 16:41:54.330 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 16:41:54.335 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 16:41:54.398 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 Redis repository interfaces.
2026-01-26 16:41:55.515 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 16:41:55.540 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 16:41:55.545 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 16:41:55.546 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 16:41:55.683 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 16:41:55.684 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3212 ms
2026-01-26 16:41:58.450 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 16:41:58.542 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 16:41:58.543 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@367fbb28]]
2026-01-26 16:41:58.545 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 16:41:58.586 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 16:41:58.612 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 16:41:59.389 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 16:41:59.389 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 16:41:59.394 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 16:41:59.560 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 8.199 seconds (process running for 9.625)
2026-01-26 16:42:46.305 [http-nio-28070-exec-8] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 16:42:46.707 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:42:46.707 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 377ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 16:42:49.456 [http-nio-28070-exec-7] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 16:42:49.457 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:42:49.539 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:42:49.539 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 13ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T16:42:49.510289100', NOW()), NULL, COALESCE('2026-01-26T16:42:49.510289100', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:42:49.541 [http-nio-28070-exec-7] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-8c869149, customerId=cust01
2026-01-26 16:42:49.546 [http-nio-28070-exec-7] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-8c869149
2026-01-26 16:42:49.549 [http-nio-28070-exec-7] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-8c869149
2026-01-26 16:42:49.568 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:42:49.567 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T16:42:49.556019500', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 16:42:49.569 [http-nio-28070-exec-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 16:42:49.618 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:42:49.618 [http-nio-28070-exec-10] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-8c869149, Company: apt001
2026-01-26 16:42:49.716 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-8c869149, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@3528fec7, simpSessionId=mgzgemaf}], simpSessionId=mgzgemaf}
2026-01-26 16:42:49.717 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=mgzgemaf
2026-01-26 16:42:49.725 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-8c869149, sessionId=mgzgemaf
2026-01-26 16:42:49.746 [clientInboundChannel-7] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8c869149
2026-01-26 16:42:49.754 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:42:49.754 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T16:42:49.746511900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:42:49.756 [clientInboundChannel-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 16:42:49.767 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:42:49.767 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 8ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:42:49.757601100', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:42:49.774 [clientInboundChannel-7] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8c869149, current mode: BOT
2026-01-26 16:42:49.776 [clientInboundChannel-7] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 16:42:51.641 [http-nio-28070-exec-2] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 16:42:51.648 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:42:51.648 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 5ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 16:42:51.659 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:42:51.703 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:42:51.704 [http-nio-28070-exec-5] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:42:51.714 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@7a97ce14, simpSessionId=eqe3wigs}], simpSessionId=eqe3wigs}
2026-01-26 16:42:51.716 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=eqe3wigs
2026-01-26 16:42:51.722 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=eqe3wigs
2026-01-26 16:42:51.724 [http-nio-28070-exec-7] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:42:58.516 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 15, active threads = 0, queued tasks = 0, completed tasks = 15], outboundChannel[pool size = 3, active threads = 0, queued tasks = 0, completed tasks = 3], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 4, completed tasks = 3]
2026-01-26 16:43:59.565 [MessageBroker-3] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-8c869149 (Idle for 69794 ms)
2026-01-26 16:45:23.245 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=eqe3wigs, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:45:23.364 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:45:23.398 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:45:23.400 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:45:23.417 [clientOutboundChannel-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@2ff99a07, simpSessionId=eqstcwc3}], simpSessionId=eqstcwc3}
2026-01-26 16:45:23.420 [clientOutboundChannel-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=eqstcwc3
2026-01-26 16:45:23.428 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=eqstcwc3
2026-01-26 16:45:23.429 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:45:26.111 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=eqstcwc3, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:45:26.215 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:45:26.269 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:45:26.270 [http-nio-28070-exec-8] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:45:26.280 [clientOutboundChannel-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@3dae4663, simpSessionId=znloysmc}], simpSessionId=znloysmc}
2026-01-26 16:45:26.281 [clientOutboundChannel-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=znloysmc
2026-01-26 16:45:26.286 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=znloysmc
2026-01-26 16:45:26.288 [http-nio-28070-exec-10] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:45:28.227 [clientInboundChannel-17] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8c869149
2026-01-26 16:45:28.239 [clientInboundChannel-17] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:28.239 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T16:45:28.228096', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:45:28.241 [clientInboundChannel-17] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 16:45:28.254 [clientInboundChannel-17] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:28.253 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 6ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:45:28.244051500', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:45:28.263 [clientInboundChannel-17] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8c869149, current mode: BOT
2026-01-26 16:45:28.264 [clientInboundChannel-17] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-8c869149 to WAITING mode
2026-01-26 16:45:28.280 [clientInboundChannel-17] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:28.280 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 7ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:45:28.282 [clientInboundChannel-17] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-8c869149, status=WAITING
2026-01-26 16:45:28.293 [clientInboundChannel-17] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:28.293 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T16:45:28.285939600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:45:28.295 [clientInboundChannel-17] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 16:45:53.734 [clientInboundChannel-20] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8c869149
2026-01-26 16:45:53.747 [clientInboundChannel-20] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:53.746 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T16:45:53.734302200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:45:53.748 [clientInboundChannel-20] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 16:45:53.759 [clientInboundChannel-20] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:53.758 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:45:53.751257500', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:45:53.767 [clientInboundChannel-20] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8c869149, current mode: WAITING
2026-01-26 16:45:53.767 [clientInboundChannel-20] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8c869149
2026-01-26 16:45:59.200 [clientInboundChannel-24] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8c869149
2026-01-26 16:45:59.208 [clientInboundChannel-24] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:59.208 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T16:45:59.200686900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:45:59.209 [clientInboundChannel-24] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 16:45:59.217 [clientInboundChannel-24] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:45:59.217 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:45:59.212654200', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:45:59.225 [clientInboundChannel-24] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8c869149, current mode: WAITING
2026-01-26 16:45:59.226 [clientInboundChannel-24] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8c869149
2026-01-26 16:48:18.648 [clientInboundChannel-32] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8c869149
2026-01-26 16:48:18.656 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:18.656 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T16:48:18.649921700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:48:18.657 [clientInboundChannel-32] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 16:48:18.671 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:18.671 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 9ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:48:18.659890400', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:48:18.681 [clientInboundChannel-32] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8c869149, current mode: WAITING
2026-01-26 16:48:18.681 [clientInboundChannel-32] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8c869149
2026-01-26 16:48:31.165 [clientInboundChannel-35] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8c869149
2026-01-26 16:48:31.175 [clientInboundChannel-35] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:31.175 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T16:48:31.166516900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:48:31.176 [clientInboundChannel-35] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 16:48:31.194 [clientInboundChannel-35] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:31.194 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:48:31.186164', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:48:31.201 [clientInboundChannel-35] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8c869149, current mode: WAITING
2026-01-26 16:48:31.201 [clientInboundChannel-35] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-8c869149
2026-01-26 16:48:35.845 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=znloysmc, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:48:36.055 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:36.140 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:36.141 [http-nio-28070-exec-4] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:48:36.160 [clientOutboundChannel-17] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@d0759f9, simpSessionId=mxlo15sl}], simpSessionId=mxlo15sl}
2026-01-26 16:48:36.161 [clientOutboundChannel-17] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=mxlo15sl
2026-01-26 16:48:36.165 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=mxlo15sl
2026-01-26 16:48:36.170 [http-nio-28070-exec-3] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:48:37.137 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=mxlo15sl, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:48:37.325 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:37.437 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:37.438 [http-nio-28070-exec-2] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:48:37.446 [clientOutboundChannel-19] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@72dc4630, simpSessionId=maqzlta5}], simpSessionId=maqzlta5}
2026-01-26 16:48:37.447 [clientOutboundChannel-19] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=maqzlta5
2026-01-26 16:48:37.455 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=maqzlta5
2026-01-26 16:48:37.457 [http-nio-28070-exec-5] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:48:38.707 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=maqzlta5, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:48:39.753 [http-nio-28070-exec-9] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 16:48:39.762 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:39.762 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 16:48:39.776 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:39.797 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:39.798 [http-nio-28070-exec-2] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 16:48:39.808 [clientOutboundChannel-21] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@434365fa, simpSessionId=jvmfwk41}], simpSessionId=jvmfwk41}
2026-01-26 16:48:39.809 [clientOutboundChannel-21] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=jvmfwk41
2026-01-26 16:48:39.812 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=jvmfwk41
2026-01-26 16:48:39.815 [http-nio-28070-exec-5] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 16:48:42.545 [clientInboundChannel-47] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-8c869149
2026-01-26 16:48:42.545 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=mgzgemaf, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 16:48:42.552 [clientInboundChannel-47] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:42.552 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-8c869149', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T16:48:42.545624500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:48:42.553 [clientInboundChannel-47] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-8c869149, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 16:48:42.560 [clientInboundChannel-47] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:42.560 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:48:42.556599', updated_at = NOW() 
WHERE room_id = 'room-8c869149'
===========================================================================================================
2026-01-26 16:48:42.565 [clientInboundChannel-47] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-8c869149 is being closed due to LEAVE message
2026-01-26 16:48:42.570 [clientInboundChannel-47] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-8c869149, current mode: CLOSED
2026-01-26 16:48:42.574 [clientInboundChannel-47] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 16:48:46.408 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 16:48:46.408 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:46.428 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:46.428 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T16:48:46.415791200', NOW()), NULL, COALESCE('2026-01-26T16:48:46.415791200', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:48:46.429 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-a59a2b5c, customerId=cust01
2026-01-26 16:48:46.440 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-a59a2b5c
2026-01-26 16:48:46.442 [http-nio-28070-exec-8] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-a59a2b5c
2026-01-26 16:48:46.452 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:46.452 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T16:48:46.444091600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 16:48:46.453 [http-nio-28070-exec-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 16:48:46.486 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:46.495 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-a59a2b5c, Company: apt001
2026-01-26 16:48:46.506 [clientOutboundChannel-26] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-a59a2b5c, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@73383ef4, simpSessionId=ofnommsy}], simpSessionId=ofnommsy}
2026-01-26 16:48:46.507 [clientOutboundChannel-26] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=ofnommsy
2026-01-26 16:48:46.511 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a59a2b5c, sessionId=ofnommsy
2026-01-26 16:48:46.519 [clientInboundChannel-33] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a59a2b5c
2026-01-26 16:48:46.526 [clientInboundChannel-33] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:46.526 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T16:48:46.519366700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:48:46.527 [clientInboundChannel-33] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 16:48:46.533 [clientInboundChannel-33] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:46.533 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:48:46.529278900', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 16:48:46.539 [clientInboundChannel-33] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a59a2b5c, current mode: BOT
2026-01-26 16:48:46.541 [clientInboundChannel-33] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 16:48:51.419 [http-nio-28070-exec-2] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-a59a2b5c
2026-01-26 16:48:51.420 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 16:48:51.473 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:51.473 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 16:48:51.476 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a59a2b5c, sessionId=jvmfwk41
2026-01-26 16:48:51.476 [http-nio-28070-exec-2] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-a59a2b5c, status=AGENT
2026-01-26 16:48:51.497 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:51.497 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 11ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 16:48:51.498 [http-nio-28070-exec-2] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-a59a2b5c, agent=상담원-01
2026-01-26 16:48:51.516 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:51.515 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T16:48:51.500122500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:48:51.516 [http-nio-28070-exec-2] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 16:48:51.526 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=jvmfwk41
2026-01-26 16:48:51.527 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a59a2b5c, sessionId=jvmfwk41
2026-01-26 16:48:55.539 [clientInboundChannel-46] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-a59a2b5c
2026-01-26 16:48:55.545 [clientInboundChannel-46] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:55.545 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'agent01', '상담원-01', 'AGENT', 'ㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T16:48:55.539332600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:48:55.546 [clientInboundChannel-46] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=상담원-01, message=ㅇㅇㅇ
2026-01-26 16:48:55.558 [clientInboundChannel-46] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:48:55.557 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:48:55.554681', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 16:48:55.565 [clientInboundChannel-46] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a59a2b5c, current mode: AGENT
2026-01-26 16:48:55.565 [clientInboundChannel-46] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-a59a2b5c
2026-01-26 16:49:59.570 [MessageBroker-4] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-a59a2b5c (Idle for 64008 ms)
2026-01-26 16:50:27.705 [clientInboundChannel-48] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a59a2b5c
2026-01-26 16:50:27.714 [clientInboundChannel-48] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:50:27.713 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'cust01', '홍길철', 'CUSTOMER', '상담원님 안녕!', 'TALK', 'apt001', COALESCE('2026-01-26T16:50:27.705287300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:50:27.721 [clientInboundChannel-48] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=홍길철, message=상담원님 안녕!
2026-01-26 16:50:27.730 [clientInboundChannel-48] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:50:27.729 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:50:27.723904900', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 16:50:27.734 [clientInboundChannel-48] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a59a2b5c, current mode: BOT
2026-01-26 16:50:27.736 [clientInboundChannel-48] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-a59a2b5c
2026-01-26 16:50:27.750 [clientInboundChannel-48] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-a59a2b5c, CompanyId: apt001
2026-01-26 16:50:27.956 [reactor-http-nio-3] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 16:50:27.965 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:50:27.964 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T16:50:27.958276700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:50:27.965 [reactor-http-nio-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 16:50:27.973 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:50:27.973 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:50:27.968250300', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 16:50:48.201 [clientInboundChannel-51] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-a59a2b5c
2026-01-26 16:50:48.208 [clientInboundChannel-51] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:50:48.207 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'agent01', '상담원-01', 'AGENT', '하이 안녕!', 'TALK', 'apt001', COALESCE('2026-01-26T16:50:48.202833100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 16:50:48.208 [clientInboundChannel-51] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=상담원-01, message=하이 안녕!
2026-01-26 16:50:48.220 [clientInboundChannel-51] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 16:50:48.220 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T16:50:48.217524300', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 16:50:48.225 [clientInboundChannel-51] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a59a2b5c, current mode: BOT
2026-01-26 16:50:48.225 [clientInboundChannel-51] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-a59a2b5c
2026-01-26 17:07:44.977 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=jvmfwk41, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:12:58.539 [MessageBroker-4] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 8 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(8)-CONNECTED(8)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 114], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 39], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 3, completed tasks = 517]
2026-01-26 17:20:00.045 [http-nio-28070-exec-3] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 17:20:00.070 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:20:00.070 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 22ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 17:20:00.085 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:00.127 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:00.128 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 17:20:00.143 [clientOutboundChannel-38] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@14e0dd5c, simpSessionId=3125rujn}], simpSessionId=3125rujn}
2026-01-26 17:20:00.144 [clientOutboundChannel-38] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=3125rujn
2026-01-26 17:20:00.150 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=3125rujn
2026-01-26 17:20:00.155 [http-nio-28070-exec-4] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:20:03.599 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=3125rujn, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:20:05.362 [http-nio-28070-exec-3] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 17:20:05.371 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:20:05.371 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 17:20:05.392 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:05.426 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:05.427 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 17:20:05.436 [clientOutboundChannel-40] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@1223046a, simpSessionId=nenaiocu}], simpSessionId=nenaiocu}
2026-01-26 17:20:05.436 [clientOutboundChannel-40] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=nenaiocu
2026-01-26 17:20:05.443 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=nenaiocu
2026-01-26 17:20:05.445 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:20:07.315 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=nenaiocu, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:20:08.947 [http-nio-28070-exec-3] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 17:20:08.954 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:20:08.954 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 5ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 17:20:08.967 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:08.988 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:08.988 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 17:20:08.999 [clientOutboundChannel-42] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@6cdce9ba, simpSessionId=1p25f1tk}], simpSessionId=1p25f1tk}
2026-01-26 17:20:09.000 [clientOutboundChannel-42] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=1p25f1tk
2026-01-26 17:20:09.004 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=1p25f1tk
2026-01-26 17:20:09.005 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:20:12.816 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=1p25f1tk, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:20:14.757 [http-nio-28070-exec-3] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 17:20:14.765 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:20:14.765 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 5ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 17:20:14.774 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:14.797 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:14.798 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 17:20:14.805 [clientOutboundChannel-44] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@234b1725, simpSessionId=4onkbepa}], simpSessionId=4onkbepa}
2026-01-26 17:20:14.806 [clientOutboundChannel-44] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=4onkbepa
2026-01-26 17:20:14.813 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=4onkbepa
2026-01-26 17:20:14.814 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:20:17.939 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=4onkbepa, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:20:28.297 [http-nio-28070-exec-3] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 17:20:28.304 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:20:28.304 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 17:20:28.312 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:28.342 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:20:28.342 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 17:20:28.350 [clientOutboundChannel-46] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@612aa73c, simpSessionId=np4elgta}], simpSessionId=np4elgta}
2026-01-26 17:20:28.351 [clientOutboundChannel-46] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=np4elgta
2026-01-26 17:20:28.354 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=np4elgta
2026-01-26 17:20:28.357 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:26:07.386 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=ofnommsy, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:26:07.391 [clientInboundChannel-73] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a59a2b5c
2026-01-26 17:26:07.410 [clientInboundChannel-73] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:07.409 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a59a2b5c', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T17:26:07.392555700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:26:07.410 [clientInboundChannel-73] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a59a2b5c, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 17:26:07.425 [clientInboundChannel-73] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:07.425 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 10ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:26:07.414497300', updated_at = NOW() 
WHERE room_id = 'room-a59a2b5c'
===========================================================================================================
2026-01-26 17:26:07.429 [clientInboundChannel-73] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-a59a2b5c is being closed due to LEAVE message
2026-01-26 17:26:07.435 [clientInboundChannel-73] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a59a2b5c, current mode: CLOSED
2026-01-26 17:26:07.437 [clientInboundChannel-73] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 17:26:10.701 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 17:26:10.702 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:26:10.716 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:10.715 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T17:26:10.708119600', NOW()), NULL, COALESCE('2026-01-26T17:26:10.708119600', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:26:10.717 [http-nio-28070-exec-3] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-d5c026a4, customerId=cust01
2026-01-26 17:26:10.727 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-d5c026a4
2026-01-26 17:26:10.728 [http-nio-28070-exec-3] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-d5c026a4
2026-01-26 17:26:10.737 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:10.737 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T17:26:10.729062600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 17:26:10.738 [http-nio-28070-exec-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 17:26:10.770 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:26:10.771 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-d5c026a4, Company: apt001
2026-01-26 17:26:10.787 [clientOutboundChannel-51] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-d5c026a4, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@6ceee449, simpSessionId=xb0qqgsb}], simpSessionId=xb0qqgsb}
2026-01-26 17:26:10.788 [clientOutboundChannel-51] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=xb0qqgsb
2026-01-26 17:26:10.798 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-d5c026a4, sessionId=xb0qqgsb
2026-01-26 17:26:10.809 [clientInboundChannel-88] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-d5c026a4
2026-01-26 17:26:10.820 [clientInboundChannel-88] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:10.820 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T17:26:10.809845500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:26:10.821 [clientInboundChannel-88] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 17:26:10.828 [clientInboundChannel-88] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:10.828 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:26:10.823807400', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:26:10.835 [clientInboundChannel-88] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: BOT
2026-01-26 17:26:10.837 [clientInboundChannel-88] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 17:26:22.037 [http-nio-28070-exec-4] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-d5c026a4
2026-01-26 17:26:22.038 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:26:22.076 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:22.076 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:26:22.079 [http-nio-28070-exec-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-d5c026a4, status=AGENT
2026-01-26 17:26:22.135 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-d5c026a4, sessionId=np4elgta
2026-01-26 17:26:22.100 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:22.100 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:26:22.144 [http-nio-28070-exec-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-d5c026a4, agent=상담원-01
2026-01-26 17:26:22.156 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:22.156 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T17:26:22.148536', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:26:22.157 [http-nio-28070-exec-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 17:26:22.181 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=np4elgta
2026-01-26 17:26:22.182 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-d5c026a4, sessionId=np4elgta
2026-01-26 17:26:54.409 [clientInboundChannel-82] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-d5c026a4
2026-01-26 17:26:54.416 [clientInboundChannel-82] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:54.416 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:26:54.410907', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:26:54.417 [clientInboundChannel-82] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=상담원-01, message=ㅇ
2026-01-26 17:26:54.423 [clientInboundChannel-82] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:54.423 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:26:54.420915900', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:26:54.429 [clientInboundChannel-82] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: AGENT
2026-01-26 17:26:54.430 [clientInboundChannel-82] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-d5c026a4
2026-01-26 17:26:57.779 [clientInboundChannel-86] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-d5c026a4
2026-01-26 17:26:57.786 [clientInboundChannel-86] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:57.786 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:26:57.779380600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:26:57.786 [clientInboundChannel-86] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=상담원-01, message=ㅇ
2026-01-26 17:26:57.794 [clientInboundChannel-86] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:57.794 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:26:57.789356800', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:26:57.801 [clientInboundChannel-86] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: AGENT
2026-01-26 17:26:57.801 [clientInboundChannel-86] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-d5c026a4
2026-01-26 17:26:59.526 [clientInboundChannel-88] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-d5c026a4
2026-01-26 17:26:59.531 [clientInboundChannel-88] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:59.531 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:26:59.526727900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:26:59.532 [clientInboundChannel-88] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=상담원-01, message=ㅇ
2026-01-26 17:26:59.539 [clientInboundChannel-88] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:26:59.539 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:26:59.534710500', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:26:59.547 [clientInboundChannel-88] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: AGENT
2026-01-26 17:26:59.548 [clientInboundChannel-88] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-d5c026a4
2026-01-26 17:27:01.177 [clientInboundChannel-77] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-d5c026a4
2026-01-26 17:27:01.182 [clientInboundChannel-77] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:01.182 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:27:01.177821700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:27:01.183 [clientInboundChannel-77] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=상담원-01, message=ㅇ
2026-01-26 17:27:01.190 [clientInboundChannel-77] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:01.190 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:27:01.185798700', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:27:01.195 [clientInboundChannel-77] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: AGENT
2026-01-26 17:27:01.196 [clientInboundChannel-77] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-d5c026a4
2026-01-26 17:27:03.764 [clientInboundChannel-80] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-d5c026a4
2026-01-26 17:27:03.769 [clientInboundChannel-80] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:03.769 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'cust01', '홍길철', 'CUSTOMER', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:27:03.764674800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:27:03.770 [clientInboundChannel-80] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=홍길철, message=ㅇ
2026-01-26 17:27:03.776 [clientInboundChannel-80] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:03.776 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:27:03.772655500', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:27:03.780 [clientInboundChannel-80] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: AGENT
2026-01-26 17:27:03.780 [clientInboundChannel-80] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-d5c026a4
2026-01-26 17:27:05.533 [clientInboundChannel-83] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-d5c026a4
2026-01-26 17:27:05.538 [clientInboundChannel-83] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:05.538 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'cust01', '홍길철', 'CUSTOMER', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:27:05.533008800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:27:05.539 [clientInboundChannel-83] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=홍길철, message=ㅇ
2026-01-26 17:27:05.545 [clientInboundChannel-83] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:05.545 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:27:05.541985600', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:27:05.551 [clientInboundChannel-83] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: AGENT
2026-01-26 17:27:05.551 [clientInboundChannel-83] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-d5c026a4
2026-01-26 17:27:07.857 [clientInboundChannel-82] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-d5c026a4
2026-01-26 17:27:07.864 [clientInboundChannel-82] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:07.864 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:27:07.858506300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:27:07.864 [clientInboundChannel-82] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=상담원-01, message=ㅇ
2026-01-26 17:27:07.872 [clientInboundChannel-82] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:27:07.872 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:27:07.867481200', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:27:07.885 [clientInboundChannel-82] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: AGENT
2026-01-26 17:27:07.885 [clientInboundChannel-82] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-d5c026a4
2026-01-26 17:28:36.368 [http-nio-28070-exec-1] INFO  a.c.controller.AgentChatController - Agent request deleteRoom: roomId=room-d5c026a4
2026-01-26 17:28:36.378 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:28:36.391 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:28:36.391 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:28:36.392 [http-nio-28070-exec-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-d5c026a4, status=CLOSED
2026-01-26 17:28:36.400 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:28:36.400 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T17:28:36.394105300', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:28:36.402 [http-nio-28070-exec-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-d5c026a4
2026-01-26 17:28:36.412 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:28:36.412 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'SYSTEM', 'System', 'SYSTEM', '상담원 상담원-01에 의해 상담이 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T17:28:36.406073800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:28:36.413 [http-nio-28070-exec-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=System, message=상담원 상담원-01에 의해 상담이 종료되었습니다.
2026-01-26 17:28:38.194 [http-nio-28070-exec-2] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:28:38.208 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=np4elgta
2026-01-26 17:28:40.106 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-d5c026a4, sessionId=np4elgta
2026-01-26 17:28:59.592 [MessageBroker-8] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-d5c026a4 (Idle for 111710 ms)
2026-01-26 17:29:16.160 [clientInboundChannel-95] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-d5c026a4
2026-01-26 17:29:16.167 [clientInboundChannel-95] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:16.167 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'cust01', '홍길철', 'CUSTOMER', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:29:16.161959300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:29:16.168 [clientInboundChannel-95] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=홍길철, message=ㅇ
2026-01-26 17:29:16.181 [clientInboundChannel-95] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:16.181 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:29:16.177888300', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:29:16.185 [clientInboundChannel-95] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: BOT
2026-01-26 17:29:16.188 [clientInboundChannel-95] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-d5c026a4
2026-01-26 17:29:16.189 [clientInboundChannel-95] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-d5c026a4, CompanyId: apt001
2026-01-26 17:29:16.199 [reactor-http-nio-4] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:29:16.209 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:16.209 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:29:16.201829600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:29:16.210 [reactor-http-nio-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:29:16.218 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:16.218 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:29:16.212800200', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:29:23.795 [clientInboundChannel-98] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-d5c026a4
2026-01-26 17:29:23.800 [clientInboundChannel-98] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:23.800 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'cust01', '홍길철', 'CUSTOMER', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:29:23.796787200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:29:23.801 [clientInboundChannel-98] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=홍길철, message=ㅇ
2026-01-26 17:29:23.807 [clientInboundChannel-98] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:23.806 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:29:23.802754700', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:29:23.811 [clientInboundChannel-98] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: BOT
2026-01-26 17:29:23.812 [clientInboundChannel-98] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-d5c026a4
2026-01-26 17:29:23.812 [clientInboundChannel-98] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-d5c026a4, CompanyId: apt001
2026-01-26 17:29:23.817 [reactor-http-nio-5] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:29:23.827 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:23.827 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:29:23.818711500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:29:23.828 [reactor-http-nio-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:29:23.835 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:23.835 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:29:23.830677700', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:29:46.410 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=xb0qqgsb, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:29:46.416 [clientInboundChannel-101] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-d5c026a4
2026-01-26 17:29:46.420 [clientInboundChannel-101] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:46.420 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-d5c026a4', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T17:29:46.416587200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:29:46.421 [clientInboundChannel-101] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-d5c026a4, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 17:29:46.433 [clientInboundChannel-101] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:46.433 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:29:46.430324400', updated_at = NOW() 
WHERE room_id = 'room-d5c026a4'
===========================================================================================================
2026-01-26 17:29:46.437 [clientInboundChannel-101] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-d5c026a4 is being closed due to LEAVE message
2026-01-26 17:29:46.442 [clientInboundChannel-101] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-d5c026a4, current mode: CLOSED
2026-01-26 17:29:46.444 [clientInboundChannel-101] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 17:29:49.214 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 17:29:49.214 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:29:49.229 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:49.229 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T17:29:49.224340400', NOW()), NULL, COALESCE('2026-01-26T17:29:49.224340400', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:29:49.229 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-cf2fbf26, customerId=cust01
2026-01-26 17:29:49.230 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-cf2fbf26
2026-01-26 17:29:49.232 [http-nio-28070-exec-10] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-cf2fbf26
2026-01-26 17:29:49.240 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:49.240 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T17:29:49.233316600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 17:29:49.241 [http-nio-28070-exec-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-cf2fbf26, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 17:29:49.268 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:29:49.269 [http-nio-28070-exec-1] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-cf2fbf26, Company: apt001
2026-01-26 17:29:49.275 [clientOutboundChannel-80] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-cf2fbf26, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@ba83fe3, simpSessionId=ksq4y4lj}], simpSessionId=ksq4y4lj}
2026-01-26 17:29:49.276 [clientOutboundChannel-80] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=ksq4y4lj
2026-01-26 17:29:49.280 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-cf2fbf26, sessionId=ksq4y4lj
2026-01-26 17:29:49.284 [clientInboundChannel-98] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-cf2fbf26
2026-01-26 17:29:49.291 [clientInboundChannel-98] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:49.291 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T17:29:49.285179400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:29:49.291 [clientInboundChannel-98] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-cf2fbf26, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 17:29:49.295 [clientInboundChannel-98] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:29:49.295 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:29:49.293155300', updated_at = NOW() 
WHERE room_id = 'room-cf2fbf26'
===========================================================================================================
2026-01-26 17:29:49.299 [clientInboundChannel-98] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-cf2fbf26, current mode: BOT
2026-01-26 17:29:49.300 [clientInboundChannel-98] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 17:30:10.885 [http-nio-28070-exec-6] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-cf2fbf26
2026-01-26 17:30:10.885 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:30:10.965 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-cf2fbf26, sessionId=np4elgta
2026-01-26 17:30:10.973 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:10.973 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 15ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-cf2fbf26'
===========================================================================================================
2026-01-26 17:30:10.974 [http-nio-28070-exec-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-cf2fbf26, status=AGENT
2026-01-26 17:30:10.990 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:10.990 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-cf2fbf26'
===========================================================================================================
2026-01-26 17:30:10.991 [http-nio-28070-exec-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-cf2fbf26, agent=상담원-01
2026-01-26 17:30:10.999 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:10.999 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T17:30:10.993890900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:30:11.000 [http-nio-28070-exec-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-cf2fbf26, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 17:30:11.014 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=np4elgta
2026-01-26 17:30:11.015 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-cf2fbf26, sessionId=np4elgta
2026-01-26 17:30:39.082 [clientInboundChannel-111] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-cf2fbf26
2026-01-26 17:30:39.087 [clientInboundChannel-111] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:39.087 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:30:39.082133300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:30:39.088 [clientInboundChannel-111] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-cf2fbf26, sender=상담원-01, message=ㅇ
2026-01-26 17:30:39.093 [clientInboundChannel-111] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:39.092 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:30:39.089120900', updated_at = NOW() 
WHERE room_id = 'room-cf2fbf26'
===========================================================================================================
2026-01-26 17:30:39.097 [clientInboundChannel-111] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-cf2fbf26, current mode: AGENT
2026-01-26 17:30:39.097 [clientInboundChannel-111] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-cf2fbf26
2026-01-26 17:30:46.832 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=np4elgta, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:30:49.327 [http-nio-28070-exec-1] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 17:30:49.334 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:49.334 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 17:30:49.341 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:30:49.362 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:30:49.362 [http-nio-28070-exec-3] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 17:30:49.372 [clientOutboundChannel-86] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@1856713e, simpSessionId=zby4azfv}], simpSessionId=zby4azfv}
2026-01-26 17:30:49.375 [clientOutboundChannel-86] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=zby4azfv
2026-01-26 17:30:49.381 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=zby4azfv
2026-01-26 17:30:49.383 [http-nio-28070-exec-7] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:30:49.393 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-cf2fbf26, sessionId=zby4azfv
2026-01-26 17:30:50.700 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=zby4azfv
2026-01-26 17:30:50.701 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-cf2fbf26, sessionId=zby4azfv
2026-01-26 17:30:54.129 [clientInboundChannel-114] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-cf2fbf26
2026-01-26 17:30:54.133 [clientInboundChannel-114] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:54.133 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 1ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:30:54.129688100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:30:54.134 [clientInboundChannel-114] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-cf2fbf26, sender=상담원-01, message=ㅇ
2026-01-26 17:30:54.138 [clientInboundChannel-114] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:54.138 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:30:54.136665800', updated_at = NOW() 
WHERE room_id = 'room-cf2fbf26'
===========================================================================================================
2026-01-26 17:30:54.144 [clientInboundChannel-114] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-cf2fbf26, current mode: AGENT
2026-01-26 17:30:54.144 [clientInboundChannel-114] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-cf2fbf26
2026-01-26 17:30:58.423 [clientInboundChannel-116] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-cf2fbf26
2026-01-26 17:30:58.428 [clientInboundChannel-116] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:58.428 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 1ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'agent01', '상담원-01', 'AGENT', 'ㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:30:58.423310600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:30:58.429 [clientInboundChannel-116] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-cf2fbf26, sender=상담원-01, message=ㅇ
2026-01-26 17:30:58.434 [clientInboundChannel-116] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:30:58.434 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:30:58.431288100', updated_at = NOW() 
WHERE room_id = 'room-cf2fbf26'
===========================================================================================================
2026-01-26 17:30:58.438 [clientInboundChannel-116] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-cf2fbf26, current mode: AGENT
2026-01-26 17:30:58.438 [clientInboundChannel-116] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-cf2fbf26
2026-01-26 17:31:59.585 [MessageBroker-4] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-cf2fbf26 (Idle for 61149 ms)
2026-01-26 17:34:36.851 [http-nio-28070-exec-7] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 17:34:36.859 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:36.859 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 17:34:36.870 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:34:36.948 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:34:36.948 [http-nio-28070-exec-4] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 17:34:36.958 [clientOutboundChannel-92] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@3dc3d58a, simpSessionId=ppjtaxgy}], simpSessionId=ppjtaxgy}
2026-01-26 17:34:36.959 [clientOutboundChannel-92] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=ppjtaxgy
2026-01-26 17:34:36.965 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=ppjtaxgy
2026-01-26 17:34:36.968 [http-nio-28070-exec-5] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:34:39.399 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=ksq4y4lj, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:34:39.406 [clientInboundChannel-128] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-cf2fbf26
2026-01-26 17:34:39.413 [clientInboundChannel-128] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:39.413 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-cf2fbf26', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T17:34:39.406330200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:34:39.414 [clientInboundChannel-128] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-cf2fbf26, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 17:34:39.423 [clientInboundChannel-128] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:39.423 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:34:39.417875100', updated_at = NOW() 
WHERE room_id = 'room-cf2fbf26'
===========================================================================================================
2026-01-26 17:34:39.427 [clientInboundChannel-128] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-cf2fbf26 is being closed due to LEAVE message
2026-01-26 17:34:39.434 [clientInboundChannel-128] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-cf2fbf26, current mode: CLOSED
2026-01-26 17:34:39.436 [clientInboundChannel-128] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 17:34:42.478 [http-nio-28070-exec-6] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 17:34:42.479 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:34:42.492 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:42.492 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T17:34:42.483517400', NOW()), NULL, COALESCE('2026-01-26T17:34:42.483517400', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:34:42.493 [http-nio-28070-exec-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-a12474d0, customerId=cust01
2026-01-26 17:34:42.495 [http-nio-28070-exec-6] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-a12474d0
2026-01-26 17:34:42.496 [http-nio-28070-exec-6] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-a12474d0
2026-01-26 17:34:42.505 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:42.505 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T17:34:42.497482800', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 17:34:42.506 [http-nio-28070-exec-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 17:34:42.541 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:34:42.541 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-a12474d0, Company: apt001
2026-01-26 17:34:42.547 [clientOutboundChannel-100] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-a12474d0, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@2da81026, simpSessionId=2m5ldd24}], simpSessionId=2m5ldd24}
2026-01-26 17:34:42.549 [clientOutboundChannel-100] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=2m5ldd24
2026-01-26 17:34:42.554 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a12474d0, sessionId=2m5ldd24
2026-01-26 17:34:42.557 [clientInboundChannel-127] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a12474d0
2026-01-26 17:34:42.561 [clientInboundChannel-127] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:42.561 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T17:34:42.557503200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:34:42.561 [clientInboundChannel-127] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 17:34:42.569 [clientInboundChannel-127] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:42.569 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:34:42.563487400', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:34:42.573 [clientInboundChannel-127] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a12474d0, current mode: BOT
2026-01-26 17:34:42.574 [clientInboundChannel-127] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 17:34:45.826 [http-nio-28070-exec-4] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-a12474d0
2026-01-26 17:34:45.827 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:34:45.841 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a12474d0, sessionId=zby4azfv
2026-01-26 17:34:45.844 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:45.843 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:34:45.845 [http-nio-28070-exec-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-a12474d0, status=AGENT
2026-01-26 17:34:45.849 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a12474d0, sessionId=ppjtaxgy
2026-01-26 17:34:45.857 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:45.856 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 6ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:34:45.857 [http-nio-28070-exec-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-a12474d0, agent=상담원-01
2026-01-26 17:34:45.865 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:34:45.865 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T17:34:45.859649200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:34:45.867 [http-nio-28070-exec-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 17:34:45.877 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=ppjtaxgy
2026-01-26 17:34:45.878 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a12474d0, sessionId=ppjtaxgy
2026-01-26 17:34:47.842 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=zby4azfv
2026-01-26 17:34:47.843 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-a12474d0, sessionId=zby4azfv
2026-01-26 17:35:59.598 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-a12474d0 (Idle for 73769 ms)
2026-01-26 17:36:06.946 [clientInboundChannel-138] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a12474d0
2026-01-26 17:36:06.955 [clientInboundChannel-138] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:06.955 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:06.947457100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:06.955 [clientInboundChannel-138] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=홍길철, message=ㅇㅇㅇ
2026-01-26 17:36:06.960 [clientInboundChannel-138] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:06.960 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:06.957432200', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:06.967 [clientInboundChannel-138] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a12474d0, current mode: BOT
2026-01-26 17:36:06.968 [clientInboundChannel-138] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-a12474d0
2026-01-26 17:36:06.969 [clientInboundChannel-138] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-a12474d0, CompanyId: apt001
2026-01-26 17:36:06.975 [reactor-http-nio-6] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:36:06.984 [reactor-http-nio-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:06.984 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:06.976379600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:06.985 [reactor-http-nio-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:36:06.991 [reactor-http-nio-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:06.991 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:06.987350700', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:13.971 [clientInboundChannel-141] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a12474d0
2026-01-26 17:36:13.976 [clientInboundChannel-141] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:13.976 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:13.972112900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:13.977 [clientInboundChannel-141] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=홍길철, message=ㅇㅇㅇㅇ
2026-01-26 17:36:13.980 [clientInboundChannel-141] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:13.980 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 1ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:13.978093600', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:13.985 [clientInboundChannel-141] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a12474d0, current mode: BOT
2026-01-26 17:36:13.986 [clientInboundChannel-141] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-a12474d0
2026-01-26 17:36:13.987 [clientInboundChannel-141] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-a12474d0, CompanyId: apt001
2026-01-26 17:36:13.992 [reactor-http-nio-7] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:36:14.003 [reactor-http-nio-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:14.002 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:13.994051800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:14.004 [reactor-http-nio-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:36:14.011 [reactor-http-nio-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:14.010 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:14.006019100', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:26.775 [http-nio-28070-exec-10] INFO  a.c.controller.AgentChatController - Agent request deleteRoom: roomId=room-a12474d0
2026-01-26 17:36:26.775 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:36:26.783 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:26.783 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:26.784 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-a12474d0, status=CLOSED
2026-01-26 17:36:26.794 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:26.794 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T17:36:26.786849900', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:26.796 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-a12474d0
2026-01-26 17:36:26.806 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:26.806 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'SYSTEM', 'System', 'SYSTEM', '상담원 상담원-01에 의해 상담이 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T17:36:26.798817200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:26.807 [http-nio-28070-exec-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=System, message=상담원 상담원-01에 의해 상담이 종료되었습니다.
2026-01-26 17:36:30.113 [clientInboundChannel-144] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a12474d0
2026-01-26 17:36:30.117 [clientInboundChannel-144] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:30.117 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:30.113518', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:30.118 [clientInboundChannel-144] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=홍길철, message=ㅇㅇㅇ
2026-01-26 17:36:30.122 [clientInboundChannel-144] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:30.122 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:30.120502900', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:30.126 [clientInboundChannel-144] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a12474d0, current mode: CLOSED
2026-01-26 17:36:30.127 [clientInboundChannel-144] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-a12474d0
2026-01-26 17:36:30.128 [clientInboundChannel-144] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-a12474d0, CompanyId: apt001
2026-01-26 17:36:30.133 [reactor-http-nio-8] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:36:30.144 [reactor-http-nio-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:30.144 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:30.135459500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:30.145 [reactor-http-nio-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:36:30.151 [reactor-http-nio-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:30.151 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:30.147433300', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:38.120 [clientInboundChannel-147] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a12474d0
2026-01-26 17:36:38.125 [clientInboundChannel-147] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:38.125 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:38.121933600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:38.126 [clientInboundChannel-147] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=홍길철, message=ㅇㅇㅇㅇㅇ
2026-01-26 17:36:38.130 [clientInboundChannel-147] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:38.130 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:38.128912800', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:36:38.134 [clientInboundChannel-147] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a12474d0, current mode: CLOSED
2026-01-26 17:36:38.135 [clientInboundChannel-147] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-a12474d0
2026-01-26 17:36:38.135 [clientInboundChannel-147] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-a12474d0, CompanyId: apt001
2026-01-26 17:36:38.140 [reactor-http-nio-1] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:36:38.148 [reactor-http-nio-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:38.148 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:36:38.142877800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:36:38.149 [reactor-http-nio-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:36:38.159 [reactor-http-nio-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:36:38.159 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:36:38.152854800', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:37:05.401 [clientInboundChannel-150] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-a12474d0
2026-01-26 17:37:05.406 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=2m5ldd24, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:37:05.410 [clientInboundChannel-150] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:05.410 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-a12474d0', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T17:37:05.402515300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:05.410 [clientInboundChannel-150] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-a12474d0, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 17:37:05.416 [clientInboundChannel-150] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:05.415 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:05.412487600', updated_at = NOW() 
WHERE room_id = 'room-a12474d0'
===========================================================================================================
2026-01-26 17:37:05.419 [clientInboundChannel-150] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-a12474d0 is being closed due to LEAVE message
2026-01-26 17:37:05.426 [clientInboundChannel-150] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-a12474d0, current mode: CLOSED
2026-01-26 17:37:05.427 [clientInboundChannel-150] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 17:37:11.424 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 17:37:11.425 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:37:11.436 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:11.436 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T17:37:11.430546100', NOW()), NULL, COALESCE('2026-01-26T17:37:11.430546100', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:11.437 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-0de2b08e, customerId=cust01
2026-01-26 17:37:11.440 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-0de2b08e
2026-01-26 17:37:11.442 [http-nio-28070-exec-5] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-0de2b08e
2026-01-26 17:37:11.449 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:11.449 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T17:37:11.443028400', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 17:37:11.450 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 17:37:11.475 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:37:11.475 [http-nio-28070-exec-6] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-0de2b08e, Company: apt001
2026-01-26 17:37:11.482 [clientOutboundChannel-113] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-0de2b08e, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@26635fc6, simpSessionId=fvysabz2}], simpSessionId=fvysabz2}
2026-01-26 17:37:11.483 [clientOutboundChannel-113] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=fvysabz2
2026-01-26 17:37:11.496 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-0de2b08e, sessionId=fvysabz2
2026-01-26 17:37:11.506 [clientInboundChannel-147] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-0de2b08e
2026-01-26 17:37:11.515 [clientInboundChannel-147] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:11.515 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T17:37:11.507855400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:11.515 [clientInboundChannel-147] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 17:37:11.520 [clientInboundChannel-147] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:11.520 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 1ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:11.517828100', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:11.524 [clientInboundChannel-147] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-0de2b08e, current mode: BOT
2026-01-26 17:37:11.525 [clientInboundChannel-147] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 17:37:20.697 [clientInboundChannel-154] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-0de2b08e
2026-01-26 17:37:20.703 [clientInboundChannel-154] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:20.703 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:20.697330300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:20.703 [clientInboundChannel-154] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=홍길철, message=ㅇㅇㅇ
2026-01-26 17:37:20.708 [clientInboundChannel-154] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:20.708 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:20.705305400', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:20.714 [clientInboundChannel-154] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-0de2b08e, current mode: BOT
2026-01-26 17:37:20.715 [clientInboundChannel-154] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-0de2b08e
2026-01-26 17:37:20.715 [clientInboundChannel-154] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-0de2b08e, CompanyId: apt001
2026-01-26 17:37:20.720 [reactor-http-nio-2] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:37:20.730 [reactor-http-nio-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:20.729 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:20.723259600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:20.731 [reactor-http-nio-2] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:37:20.738 [reactor-http-nio-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:20.738 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:20.733232100', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:22.903 [http-nio-28070-exec-10] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 17:37:26.337 [clientInboundChannel-152] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-0de2b08e
2026-01-26 17:37:26.343 [clientInboundChannel-152] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:26.343 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:26.337963400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:26.343 [clientInboundChannel-152] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=홍길철, message=ㅇㅇㅇ
2026-01-26 17:37:26.349 [clientInboundChannel-152] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:26.349 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:26.346939200', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:26.353 [clientInboundChannel-152] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-0de2b08e, current mode: BOT
2026-01-26 17:37:26.354 [clientInboundChannel-152] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-0de2b08e
2026-01-26 17:37:26.354 [clientInboundChannel-152] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-0de2b08e, CompanyId: apt001
2026-01-26 17:37:26.358 [reactor-http-nio-3] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:37:26.367 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:26.367 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:26.360911900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:26.367 [reactor-http-nio-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:37:26.375 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:26.375 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:26.370403200', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:28.057 [clientInboundChannel-150] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-0de2b08e
2026-01-26 17:37:28.061 [clientInboundChannel-150] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:28.061 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:28.057039500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:28.062 [clientInboundChannel-150] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=홍길철, message=ㅇㅇㅇ
2026-01-26 17:37:28.067 [clientInboundChannel-150] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:28.067 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:28.064014100', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:28.069 [clientInboundChannel-150] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-0de2b08e, current mode: BOT
2026-01-26 17:37:28.071 [clientInboundChannel-150] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-0de2b08e
2026-01-26 17:37:28.072 [clientInboundChannel-150] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-0de2b08e, CompanyId: apt001
2026-01-26 17:37:28.076 [reactor-http-nio-4] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:37:28.084 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:28.084 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:28.078497', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:28.085 [reactor-http-nio-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:37:28.092 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:28.092 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:28.087471500', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:29.671 [clientInboundChannel-146] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-0de2b08e
2026-01-26 17:37:29.675 [clientInboundChannel-146] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:29.675 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 1ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'cust01', '홍길철', 'CUSTOMER', 'ㅇㅇㅇ', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:29.672056500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:29.675 [clientInboundChannel-146] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=홍길철, message=ㅇㅇㅇ
2026-01-26 17:37:29.678 [clientInboundChannel-146] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:29.678 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:29.676563500', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:37:29.682 [clientInboundChannel-146] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-0de2b08e, current mode: BOT
2026-01-26 17:37:29.683 [clientInboundChannel-146] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-0de2b08e
2026-01-26 17:37:29.683 [clientInboundChannel-146] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-0de2b08e, CompanyId: apt001
2026-01-26 17:37:29.688 [reactor-http-nio-5] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 17:37:29.695 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:29.695 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-0de2b08e', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T17:37:29.689528600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:37:29.697 [reactor-http-nio-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-0de2b08e, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 17:37:29.703 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:37:29.703 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:37:29.698507100', updated_at = NOW() 
WHERE room_id = 'room-0de2b08e'
===========================================================================================================
2026-01-26 17:38:59.598 [MessageBroker-7] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-0de2b08e (Idle for 89917 ms)
2026-01-26 17:42:58.566 [MessageBroker-5] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[3 current WS(3)-HttpStream(0)-HttpPoll(0), 19 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(19)-CONNECTED(19)-DISCONNECT(5)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 354], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 164], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 5, completed tasks = 1028]
2026-01-26 17:53:58.145 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 53404 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 17:53:58.153 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 17:54:00.694 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 17:54:00.700 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 17:54:00.764 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 31 ms. Found 0 Redis repository interfaces.
2026-01-26 17:54:01.914 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 17:54:01.944 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 17:54:01.948 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 17:54:01.949 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 17:54:02.160 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 17:54:02.161 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3909 ms
2026-01-26 17:54:05.621 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 17:54:05.719 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 17:54:05.720 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@294a12b5]]
2026-01-26 17:54:05.721 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 17:54:05.767 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 17:54:05.794 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 17:54:06.765 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 9.847 seconds (process running for 11.409)
2026-01-26 17:54:07.924 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 17:54:07.925 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 17:54:07.928 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 17:55:05.685 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 1, completed tasks = 1]
2026-01-26 17:56:31.976 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:58:17.103 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:58:18.221 [http-nio-28070-exec-9] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 17:58:18.222 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:58:18.690 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:58:18.690 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 97ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-b6f34cd8', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T17:58:18.241621600', NOW()), NULL, COALESCE('2026-01-26T17:58:18.241621600', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:58:18.692 [http-nio-28070-exec-9] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-b6f34cd8, customerId=cust01
2026-01-26 17:58:18.702 [http-nio-28070-exec-9] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-b6f34cd8
2026-01-26 17:58:18.704 [http-nio-28070-exec-9] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-b6f34cd8
2026-01-26 17:58:18.729 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:58:18.729 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b6f34cd8', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T17:58:18.715247800', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 17:58:18.732 [http-nio-28070-exec-9] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b6f34cd8, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 17:58:18.803 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 17:58:18.804 [http-nio-28070-exec-1] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-b6f34cd8, Company: apt001
2026-01-26 17:58:18.973 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-b6f34cd8, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@6432d925, simpSessionId=2ke55d1b}], simpSessionId=2ke55d1b}
2026-01-26 17:58:18.974 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=2ke55d1b
2026-01-26 17:58:18.983 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-b6f34cd8, sessionId=2ke55d1b
2026-01-26 17:58:19.017 [clientInboundChannel-7] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-b6f34cd8
2026-01-26 17:58:19.037 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:58:19.037 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 13ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b6f34cd8', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T17:58:19.018148700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:58:19.039 [clientInboundChannel-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b6f34cd8, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 17:58:19.071 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:58:19.071 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 21ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:58:19.042084400', updated_at = NOW() 
WHERE room_id = 'room-b6f34cd8'
===========================================================================================================
2026-01-26 17:58:19.079 [clientInboundChannel-7] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b6f34cd8, current mode: BOT
2026-01-26 17:58:19.082 [clientInboundChannel-7] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 17:58:31.002 [clientInboundChannel-10] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-b6f34cd8
2026-01-26 17:58:31.004 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=2ke55d1b, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 17:58:31.016 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:58:31.016 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b6f34cd8', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T17:58:31.003891500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 17:58:31.018 [clientInboundChannel-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b6f34cd8, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 17:58:31.028 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 17:58:31.028 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T17:58:31.021378600', updated_at = NOW() 
WHERE room_id = 'room-b6f34cd8'
===========================================================================================================
2026-01-26 17:58:31.037 [clientInboundChannel-10] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-b6f34cd8 is being closed due to LEAVE message
2026-01-26 17:58:31.050 [clientInboundChannel-10] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b6f34cd8, current mode: CLOSED
2026-01-26 17:58:31.052 [clientInboundChannel-10] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 18:00:06.783 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-b6f34cd8 (Idle for 95748 ms)
2026-01-26 18:00:06.786 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-b6f34cd8
2026-01-26 18:00:06.799 [MessageBroker-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:00:06.798 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 7ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-b6f34cd8'
===========================================================================================================
2026-01-26 18:00:06.800 [MessageBroker-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-b6f34cd8, status=CLOSED
2026-01-26 18:00:06.810 [MessageBroker-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:00:06.810 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:00:06.803375200', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-b6f34cd8'
===========================================================================================================
2026-01-26 18:00:06.811 [MessageBroker-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-b6f34cd8
2026-01-26 18:00:06.825 [MessageBroker-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:00:06.824 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b6f34cd8', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:00:06.826 [MessageBroker-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b6f34cd8, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:00:06.828 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-b6f34cd8
2026-01-26 18:02:07.490 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:02:21.773 [http-nio-28070-exec-1] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 18:02:21.881 [http-nio-28070-exec-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:02:21.881 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 104ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:02:41.540 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:02:51.878 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 18:02:51.887 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:02:51.887 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 7ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:02:55.941 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:02:57.511 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:02:57.511 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:02:57.532 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:02:57.532 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-315b5fd0', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:02:57.519582200', NOW()), NULL, COALESCE('2026-01-26T18:02:57.519582200', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:02:57.534 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-315b5fd0, customerId=cust01
2026-01-26 18:02:57.538 [http-nio-28070-exec-8] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-315b5fd0
2026-01-26 18:02:57.540 [http-nio-28070-exec-8] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-315b5fd0
2026-01-26 18:02:57.552 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:02:57.552 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-315b5fd0', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:02:57.542525', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:02:57.554 [http-nio-28070-exec-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-315b5fd0, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:02:57.594 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:02:57.595 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-315b5fd0, Company: apt001
2026-01-26 18:02:57.618 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-315b5fd0, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@55bafeb, simpSessionId=wr55dqgt}], simpSessionId=wr55dqgt}
2026-01-26 18:02:57.619 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=wr55dqgt
2026-01-26 18:02:57.627 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-315b5fd0, sessionId=wr55dqgt
2026-01-26 18:02:57.634 [clientInboundChannel-23] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-315b5fd0
2026-01-26 18:02:57.653 [clientInboundChannel-23] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:02:57.653 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 10ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-315b5fd0', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:02:57.639442700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:02:57.654 [clientInboundChannel-23] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-315b5fd0, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:02:57.664 [clientInboundChannel-23] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:02:57.664 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:02:57.657389900', updated_at = NOW() 
WHERE room_id = 'room-315b5fd0'
===========================================================================================================
2026-01-26 18:02:57.671 [clientInboundChannel-23] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-315b5fd0, current mode: BOT
2026-01-26 18:02:57.673 [clientInboundChannel-23] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:03:19.149 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:03:19.199 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:03:19.200 [http-nio-28070-exec-8] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:03:19.219 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@1783c280, simpSessionId=potihjyj}], simpSessionId=potihjyj}
2026-01-26 18:03:19.220 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=potihjyj
2026-01-26 18:03:19.227 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=potihjyj
2026-01-26 18:03:19.231 [http-nio-28070-exec-10] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:03:21.747 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=potihjyj, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:03:23.961 [http-nio-28070-exec-3] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 18:03:23.973 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:03:23.973 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 8ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:03:23.986 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:03:24.004 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:03:24.004 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:03:24.011 [clientOutboundChannel-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@16efb761, simpSessionId=uh32omzu}], simpSessionId=uh32omzu}
2026-01-26 18:03:24.012 [clientOutboundChannel-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=uh32omzu
2026-01-26 18:03:24.017 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=uh32omzu
2026-01-26 18:03:24.020 [http-nio-28070-exec-10] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:04:06.781 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-315b5fd0 (Idle for 69114 ms)
2026-01-26 18:04:06.783 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-315b5fd0
2026-01-26 18:04:06.791 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:06.791 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-315b5fd0'
===========================================================================================================
2026-01-26 18:04:06.792 [MessageBroker-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-315b5fd0, status=CLOSED
2026-01-26 18:04:06.798 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:06.798 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:04:06.794148900', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-315b5fd0'
===========================================================================================================
2026-01-26 18:04:06.799 [MessageBroker-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-315b5fd0
2026-01-26 18:04:06.808 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:06.807 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-315b5fd0', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:04:06.808 [MessageBroker-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-315b5fd0, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:04:06.812 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-315b5fd0
2026-01-26 18:04:09.803 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=wr55dqgt, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:04:19.787 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:04:19.787 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:04:19.807 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:19.807 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-05ed4df1', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:04:19.795643700', NOW()), NULL, COALESCE('2026-01-26T18:04:19.795643700', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:04:19.808 [http-nio-28070-exec-3] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-05ed4df1, customerId=cust01
2026-01-26 18:04:19.810 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-05ed4df1
2026-01-26 18:04:19.812 [http-nio-28070-exec-3] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-05ed4df1
2026-01-26 18:04:19.826 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:19.826 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-05ed4df1', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:04:19.814592600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:04:19.827 [http-nio-28070-exec-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-05ed4df1, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:04:19.866 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:04:19.867 [http-nio-28070-exec-4] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-05ed4df1, Company: apt001
2026-01-26 18:04:19.879 [clientOutboundChannel-15] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-05ed4df1, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@3d7bed85, simpSessionId=hlwk4dwi}], simpSessionId=hlwk4dwi}
2026-01-26 18:04:19.879 [clientOutboundChannel-15] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=hlwk4dwi
2026-01-26 18:04:19.885 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-05ed4df1, sessionId=hlwk4dwi
2026-01-26 18:04:19.894 [clientInboundChannel-32] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-05ed4df1
2026-01-26 18:04:19.900 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:19.900 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-05ed4df1', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:04:19.894104800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:04:19.900 [clientInboundChannel-32] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-05ed4df1, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:04:19.909 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:19.909 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:04:19.903080700', updated_at = NOW() 
WHERE room_id = 'room-05ed4df1'
===========================================================================================================
2026-01-26 18:04:19.926 [clientInboundChannel-32] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-05ed4df1, current mode: BOT
2026-01-26 18:04:19.928 [clientInboundChannel-32] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:04:26.800 [clientInboundChannel-41] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-05ed4df1
2026-01-26 18:04:26.800 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=hlwk4dwi, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:04:26.808 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:26.808 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-05ed4df1', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T18:04:26.800710500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:04:26.809 [clientInboundChannel-41] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-05ed4df1, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 18:04:26.816 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:26.816 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:04:26.812293100', updated_at = NOW() 
WHERE room_id = 'room-05ed4df1'
===========================================================================================================
2026-01-26 18:04:26.821 [clientInboundChannel-41] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-05ed4df1 is being closed due to LEAVE message
2026-01-26 18:04:26.836 [clientInboundChannel-41] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-05ed4df1, current mode: CLOSED
2026-01-26 18:04:26.838 [clientInboundChannel-41] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 18:04:44.617 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:04:46.939 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:04:46.939 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:04:46.956 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:46.956 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-60550f91', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:04:46.948023', NOW()), NULL, COALESCE('2026-01-26T18:04:46.948023', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:04:46.958 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-60550f91, customerId=cust01
2026-01-26 18:04:46.961 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-60550f91
2026-01-26 18:04:46.964 [http-nio-28070-exec-5] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-60550f91
2026-01-26 18:04:46.975 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:46.975 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-60550f91', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:04:46.966970100', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:04:46.976 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-60550f91, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:04:47.040 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:04:47.041 [http-nio-28070-exec-6] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-60550f91, Company: apt001
2026-01-26 18:04:47.051 [clientOutboundChannel-21] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-60550f91, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@141cf4f8, simpSessionId=dkf0kn2v}], simpSessionId=dkf0kn2v}
2026-01-26 18:04:47.052 [clientOutboundChannel-21] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=dkf0kn2v
2026-01-26 18:04:47.058 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-60550f91, sessionId=dkf0kn2v
2026-01-26 18:04:47.063 [clientInboundChannel-32] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-60550f91
2026-01-26 18:04:47.071 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:47.071 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-60550f91', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:04:47.063388', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:04:47.072 [clientInboundChannel-32] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-60550f91, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:04:47.079 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:04:47.079 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:04:47.074359800', updated_at = NOW() 
WHERE room_id = 'room-60550f91'
===========================================================================================================
2026-01-26 18:04:47.085 [clientInboundChannel-32] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-60550f91, current mode: BOT
2026-01-26 18:04:47.087 [clientInboundChannel-32] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:06:06.785 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-05ed4df1 (Idle for 99966 ms)
2026-01-26 18:06:06.787 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-05ed4df1
2026-01-26 18:06:06.793 [MessageBroker-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:06:06.793 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-05ed4df1'
===========================================================================================================
2026-01-26 18:06:06.794 [MessageBroker-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-05ed4df1, status=CLOSED
2026-01-26 18:06:06.798 [MessageBroker-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:06:06.798 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 1ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:06:06.795747', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-05ed4df1'
===========================================================================================================
2026-01-26 18:06:06.798 [MessageBroker-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-05ed4df1
2026-01-26 18:06:06.803 [MessageBroker-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:06:06.803 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-05ed4df1', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:06:06.803 [MessageBroker-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-05ed4df1, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:06:06.805 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-05ed4df1
2026-01-26 18:06:06.811 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-60550f91 (Idle for 79702 ms)
2026-01-26 18:06:06.813 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-60550f91
2026-01-26 18:06:06.818 [MessageBroker-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:06:06.818 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-60550f91'
===========================================================================================================
2026-01-26 18:06:06.819 [MessageBroker-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-60550f91, status=CLOSED
2026-01-26 18:06:06.827 [MessageBroker-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:06:06.827 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:06:06.821683', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-60550f91'
===========================================================================================================
2026-01-26 18:06:06.828 [MessageBroker-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-60550f91
2026-01-26 18:06:06.835 [MessageBroker-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:06:06.834 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-60550f91', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:06:06.835 [MessageBroker-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-60550f91, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:06:06.837 [MessageBroker-5] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-60550f91
2026-01-26 18:06:09.828 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=dkf0kn2v, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:17:57.054 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 7576 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 18:17:57.062 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 18:18:00.608 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 18:18:00.619 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 18:18:00.712 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 56 ms. Found 0 Redis repository interfaces.
2026-01-26 18:18:01.971 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 18:18:02.017 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 18:18:02.020 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 18:18:02.021 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 18:18:02.162 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 18:18:02.163 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4934 ms
2026-01-26 18:18:05.327 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 18:18:05.454 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 18:18:05.456 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@14980819]]
2026-01-26 18:18:05.457 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 18:18:05.511 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 18:18:05.540 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 18:18:05.948 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 18:18:05.948 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 18:18:05.952 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 18:18:06.771 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 11.531 seconds (process running for 13.429)
2026-01-26 18:18:23.377 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:18:30.207 [http-nio-28070-exec-5] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 18:18:30.631 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:30.631 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 386ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:18:38.125 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:18:38.125 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:18:38.180 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:38.180 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 13ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:18:38.148366900', NOW()), NULL, COALESCE('2026-01-26T18:18:38.148366900', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:18:38.182 [http-nio-28070-exec-3] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-609cb583, customerId=cust01
2026-01-26 18:18:38.188 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-609cb583
2026-01-26 18:18:38.202 [http-nio-28070-exec-3] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-609cb583
2026-01-26 18:18:38.237 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:38.237 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:18:38.203053600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:18:38.240 [http-nio-28070-exec-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-609cb583, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:18:38.325 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:18:38.326 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-609cb583, Company: apt001
2026-01-26 18:18:38.535 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-609cb583, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@617c6585, simpSessionId=usnd2uig}], simpSessionId=usnd2uig}
2026-01-26 18:18:38.538 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=usnd2uig
2026-01-26 18:18:38.547 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-609cb583, sessionId=usnd2uig
2026-01-26 18:18:38.585 [clientInboundChannel-7] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-609cb583 at 2026-01-26T18:18:38.585156300
2026-01-26 18:18:38.599 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:38.599 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:18:38.585156300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:18:38.600 [clientInboundChannel-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-609cb583, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:18:38.618 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:38.618 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 12ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:18:38.602112600', updated_at = NOW() 
WHERE room_id = 'room-609cb583'
===========================================================================================================
2026-01-26 18:18:38.628 [clientInboundChannel-7] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-609cb583, current mode: BOT
2026-01-26 18:18:38.631 [clientInboundChannel-7] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:18:43.282 [clientInboundChannel-10] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-609cb583 at 2026-01-26T18:18:43.282263300
2026-01-26 18:18:43.289 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:43.289 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'cust01', '홍길철', 'CUSTOMER', 'ㅁ', 'TALK', 'apt001', COALESCE('2026-01-26T18:18:43.282263300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:18:43.290 [clientInboundChannel-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-609cb583, sender=홍길철, message=ㅁ
2026-01-26 18:18:43.298 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:43.298 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:18:43.292234900', updated_at = NOW() 
WHERE room_id = 'room-609cb583'
===========================================================================================================
2026-01-26 18:18:43.308 [clientInboundChannel-10] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-609cb583, current mode: BOT
2026-01-26 18:18:43.311 [clientInboundChannel-10] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-609cb583
2026-01-26 18:18:43.325 [clientInboundChannel-10] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-609cb583, CompanyId: apt001
2026-01-26 18:18:43.576 [reactor-http-nio-3] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 18:18:43.591 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:43.591 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T18:18:43.577546200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:18:43.593 [reactor-http-nio-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-609cb583, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 18:18:43.604 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:43.604 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:18:43.598488100', updated_at = NOW() 
WHERE room_id = 'room-609cb583'
===========================================================================================================
2026-01-26 18:18:51.628 [clientInboundChannel-13] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-609cb583 at 2026-01-26T18:18:51.628183
2026-01-26 18:18:51.638 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:51.638 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'cust01', '홍길철', 'CUSTOMER', 'ㅁ', 'TALK', 'apt001', COALESCE('2026-01-26T18:18:51.628183', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:18:51.639 [clientInboundChannel-13] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-609cb583, sender=홍길철, message=ㅁ
2026-01-26 18:18:51.647 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:51.647 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:18:51.642146800', updated_at = NOW() 
WHERE room_id = 'room-609cb583'
===========================================================================================================
2026-01-26 18:18:51.657 [clientInboundChannel-13] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-609cb583, current mode: BOT
2026-01-26 18:18:51.660 [clientInboundChannel-13] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-609cb583
2026-01-26 18:18:51.661 [clientInboundChannel-13] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-609cb583, CompanyId: apt001
2026-01-26 18:18:51.667 [reactor-http-nio-4] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 18:18:51.682 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:51.682 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T18:18:51.668622300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:18:51.686 [reactor-http-nio-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-609cb583, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 18:18:51.695 [reactor-http-nio-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:18:51.694 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:18:51.689565', updated_at = NOW() 
WHERE room_id = 'room-609cb583'
===========================================================================================================
2026-01-26 18:19:05.409 [MessageBroker-8] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 15, active threads = 0, queued tasks = 0, completed tasks = 15], outboundChannel[pool size = 6, active threads = 0, queued tasks = 0, completed tasks = 6], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 3, completed tasks = 7]
2026-01-26 18:20:01.845 [http-nio-28070-exec-5] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 18:20:01.857 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:01.856 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 8ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:20:01.869 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:20:01.897 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:20:01.898 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:20:01.910 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@3c473eeb, simpSessionId=im4lhzi2}], simpSessionId=im4lhzi2}
2026-01-26 18:20:01.912 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=im4lhzi2
2026-01-26 18:20:01.918 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=im4lhzi2
2026-01-26 18:20:01.921 [http-nio-28070-exec-8] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:20:06.775 [MessageBroker-4] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-609cb583 (Idle for 75121 ms)
2026-01-26 18:20:06.777 [MessageBroker-4] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-609cb583
2026-01-26 18:20:06.793 [MessageBroker-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:06.793 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 13ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-609cb583'
===========================================================================================================
2026-01-26 18:20:06.794 [MessageBroker-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-609cb583, status=CLOSED
2026-01-26 18:20:06.804 [MessageBroker-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:06.804 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 7ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:20:06.796144700', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-609cb583'
===========================================================================================================
2026-01-26 18:20:06.805 [MessageBroker-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-609cb583
2026-01-26 18:20:06.815 [MessageBroker-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:06.815 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-609cb583', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T18:20:06.777195700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:20:06.816 [MessageBroker-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-609cb583, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:20:06.819 [MessageBroker-4] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-609cb583
2026-01-26 18:20:09.802 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=usnd2uig, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:20:34.914 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:20:37.613 [http-nio-28070-exec-4] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:20:37.614 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:20:37.639 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:37.639 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 10ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-98a037b9', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:20:37.624894900', NOW()), NULL, COALESCE('2026-01-26T18:20:37.624894900', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:20:37.640 [http-nio-28070-exec-4] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-98a037b9, customerId=cust01
2026-01-26 18:20:37.643 [http-nio-28070-exec-4] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-98a037b9
2026-01-26 18:20:37.646 [http-nio-28070-exec-4] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-98a037b9
2026-01-26 18:20:37.660 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:37.660 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-98a037b9', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:20:37.646838600', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:20:37.663 [http-nio-28070-exec-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-98a037b9, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:20:37.744 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:20:37.744 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-98a037b9, Company: apt001
2026-01-26 18:20:37.756 [clientOutboundChannel-13] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-98a037b9, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@3968466b, simpSessionId=xybsq3ih}], simpSessionId=xybsq3ih}
2026-01-26 18:20:37.756 [clientOutboundChannel-13] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=xybsq3ih
2026-01-26 18:20:37.764 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-98a037b9, sessionId=xybsq3ih
2026-01-26 18:20:37.783 [clientInboundChannel-16] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-98a037b9 at 2026-01-26T18:20:37.783438300
2026-01-26 18:20:37.794 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:37.794 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-98a037b9', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:20:37.783438300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:20:37.795 [clientInboundChannel-16] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-98a037b9, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:20:37.801 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:37.801 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:20:37.796404800', updated_at = NOW() 
WHERE room_id = 'room-98a037b9'
===========================================================================================================
2026-01-26 18:20:37.809 [clientInboundChannel-16] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-98a037b9, current mode: BOT
2026-01-26 18:20:37.811 [clientInboundChannel-16] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:20:40.807 [clientInboundChannel-21] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-98a037b9 at 2026-01-26T18:20:40.807287400
2026-01-26 18:20:40.808 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=xybsq3ih, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:20:40.814 [clientInboundChannel-21] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:40.814 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-98a037b9', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T18:20:40.807287400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:20:40.814 [clientInboundChannel-21] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-98a037b9, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 18:20:40.823 [clientInboundChannel-21] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:40.823 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:20:40.817259700', updated_at = NOW() 
WHERE room_id = 'room-98a037b9'
===========================================================================================================
2026-01-26 18:20:40.828 [clientInboundChannel-21] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-98a037b9 is being closed due to LEAVE message
2026-01-26 18:20:40.850 [clientInboundChannel-21] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-98a037b9, current mode: CLOSED
2026-01-26 18:20:40.852 [clientInboundChannel-21] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 18:20:46.466 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 18:20:46.473 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:46.473 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:20:55.884 [http-nio-28070-exec-6] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:20:55.885 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:20:55.901 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:55.900 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:20:55.895847700', NOW()), NULL, COALESCE('2026-01-26T18:20:55.895847700', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:20:55.902 [http-nio-28070-exec-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-e5b857ec, customerId=cust01
2026-01-26 18:20:55.905 [http-nio-28070-exec-6] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-e5b857ec
2026-01-26 18:20:55.910 [http-nio-28070-exec-6] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-e5b857ec
2026-01-26 18:20:55.922 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:55.922 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:20:55.910815700', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:20:55.923 [http-nio-28070-exec-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:20:55.997 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:20:55.997 [http-nio-28070-exec-3] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-e5b857ec, Company: apt001
2026-01-26 18:20:56.004 [clientOutboundChannel-19] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-e5b857ec, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@5205fc28, simpSessionId=ezgdhj3h}], simpSessionId=ezgdhj3h}
2026-01-26 18:20:56.005 [clientOutboundChannel-19] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=ezgdhj3h
2026-01-26 18:20:56.012 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e5b857ec, sessionId=ezgdhj3h
2026-01-26 18:20:56.021 [clientInboundChannel-16] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-e5b857ec at 2026-01-26T18:20:56.021726600
2026-01-26 18:20:56.031 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:56.031 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:20:56.021726600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:20:56.032 [clientInboundChannel-16] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:20:56.038 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:20:56.038 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:20:56.034693300', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:20:56.047 [clientInboundChannel-16] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-e5b857ec, current mode: BOT
2026-01-26 18:20:56.049 [clientInboundChannel-16] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:21:05.586 [clientInboundChannel-32] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-e5b857ec at 2026-01-26T18:21:05.586119400
2026-01-26 18:21:05.592 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:05.592 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T18:21:05.586119400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:21:05.592 [clientInboundChannel-32] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 18:21:05.599 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:05.599 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:21:05.595187700', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:05.606 [clientInboundChannel-32] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-e5b857ec, current mode: BOT
2026-01-26 18:21:05.607 [clientInboundChannel-32] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-e5b857ec to WAITING mode
2026-01-26 18:21:05.663 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:05.663 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:05.664 [clientInboundChannel-32] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-e5b857ec, status=WAITING
2026-01-26 18:21:05.667 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e5b857ec, sessionId=im4lhzi2
2026-01-26 18:21:05.671 [clientInboundChannel-32] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:05.671 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T18:21:05.656564700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:21:05.671 [clientInboundChannel-32] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 18:21:23.662 [http-nio-28070-exec-8] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-e5b857ec
2026-01-26 18:21:23.662 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:21:23.854 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:23.854 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 6ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:23.855 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-e5b857ec, status=AGENT
2026-01-26 18:21:23.881 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:23.881 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 19ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:23.882 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-e5b857ec, agent=상담원-01
2026-01-26 18:21:23.904 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:23.904 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:21:23.684177700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:21:23.906 [http-nio-28070-exec-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 18:21:23.918 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:21:23.919 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e5b857ec, sessionId=im4lhzi2
2026-01-26 18:21:31.074 [clientInboundChannel-19] DEBUG a.c.controller.AgentChatController - Agent message received for room: room-e5b857ec at 2026-01-26T18:21:31.074898300
2026-01-26 18:21:31.080 [clientInboundChannel-19] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:31.080 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'agent01', '상담원-01', 'AGENT', 'aaa', 'TALK', 'apt001', COALESCE('2026-01-26T18:21:31.074898300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:21:31.081 [clientInboundChannel-19] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=상담원-01, message=aaa
2026-01-26 18:21:31.087 [clientInboundChannel-19] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:31.087 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:21:31.083872200', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:31.098 [clientInboundChannel-19] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-e5b857ec, current mode: AGENT
2026-01-26 18:21:31.098 [clientInboundChannel-19] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-e5b857ec
2026-01-26 18:21:39.695 [http-nio-28070-exec-5] INFO  a.c.controller.AgentChatController - Agent request deleteRoom: roomId=room-e5b857ec
2026-01-26 18:21:39.696 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:21:39.709 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:39.709 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:39.710 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-e5b857ec, status=CLOSED
2026-01-26 18:21:39.736 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:39.736 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 7ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:21:39.723723900', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:39.736 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-e5b857ec
2026-01-26 18:21:39.759 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:39.759 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 11ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'SYSTEM', 'System', 'SYSTEM', '상담원 상담원-01에 의해 상담이 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T18:21:39.696921200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:21:39.760 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=System, message=상담원 상담원-01에 의해 상담이 종료되었습니다.
2026-01-26 18:21:41.833 [http-nio-28070-exec-3] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:21:41.860 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:21:45.281 [clientInboundChannel-37] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-e5b857ec at 2026-01-26T18:21:45.281724500
2026-01-26 18:21:45.286 [clientInboundChannel-37] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:45.286 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'cust01', '홍길철', 'CUSTOMER', 'ㅁㅁㅁㅁㅁㅁㅁㅁㅁ', 'TALK', 'apt001', COALESCE('2026-01-26T18:21:45.281724500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:21:45.286 [clientInboundChannel-37] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=홍길철, message=ㅁㅁㅁㅁㅁㅁㅁㅁㅁ
2026-01-26 18:21:45.291 [clientInboundChannel-37] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:45.291 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:21:45.288705200', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:21:45.297 [clientInboundChannel-37] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-e5b857ec, current mode: CLOSED
2026-01-26 18:21:45.298 [clientInboundChannel-37] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-e5b857ec
2026-01-26 18:21:45.299 [clientInboundChannel-37] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-e5b857ec, CompanyId: apt001
2026-01-26 18:21:45.303 [reactor-http-nio-5] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 18:21:45.312 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:45.312 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T18:21:45.304672100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:21:45.313 [reactor-http-nio-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 18:21:45.319 [reactor-http-nio-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:21:45.319 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:21:45.314644500', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:22:11.644 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=ezgdhj3h, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:22:11.644 [clientInboundChannel-38] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-e5b857ec at 2026-01-26T18:22:11.643945500
2026-01-26 18:22:11.652 [clientInboundChannel-38] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:22:11.651 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 나갔습니다.', 'LEAVE', 'apt001', COALESCE('2026-01-26T18:22:11.643945500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:22:11.652 [clientInboundChannel-38] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=홍길철, message=홍길철님이 나갔습니다.
2026-01-26 18:22:11.659 [clientInboundChannel-38] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:22:11.658 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:22:11.655968900', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:22:11.662 [clientInboundChannel-38] INFO  a.c.s.impl.DynamicRoutingStrategy - Room room-e5b857ec is being closed due to LEAVE message
2026-01-26 18:22:11.682 [clientInboundChannel-38] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-e5b857ec, current mode: CLOSED
2026-01-26 18:22:11.684 [clientInboundChannel-38] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: LEAVE
2026-01-26 18:22:20.473 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-98a037b9, sessionId=im4lhzi2
2026-01-26 18:22:21.866 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e5b857ec, sessionId=im4lhzi2
2026-01-26 18:22:21.869 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:22:23.724 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-98a037b9, sessionId=im4lhzi2
2026-01-26 18:22:23.727 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:22:24.762 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e5b857ec, sessionId=im4lhzi2
2026-01-26 18:22:24.766 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:22:38.705 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:22:38.705 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:22:38.718 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:22:38.717 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-749865bf', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:22:38.710063400', NOW()), NULL, COALESCE('2026-01-26T18:22:38.710063400', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:22:38.718 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-749865bf, customerId=cust01
2026-01-26 18:22:38.720 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-749865bf
2026-01-26 18:22:38.721 [http-nio-28070-exec-5] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-749865bf
2026-01-26 18:22:38.729 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:22:38.729 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-749865bf', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:22:38.722037300', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:22:38.731 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-749865bf, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:22:38.798 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:22:38.798 [http-nio-28070-exec-4] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-749865bf, Company: apt001
2026-01-26 18:22:38.807 [clientOutboundChannel-33] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-749865bf, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@6c8fe0d0, simpSessionId=0mmnhxzf}], simpSessionId=0mmnhxzf}
2026-01-26 18:22:38.808 [clientOutboundChannel-33] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=0mmnhxzf
2026-01-26 18:22:38.812 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-749865bf, sessionId=0mmnhxzf
2026-01-26 18:22:38.820 [clientInboundChannel-41] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-749865bf at 2026-01-26T18:22:38.820252500
2026-01-26 18:22:38.825 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:22:38.825 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-749865bf', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:22:38.820252500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:22:38.826 [clientInboundChannel-41] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-749865bf, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:22:38.832 [clientInboundChannel-41] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:22:38.832 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:22:38.828231800', updated_at = NOW() 
WHERE room_id = 'room-749865bf'
===========================================================================================================
2026-01-26 18:22:38.837 [clientInboundChannel-41] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-749865bf, current mode: BOT
2026-01-26 18:22:38.838 [clientInboundChannel-41] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:23:52.063 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-98a037b9, sessionId=im4lhzi2
2026-01-26 18:23:52.069 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:23:53.341 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e5b857ec, sessionId=im4lhzi2
2026-01-26 18:23:53.346 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:23:55.486 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-98a037b9, sessionId=im4lhzi2
2026-01-26 18:23:55.490 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:23:56.659 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-e5b857ec, sessionId=im4lhzi2
2026-01-26 18:23:56.663 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=im4lhzi2
2026-01-26 18:24:06.786 [MessageBroker-7] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-98a037b9 (Idle for 205959 ms)
2026-01-26 18:24:06.788 [MessageBroker-7] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-98a037b9
2026-01-26 18:24:06.793 [MessageBroker-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:24:06.793 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-98a037b9'
===========================================================================================================
2026-01-26 18:24:06.794 [MessageBroker-7] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-98a037b9, status=CLOSED
2026-01-26 18:24:06.801 [MessageBroker-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:24:06.801 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:24:06.797638100', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-98a037b9'
===========================================================================================================
2026-01-26 18:24:06.801 [MessageBroker-7] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-98a037b9
2026-01-26 18:24:06.807 [MessageBroker-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:24:06.807 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-98a037b9', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T18:24:06.788007300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:24:06.808 [MessageBroker-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-98a037b9, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:24:06.809 [MessageBroker-7] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-98a037b9
2026-01-26 18:25:25.444 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 56636 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 18:25:25.449 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 18:25:27.211 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 18:25:27.215 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 18:25:27.278 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 30 ms. Found 0 Redis repository interfaces.
2026-01-26 18:25:28.284 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 18:25:28.303 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 18:25:28.306 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 18:25:28.307 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 18:25:28.424 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 18:25:28.425 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2887 ms
2026-01-26 18:25:31.254 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 18:25:31.348 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 18:25:31.350 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@52fed5b7]]
2026-01-26 18:25:31.351 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 18:25:31.389 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 18:25:31.413 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 18:25:32.383 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 7.884 seconds (process running for 9.358)
2026-01-26 18:25:32.450 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 18:25:32.450 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 18:25:32.455 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 18:25:32.456 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-e5b857ec (Idle for 200795 ms)
2026-01-26 18:25:32.489 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-e5b857ec
2026-01-26 18:25:33.103 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:25:33.102 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 86ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:25:33.105 [MessageBroker-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-e5b857ec, status=CLOSED
2026-01-26 18:25:33.126 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:25:33.126 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 6ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:25:33.117013900', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-e5b857ec'
===========================================================================================================
2026-01-26 18:25:33.128 [MessageBroker-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-e5b857ec
2026-01-26 18:25:33.156 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:25:33.156 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 21ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-e5b857ec', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T18:25:32.490471800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:25:33.157 [MessageBroker-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-e5b857ec, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:25:33.162 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-e5b857ec
2026-01-26 18:26:07.420 [http-nio-28070-exec-3] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 18:26:07.499 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:07.499 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 76ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:26:16.667 [http-nio-28070-exec-8] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 18:26:16.681 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:16.681 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 10ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:26:16.701 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:16.742 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:16.744 [http-nio-28070-exec-1] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:26:16.905 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=e320o1nv
2026-01-26 18:26:16.906 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@afbff90, simpSessionId=e320o1nv}], simpSessionId=e320o1nv}
2026-01-26 18:26:16.915 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=e320o1nv
2026-01-26 18:26:16.918 [http-nio-28070-exec-3] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:26:21.817 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=e320o1nv, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:26:21.962 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:22.037 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:22.038 [http-nio-28070-exec-9] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:26:22.051 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=f31srzxa
2026-01-26 18:26:22.052 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@3ed316f8, simpSessionId=f31srzxa}], simpSessionId=f31srzxa}
2026-01-26 18:26:22.057 [http-nio-28070-exec-10] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=f31srzxa
2026-01-26 18:26:22.060 [http-nio-28070-exec-10] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:26:22.982 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=f31srzxa, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:26:23.086 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:23.144 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:23.147 [http-nio-28070-exec-7] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:26:23.169 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=y1olzg0h
2026-01-26 18:26:23.171 [clientOutboundChannel-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@6f5f64d, simpSessionId=y1olzg0h}], simpSessionId=y1olzg0h}
2026-01-26 18:26:23.178 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=y1olzg0h
2026-01-26 18:26:23.187 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:26:23.878 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=y1olzg0h, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:26:23.997 [http-nio-28070-exec-4] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:24.078 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:24.082 [http-nio-28070-exec-5] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:26:24.111 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=21bsxwok
2026-01-26 18:26:24.113 [clientOutboundChannel-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@3b86564a, simpSessionId=21bsxwok}], simpSessionId=21bsxwok}
2026-01-26 18:26:24.118 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=21bsxwok
2026-01-26 18:26:24.121 [http-nio-28070-exec-9] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:26:27.775 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:29.116 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:31.323 [MessageBroker-5] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 16, active threads = 0, queued tasks = 0, completed tasks = 33], outboundChannel[pool size = 7, active threads = 0, queued tasks = 0, completed tasks = 7], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 3, completed tasks = 4]
2026-01-26 18:26:31.805 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:26:31.806 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:31.838 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:31.838 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 8ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-b59165fc', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:26:31.823426500', NOW()), NULL, COALESCE('2026-01-26T18:26:31.823426500', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:26:31.841 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-b59165fc, customerId=cust01
2026-01-26 18:26:31.843 [http-nio-28070-exec-5] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-b59165fc
2026-01-26 18:26:31.845 [http-nio-28070-exec-5] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-b59165fc
2026-01-26 18:26:31.856 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:31.855 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b59165fc', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:26:31.845365900', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:26:31.856 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b59165fc, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:26:31.921 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:26:31.921 [http-nio-28070-exec-8] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-b59165fc, Company: apt001
2026-01-26 18:26:31.930 [clientOutboundChannel-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=0jkvvyj3
2026-01-26 18:26:31.931 [clientOutboundChannel-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-b59165fc, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@b348b4b, simpSessionId=0jkvvyj3}], simpSessionId=0jkvvyj3}
2026-01-26 18:26:31.939 [http-nio-28070-exec-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-b59165fc, sessionId=0jkvvyj3
2026-01-26 18:26:31.961 [clientInboundChannel-8] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-b59165fc at 2026-01-26T18:26:31.961076200
2026-01-26 18:26:31.969 [clientInboundChannel-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:31.969 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b59165fc', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:26:31.961076200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:26:31.971 [clientInboundChannel-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b59165fc, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:26:31.980 [clientInboundChannel-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:31.980 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:26:31.975043900', updated_at = NOW() 
WHERE room_id = 'room-b59165fc'
===========================================================================================================
2026-01-26 18:26:31.986 [clientInboundChannel-8] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-b59165fc, current mode: BOT
2026-01-26 18:26:31.989 [clientInboundChannel-8] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:26:32.395 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-749865bf (Idle for 233560 ms)
2026-01-26 18:26:32.396 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-749865bf
2026-01-26 18:26:32.403 [MessageBroker-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:32.403 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-749865bf'
===========================================================================================================
2026-01-26 18:26:32.404 [MessageBroker-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-749865bf, status=CLOSED
2026-01-26 18:26:32.411 [MessageBroker-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:32.410 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:26:32.406637800', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-749865bf'
===========================================================================================================
2026-01-26 18:26:32.411 [MessageBroker-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-749865bf
2026-01-26 18:26:32.420 [MessageBroker-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:26:32.420 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-749865bf', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T18:26:32.397659300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:26:32.421 [MessageBroker-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-749865bf, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:26:32.422 [MessageBroker-6] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-749865bf
2026-01-26 18:27:13.193 [http-nio-28070-exec-10] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-b59165fc
2026-01-26 18:27:13.194 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:27:13.358 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:27:13.358 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-b59165fc'
===========================================================================================================
2026-01-26 18:27:13.359 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-b59165fc, status=AGENT
2026-01-26 18:27:13.373 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:27:13.373 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 8ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-b59165fc'
===========================================================================================================
2026-01-26 18:27:13.374 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-b59165fc, agent=상담원-01
2026-01-26 18:27:13.394 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-b59165fc, sessionId=21bsxwok
2026-01-26 18:27:13.395 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:27:13.394 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 10ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b59165fc', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:27:13.218511700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:27:13.397 [http-nio-28070-exec-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b59165fc, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 18:27:13.412 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=21bsxwok
2026-01-26 18:27:13.413 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-b59165fc, sessionId=21bsxwok
2026-01-26 18:30:32.389 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Cleaning up idle room: room-b59165fc (Idle for 199172 ms)
2026-01-26 18:30:32.391 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Timeout notification sent to room: room-b59165fc
2026-01-26 18:30:32.406 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:30:32.405 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 10ms
[ SQL ] :
UPDATE chat_session 
SET status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-b59165fc'
===========================================================================================================
2026-01-26 18:30:32.407 [MessageBroker-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-b59165fc, status=CLOSED
2026-01-26 18:30:32.423 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:30:32.423 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateEndedAt
[ Execution Time ] : 6ms
[ SQL ] :
UPDATE chat_session 
SET ended_at = '2026-01-26T18:30:32.415517100', status = 'CLOSED', updated_at = NOW() 
WHERE room_id = 'room-b59165fc'
===========================================================================================================
2026-01-26 18:30:32.424 [MessageBroker-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session ended: roomId=room-b59165fc
2026-01-26 18:30:32.534 [MessageBroker-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:30:32.533 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 99ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-b59165fc', 'system', 'System', 'SYSTEM', '장시간 대화가 없어 상담이 자동 종료되었습니다.', 'LEAVE', NULL, COALESCE('2026-01-26T18:30:32.392578600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:30:32.535 [MessageBroker-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-b59165fc, sender=System, message=장시간 대화가 없어 상담이 자동 종료되었습니다.
2026-01-26 18:30:32.538 [MessageBroker-1] INFO  a.chat.service.RoomCleanupService - Timeout record saved to database for room: room-b59165fc
2026-01-26 18:30:35.420 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=0jkvvyj3, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:34:16.809 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 53756 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 18:34:16.817 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 18:34:19.863 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 18:34:19.874 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 18:34:20.022 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 71 ms. Found 0 Redis repository interfaces.
2026-01-26 18:34:21.952 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 18:34:21.981 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 18:34:21.985 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 18:34:21.986 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 18:34:22.152 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 18:34:22.153 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5200 ms
2026-01-26 18:34:25.052 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 18:34:25.164 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 18:34:25.165 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@32ae11c9]]
2026-01-26 18:34:25.167 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 18:34:25.217 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 18:34:25.243 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 18:34:26.293 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 10.805 seconds (process running for 12.424)
2026-01-26 18:34:26.462 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 18:34:26.463 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 18:34:26.465 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2026-01-26 18:35:03.066 [http-nio-28070-exec-4] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 18:35:03.633 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:03.631 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 513ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:35:03.668 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:35:03.744 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:35:03.745 [http-nio-28070-exec-6] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:35:03.872 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=fzjx5crk
2026-01-26 18:35:03.873 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@5dce0d32, simpSessionId=fzjx5crk}], simpSessionId=fzjx5crk}
2026-01-26 18:35:03.882 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=fzjx5crk
2026-01-26 18:35:03.886 [http-nio-28070-exec-8] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:35:05.875 [http-nio-28070-exec-9] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 18:35:05.891 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:05.890 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 11ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:35:12.881 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:35:12.881 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:35:12.935 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:12.935 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 12ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:35:12.901150100', NOW()), NULL, COALESCE('2026-01-26T18:35:12.901150100', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:12.938 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-28aa714d, customerId=cust01
2026-01-26 18:35:12.945 [http-nio-28070-exec-10] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-28aa714d
2026-01-26 18:35:12.947 [http-nio-28070-exec-10] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-28aa714d
2026-01-26 18:35:12.968 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:12.968 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:35:12.947948400', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:35:12.970 [http-nio-28070-exec-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:35:13.033 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:35:13.034 [http-nio-28070-exec-2] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-28aa714d, Company: apt001
2026-01-26 18:35:13.101 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=4ygghuzg
2026-01-26 18:35:13.104 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-28aa714d, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@636278bf, simpSessionId=4ygghuzg}], simpSessionId=4ygghuzg}
2026-01-26 18:35:13.123 [http-nio-28070-exec-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-28aa714d, sessionId=4ygghuzg
2026-01-26 18:35:13.284 [clientInboundChannel-13] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-28aa714d at 2026-01-26T18:35:13.284754700
2026-01-26 18:35:13.295 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:13.295 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:35:13.284754700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:13.305 [clientInboundChannel-13] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:35:13.340 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:13.340 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 29ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:35:13.308690500', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:13.352 [clientInboundChannel-13] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-28aa714d, current mode: BOT
2026-01-26 18:35:13.355 [clientInboundChannel-13] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:35:18.047 [clientInboundChannel-16] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-28aa714d at 2026-01-26T18:35:18.046204100
2026-01-26 18:35:18.055 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:18.055 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T18:35:18.046204100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:18.057 [clientInboundChannel-16] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 18:35:18.065 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:18.065 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:35:18.060170800', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:18.074 [clientInboundChannel-16] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-28aa714d, current mode: BOT
2026-01-26 18:35:18.076 [clientInboundChannel-16] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-28aa714d to WAITING mode
2026-01-26 18:35:18.102 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-28aa714d, sessionId=fzjx5crk
2026-01-26 18:35:18.105 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:18.105 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:18.106 [clientInboundChannel-16] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-28aa714d, status=WAITING
2026-01-26 18:35:18.122 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:18.122 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T18:35:18.095601300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:18.123 [clientInboundChannel-16] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 18:35:24.664 [http-nio-28070-exec-7] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-28aa714d
2026-01-26 18:35:24.664 [http-nio-28070-exec-7] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:35:24.733 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:24.733 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 10ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:24.734 [http-nio-28070-exec-7] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-28aa714d, status=AGENT
2026-01-26 18:35:24.768 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:24.768 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 14ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:24.770 [http-nio-28070-exec-7] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-28aa714d, agent=상담원-01
2026-01-26 18:35:24.793 [http-nio-28070-exec-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:24.792 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:35:24.688555800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:24.796 [http-nio-28070-exec-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 18:35:24.812 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=fzjx5crk
2026-01-26 18:35:24.815 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-28aa714d, sessionId=fzjx5crk
2026-01-26 18:35:25.115 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 16, active threads = 0, queued tasks = 0, completed tasks = 27], outboundChannel[pool size = 11, active threads = 0, queued tasks = 0, completed tasks = 11], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 4, completed tasks = 6]
2026-01-26 18:35:30.806 [http-nio-28070-exec-9] INFO  a.c.controller.AgentChatController - Agent request deleteRoom: roomId=room-28aa714d
2026-01-26 18:35:30.808 [http-nio-28070-exec-9] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:35:30.810 [http-nio-28070-exec-9] INFO  a.c.controller.AgentChatController - Agent ending consultation, switching room room-28aa714d back to BOT mode
2026-01-26 18:35:30.829 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:30.827 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 8ms
[ SQL ] :
UPDATE chat_session 
SET status = 'BOT', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:30.832 [http-nio-28070-exec-9] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-28aa714d, status=BOT
2026-01-26 18:35:30.858 [http-nio-28070-exec-9] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:30.857 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 15ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'SYSTEM', 'System', 'SYSTEM', '상담원과의 상담이 종료되었습니다. 다시 챗봇과 대화하실 수 있습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:35:30.808300500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:30.874 [http-nio-28070-exec-9] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=System, message=상담원과의 상담이 종료되었습니다. 다시 챗봇과 대화하실 수 있습니다.
2026-01-26 18:35:37.422 [clientInboundChannel-14] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-28aa714d at 2026-01-26T18:35:37.422282100
2026-01-26 18:35:37.433 [clientInboundChannel-14] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:37.433 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'cust01', '홍길철', 'CUSTOMER', 'ㅁㅁㅁ', 'TALK', 'apt001', COALESCE('2026-01-26T18:35:37.422282100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:37.435 [clientInboundChannel-14] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=홍길철, message=ㅁㅁㅁ
2026-01-26 18:35:37.443 [clientInboundChannel-14] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:37.443 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:35:37.438245', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:37.449 [clientInboundChannel-14] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-28aa714d, current mode: BOT
2026-01-26 18:35:37.451 [clientInboundChannel-14] INFO  a.c.s.impl.MiChatRoutingStrategy - Forwarding customer message to MiChat for room: room-28aa714d
2026-01-26 18:35:37.461 [clientInboundChannel-14] INFO  aicc.bot.michat.MiChatBotImpl - ChatBot API 호출 시작 - SessionId: room-28aa714d, CompanyId: apt001
2026-01-26 18:35:37.715 [reactor-http-nio-3] ERROR aicc.bot.michat.MiChatBotImpl - ChatBot Stream 처리 중 예외 발생
2026-01-26 18:35:37.733 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:37.733 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 9ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-28aa714d', 'BOT', 'Bot', 'BOT', '서비스 연결에 실패했습니다.', 'TALK', 'apt001', COALESCE('2026-01-26T18:35:37.715563700', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:35:37.735 [reactor-http-nio-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-28aa714d, sender=Bot, message=서비스 연결에 실패했습니다.
2026-01-26 18:35:37.743 [reactor-http-nio-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:35:37.743 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:35:37.737036600', updated_at = NOW() 
WHERE room_id = 'room-28aa714d'
===========================================================================================================
2026-01-26 18:35:40.392 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:35:40.394 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=fzjx5crk
2026-01-26 18:40:31.807 [main] INFO  aicc.AiccChatApplication - Starting AiccChatApplication using Java 17.0.7 with PID 4496 (E:\aicc-dev\aicc\aicc-chat\bin\main started by Administrator in E:\aicc-dev\aicc\aicc-chat)
2026-01-26 18:40:31.813 [main] INFO  aicc.AiccChatApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-26 18:40:33.997 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-01-26 18:40:34.002 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2026-01-26 18:40:34.076 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 41 ms. Found 0 Redis repository interfaces.
2026-01-26 18:40:35.189 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 28070 (http)
2026-01-26 18:40:35.218 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-28070"]
2026-01-26 18:40:35.223 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-26 18:40:35.224 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.34]
2026-01-26 18:40:35.374 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-26 18:40:35.375 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3447 ms
2026-01-26 18:40:39.260 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2026-01-26 18:40:39.360 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2026-01-26 18:40:39.361 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@ecb8b3e]]
2026-01-26 18:40:39.363 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2026-01-26 18:40:39.403 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-28070"]
2026-01-26 18:40:39.431 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 28070 (http) with context path '/'
2026-01-26 18:40:40.396 [main] INFO  aicc.AiccChatApplication - Started AiccChatApplication in 9.941 seconds (process running for 11.739)
2026-01-26 18:40:40.413 [MessageBroker-1] DEBUG a.chat.service.RoomCleanupService - Starting idle room cleanup task... (timeout: 600000ms, interval: 60000ms)
2026-01-26 18:40:41.101 [RMI TCP Connection(2)-127.0.0.1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-26 18:40:41.101 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-26 18:40:41.104 [RMI TCP Connection(2)-127.0.0.1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2026-01-26 18:41:39.314 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 1, completed tasks = 1]
2026-01-26 18:41:40.396 [MessageBroker-1] DEBUG a.chat.service.RoomCleanupService - Starting idle room cleanup task... (timeout: 600000ms, interval: 60000ms)
2026-01-26 18:41:51.928 [http-nio-28070-exec-4] INFO  aicc.chat.service.AgentAuthService - Attempting agent login via API: http://mock-auth-api.aicc/v1/agent/login
2026-01-26 18:41:52.335 [http-nio-28070-exec-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:41:52.334 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectAgentByLogin
[ Execution Time ] : 378ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'agent01' 
  AND role = 'AGENT' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:41:52.360 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:41:52.442 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:41:52.443 [http-nio-28070-exec-6] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:41:52.565 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=ykujcqrq
2026-01-26 18:41:52.566 [clientOutboundChannel-1] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@88cb49, simpSessionId=ykujcqrq}], simpSessionId=ykujcqrq}
2026-01-26 18:41:52.574 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=ykujcqrq
2026-01-26 18:41:52.579 [http-nio-28070-exec-9] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:41:56.496 [http-nio-28070-exec-2] INFO  a.chat.service.CustomerAuthService - Attempting customer login via API: http://mock-auth-api.aicc/v1/login for company: apt001
2026-01-26 18:41:56.505 [http-nio-28070-exec-2] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:41:56.505 ]
[ Mapper Method ] : aicc.chat.mapper.UserAccountMapper.selectCustomerByLogin
[ Execution Time ] : 6ms
[ SQL ] :
SELECT id, user_id, user_name, password, role, email, company_id, active, created_at, updated_at 
FROM user_account 
WHERE user_id = 'cust01' 
  AND role = 'CUSTOMER' 
  AND company_id = 'apt001' 
  AND active = TRUE 
  AND ( password IS NULL 
  OR password = '' 
  OR password = '1234' ) 
LIMIT 1
===========================================================================================================
2026-01-26 18:41:57.965 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Customer request createRoomWithBot
2026-01-26 18:41:57.966 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:41:58.029 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:41:58.029 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.insertChatSession
[ Execution Time ] : 14ms
[ SQL ] :
INSERT 
INTO chat_session ( room_id, room_name, customer_id, customer_name, assigned_agent, status, company_id, started_at, ended_at, last_activity_at, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', 'cust01', '홍길철', NULL, 'BOT', 'apt001', COALESCE('2026-01-26T18:41:57.987632600', NOW()), NULL, COALESCE('2026-01-26T18:41:57.987632600', NOW()), COALESCE(NULL, NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:41:58.032 [http-nio-28070-exec-3] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session created: roomId=room-008fd19e, customerId=cust01
2026-01-26 18:41:58.038 [http-nio-28070-exec-3] INFO  a.c.c.CustomerChatController - Chat session saved to DB: roomId=room-008fd19e
2026-01-26 18:41:58.040 [http-nio-28070-exec-3] INFO  a.c.s.impl.MiChatRoutingStrategy - New room created for MiChat workflow: room-008fd19e
2026-01-26 18:41:58.066 [http-nio-28070-exec-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:41:58.065 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 10ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'BOT', 'Bot', 'BOT', '안녕하세요! 무엇을 도와드릴까요'TALK' ''상담원 연결''을 입력하시면 상담원과 연결해 드립니다.', NULL, '2026-01-26T18:41:58.041198200', COALESCE(NULL, NOW()), COALESCE(?, NOW()) )
===========================================================================================================
2026-01-26 18:41:58.068 [http-nio-28070-exec-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=Bot, message=안녕하세요! 무엇을 도와드릴까요? '상담원 연결'을 입력하시면 상담원과 연결해 드립니다.
2026-01-26 18:41:58.142 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:41:58.143 [http-nio-28070-exec-5] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: cust01, RequestRoom: room-008fd19e, Company: apt001
2026-01-26 18:41:58.153 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=dzmjowdh
2026-01-26 18:41:58.154 [clientOutboundChannel-3] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={userName=홍길철, userId=cust01, roomId=room-008fd19e, companyId=apt001, userEmail=cust01@example.com, userRole=CUSTOMER}, simpHeartbeat=[J@3ce6a116, simpSessionId=dzmjowdh}], simpSessionId=dzmjowdh}
2026-01-26 18:41:58.163 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-008fd19e, sessionId=dzmjowdh
2026-01-26 18:41:58.203 [clientInboundChannel-13] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:41:58.202183800
2026-01-26 18:41:58.214 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:41:58.214 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '홍길철님이 입장하셨습니다.', '
JOIN', 'apt001', COALESCE('2026-01-26T18:41:58.202183800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:41:58.216 [clientInboundChannel-13] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=홍길철님이 입장하셨습니다.
2026-01-26 18:41:58.233 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:41:58.233 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 11ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:41:58.220146600', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:41:58.248 [clientInboundChannel-13] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: BOT
2026-01-26 18:41:58.251 [clientInboundChannel-13] WARN  a.c.s.impl.MiChatRoutingStrategy - Skipping AI processing for message type: JOIN
2026-01-26 18:42:01.079 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=ykujcqrq, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:42:01.237 [http-nio-28070-exec-1] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:01.343 [http-nio-28070-exec-3] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:01.346 [http-nio-28070-exec-3] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:42:01.356 [clientOutboundChannel-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=230kikix
2026-01-26 18:42:01.357 [clientOutboundChannel-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@12db9c00, simpSessionId=230kikix}], simpSessionId=230kikix}
2026-01-26 18:42:01.367 [http-nio-28070-exec-5] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=230kikix
2026-01-26 18:42:01.371 [http-nio-28070-exec-7] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:42:02.548 [http-nio-28070-exec-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onDisconnect: 세션 연결 해제 - sessionId=230kikix, closeStatus=CloseStatus[code=1000, reason=null]
2026-01-26 18:42:02.724 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:02.785 [http-nio-28070-exec-2] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:02.787 [http-nio-28070-exec-2] DEBUG aicc.chat.config.WebSocketConfig - WebSocket Handshake - User: agent01, RequestRoom: null, Company: apt001
2026-01-26 18:42:02.845 [clientOutboundChannel-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onConnected: 세션 연결 완료 - sessionId=v3wlybcv
2026-01-26 18:42:02.846 [clientOutboundChannel-8] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ WebSocket connected: {simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={accept-version=[1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={companyId=apt001, userEmail=agent01@aicc.com, userName=상담원-01, userRole=AGENT, userId=agent01}, simpHeartbeat=[J@3144077c, simpSessionId=v3wlybcv}], simpSessionId=v3wlybcv}
2026-01-26 18:42:02.852 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/rooms, sessionId=v3wlybcv
2026-01-26 18:42:02.860 [http-nio-28070-exec-5] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:42:07.035 [clientInboundChannel-1] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:07.034315500
2026-01-26 18:42:07.059 [clientInboundChannel-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:07.059 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 18ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:07.034315500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:07.061 [clientInboundChannel-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 18:42:07.071 [clientInboundChannel-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:07.071 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:07.065129700', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:07.090 [clientInboundChannel-1] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: BOT
2026-01-26 18:42:07.092 [clientInboundChannel-1] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-008fd19e to WAITING mode
2026-01-26 18:42:07.136 [clientInboundChannel-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:07.135 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 8ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:07.137 [clientInboundChannel-1] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-008fd19e, status=WAITING
2026-01-26 18:42:07.150 [clientInboundChannel-1] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:07.149 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T18:42:07.121514600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:07.156 [clientInboundChannel-1] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 18:42:07.156 [http-nio-28070-exec-6] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-008fd19e, sessionId=v3wlybcv
2026-01-26 18:42:12.527 [http-nio-28070-exec-8] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-008fd19e
2026-01-26 18:42:12.528 [http-nio-28070-exec-8] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:12.674 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:12.674 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 9ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:12.676 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-008fd19e, status=AGENT
2026-01-26 18:42:12.704 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:12.703 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 9ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:12.706 [http-nio-28070-exec-8] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-008fd19e, agent=상담원-01
2026-01-26 18:42:12.771 [http-nio-28070-exec-8] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:12.771 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 57ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:42:12.547904', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:12.773 [http-nio-28070-exec-8] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 18:42:12.783 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=v3wlybcv
2026-01-26 18:42:12.786 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-008fd19e, sessionId=v3wlybcv
2026-01-26 18:42:15.796 [http-nio-28070-exec-10] INFO  a.c.controller.AgentChatController - Agent request deleteRoom: roomId=room-008fd19e
2026-01-26 18:42:15.796 [http-nio-28070-exec-10] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:15.799 [http-nio-28070-exec-10] INFO  a.c.controller.AgentChatController - Agent ending consultation, switching room room-008fd19e back to BOT mode
2026-01-26 18:42:15.831 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:15.831 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 16ms
[ SQL ] :
UPDATE chat_session 
SET status = 'BOT', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:15.832 [http-nio-28070-exec-10] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-008fd19e, status=BOT
2026-01-26 18:42:15.881 [http-nio-28070-exec-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:15.881 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 31ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'SYSTEM', 'System', 'SYSTEM', '상담원과의 상담이 종료되었습니다. 다시 챗봇과 대화하실 수 있습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:42:15.797229100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:15.883 [http-nio-28070-exec-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=System, message=상담원과의 상담이 종료되었습니다. 다시 챗봇과 대화하실 수 있습니다.
2026-01-26 18:42:19.406 [http-nio-28070-exec-1] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:42:19.408 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=v3wlybcv
2026-01-26 18:42:21.412 [clientInboundChannel-16] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:21.412005100
2026-01-26 18:42:21.421 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:21.420 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:21.412005100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:21.422 [clientInboundChannel-16] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 18:42:21.431 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:21.431 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:21.426509700', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:21.438 [clientInboundChannel-16] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: BOT
2026-01-26 18:42:21.440 [clientInboundChannel-16] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-008fd19e to WAITING mode
2026-01-26 18:42:21.464 [http-nio-28070-exec-4] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-008fd19e, sessionId=v3wlybcv
2026-01-26 18:42:21.471 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:21.471 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 7ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:21.472 [clientInboundChannel-16] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-008fd19e, status=WAITING
2026-01-26 18:42:21.498 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:21.497 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T18:42:21.461939100', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:21.498 [clientInboundChannel-16] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 18:42:25.385 [http-nio-28070-exec-5] INFO  a.c.controller.AgentChatController - Agent request assignAgent: roomId=room-008fd19e
2026-01-26 18:42:25.386 [http-nio-28070-exec-5] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:25.484 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:25.484 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 5ms
[ SQL ] :
UPDATE chat_session 
SET status = 'AGENT', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:25.485 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-008fd19e, status=AGENT
2026-01-26 18:42:25.511 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:25.511 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateAssignedAgent
[ Execution Time ] : 8ms
[ SQL ] :
UPDATE chat_session 
SET assigned_agent = '상담원-01', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:25.514 [http-nio-28070-exec-5] INFO  a.c.s.impl.ChatSessionServiceImpl - Agent assigned to session: roomId=room-008fd19e, agent=상담원-01
2026-01-26 18:42:25.529 [http-nio-28070-exec-5] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:25.529 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'SYSTEM', 'System', 'SYSTEM', '상담원-01 상담원과 연결되었습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:42:25.391925800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:25.532 [http-nio-28070-exec-5] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=System, message=상담원-01 상담원과 연결되었습니다.
2026-01-26 18:42:25.558 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=v3wlybcv
2026-01-26 18:42:25.561 [http-nio-28070-exec-7] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-008fd19e, sessionId=v3wlybcv
2026-01-26 18:42:34.157 [http-nio-28070-exec-6] INFO  a.c.controller.AgentChatController - Agent request deleteRoom: roomId=room-008fd19e
2026-01-26 18:42:34.158 [http-nio-28070-exec-6] INFO  aicc.chat.service.TokenService - [TokenService] Non-JWT token detected (Base64)
2026-01-26 18:42:34.160 [http-nio-28070-exec-6] INFO  a.c.controller.AgentChatController - Agent ending consultation, switching room room-008fd19e back to BOT mode
2026-01-26 18:42:34.170 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:34.170 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET status = 'BOT', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:34.171 [http-nio-28070-exec-6] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-008fd19e, status=BOT
2026-01-26 18:42:34.192 [http-nio-28070-exec-6] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:34.192 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 5ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'SYSTEM', 'System', 'SYSTEM', '상담원과의 상담이 종료되었습니다. 다시 챗봇과 대화하실 수 있습니다.', 'TALK', NULL, COALESCE('2026-01-26T18:42:34.159060400', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:34.193 [http-nio-28070-exec-6] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=System, message=상담원과의 상담이 종료되었습니다. 다시 챗봇과 대화하실 수 있습니다.
2026-01-26 18:42:35.378 [http-nio-28070-exec-8] DEBUG a.c.controller.AgentChatController - Agent request findAllRooms
2026-01-26 18:42:35.400 [http-nio-28070-exec-9] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onUnsubscribe: 구독 해제 - sessionId=v3wlybcv
2026-01-26 18:42:37.026 [clientInboundChannel-13] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:37.026790600
2026-01-26 18:42:37.036 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:37.036 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 7ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:37.026790600', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:37.038 [clientInboundChannel-13] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 18:42:37.048 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:37.048 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:37.042748100', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:37.065 [clientInboundChannel-13] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: BOT
2026-01-26 18:42:37.067 [clientInboundChannel-13] INFO  a.c.s.impl.MiChatRoutingStrategy - Switching room room-008fd19e to WAITING mode
2026-01-26 18:42:37.099 [http-nio-28070-exec-2] INFO  a.c.websocket.WebSocketEventListener - ㅁㅁㅁ onSubscribe: 구독 요청 - destination=/topic/room/room-008fd19e, sessionId=v3wlybcv
2026-01-26 18:42:37.101 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:37.101 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateChatSessionStatus
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET status = 'WAITING', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:37.104 [clientInboundChannel-13] INFO  a.c.s.impl.ChatSessionServiceImpl - Chat session status updated: roomId=room-008fd19e, status=WAITING
2026-01-26 18:42:37.116 [clientInboundChannel-13] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:37.116 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 6ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'SYSTEM', 'System', 'SYSTEM', '상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.', 'TALK', NULL, COALESCE('2026-01-26T18:42:37.092258300', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:37.118 [clientInboundChannel-13] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=System, message=상담원 연결을 요청하였습니다. 상담원이 연결될 때까지 잠시만 기다려 주세요.
2026-01-26 18:42:39.098 [clientInboundChannel-16] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:39.098631900
2026-01-26 18:42:39.103 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:39.103 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:39.098631900', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:39.103 [clientInboundChannel-16] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 18:42:39.119 [clientInboundChannel-16] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:39.119 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 4ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:39.114242500', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:39.132 [clientInboundChannel-16] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: WAITING
2026-01-26 18:42:39.132 [clientInboundChannel-16] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-008fd19e
2026-01-26 18:42:40.029 [clientInboundChannel-7] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:40.028494800
2026-01-26 18:42:40.034 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:40.034 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:40.028494800', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:40.035 [clientInboundChannel-7] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 18:42:40.040 [clientInboundChannel-7] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:40.039 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:40.036472800', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:40.048 [clientInboundChannel-7] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: WAITING
2026-01-26 18:42:40.048 [clientInboundChannel-7] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-008fd19e
2026-01-26 18:42:40.391 [MessageBroker-3] DEBUG a.chat.service.RoomCleanupService - Starting idle room cleanup task... (timeout: 600000ms, interval: 60000ms)
2026-01-26 18:42:40.881 [clientInboundChannel-10] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:40.881866500
2026-01-26 18:42:40.887 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:40.887 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 3ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:40.881866500', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:40.888 [clientInboundChannel-10] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 18:42:40.892 [clientInboundChannel-10] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:40.892 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 1ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:40.889850200', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:40.897 [clientInboundChannel-10] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: WAITING
2026-01-26 18:42:40.897 [clientInboundChannel-10] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-008fd19e
2026-01-26 18:42:43.157 [clientInboundChannel-3] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:43.157581200
2026-01-26 18:42:43.165 [clientInboundChannel-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:43.165 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 4ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결을 요청합니다.', 'HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:43.157581200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:43.165 [clientInboundChannel-3] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결을 요청합니다.
2026-01-26 18:42:43.171 [clientInboundChannel-3] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:43.171 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 2ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:43.167553700', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:43.183 [clientInboundChannel-3] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: WAITING
2026-01-26 18:42:43.183 [clientInboundChannel-3] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-008fd19e
2026-01-26 18:42:45.919 [clientInboundChannel-4] DEBUG a.c.c.CustomerChatController - Customer message received for room: room-008fd19e at 2026-01-26T18:42:45.919140200
2026-01-26 18:42:45.924 [clientInboundChannel-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:45.924 ]
[ Mapper Method ] : aicc.chat.mapper.ChatHistoryMapper.insertChatHistory
[ Execution Time ] : 2ms
[ SQL ] :
INSERT 
INTO chat_history ( room_id, sender_id, sender_name, sender_role, message, message_type, company_id, created_at, updated_at ) 
VALUES ( 'room-008fd19e', 'cust01', '홍길철', 'CUSTOMER', '상담원 연결 요청을 취소합니다.', 'CANCEL_HANDOFF', 'apt001', COALESCE('2026-01-26T18:42:45.919140200', NOW()), COALESCE(NULL, NOW()) )
===========================================================================================================
2026-01-26 18:42:45.925 [clientInboundChannel-4] DEBUG a.c.s.impl.ChatHistoryServiceImpl - Chat history saved: roomId=room-008fd19e, sender=홍길철, message=상담원 연결 요청을 취소합니다.
2026-01-26 18:42:45.930 [clientInboundChannel-4] INFO  aicc.chat.config.MyBatisSqlLogger - 
===========================================================================================================
[ 2026-01-26 18:42:45.930 ]
[ Mapper Method ] : aicc.chat.mapper.ChatSessionMapper.updateLastActivityAt
[ Execution Time ] : 3ms
[ SQL ] :
UPDATE chat_session 
SET last_activity_at = '2026-01-26T18:42:45.926119900', updated_at = NOW() 
WHERE room_id = 'room-008fd19e'
===========================================================================================================
2026-01-26 18:42:45.935 [clientInboundChannel-4] DEBUG a.c.s.impl.DynamicRoutingStrategy - Dynamic routing for room: room-008fd19e, current mode: WAITING
2026-01-26 18:42:45.936 [clientInboundChannel-4] DEBUG a.c.s.impl.AgentRoutingStrategy - Agent routing for room: room-008fd19e
